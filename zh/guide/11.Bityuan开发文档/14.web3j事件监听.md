# web3jäº‹ä»¶ç›‘å¬

> ğŸ“¹ [è§†é¢‘æ•™ç¨‹](https://www.bilibili.com/video/BV1HM411T7Gn/?share_source=copy_web&vd_source=6dc648c02f2bdc5a6e650dadc1136eed)

æ¦‚å¿µæè¿°[å‚è€ƒL8](./8.web3.jsåˆçº¦äº‹ä»¶.md)

## 1. æŸ¥è¯¢åˆçº¦å†å²äº‹ä»¶

web3j.ethGetLogs(filter)
è¿‡æ»¤å™¨å¯¹è±¡ï¼š
- fromBlock: èµ·å§‹åŒºå—ï¼ˆæœ€å°å€¼æ”¯æŒä»1å¼€å§‹ï¼‰
- toBlock: ç»ˆæ­¢åŒºå—ï¼Œ è¿™ä¸ªå‚æ•°ä¸å¸¦ä»£è¡¨ä¸€ç›´åˆ°æœ€å¤§åŒºå—
- address: åˆçº¦åœ°å€
- event: äº‹ä»¶åå’Œå‚æ•°

ç¤ºä¾‹ï¼š 
```java
// è¦æŸ¥è¯¢çš„äº‹ä»¶
Event event = new Event("TokenMinted", Arrays.asList(new TypeReference<Uint256>() {},
        new TypeReference<Uint256>() {},
        new TypeReference<Utf8String>() {}));

EthFilter filter = new EthFilter(
                DefaultBlockParameterName.EARLIEST, // æ—¥å¿—çš„èµ·å§‹åŒºå—
                DefaultBlockParameterName.LATEST, // æ—¥å¿—çš„ç»“æŸåŒºå—
                contractAddress // æŸ¥è¯¢çš„æ™ºèƒ½åˆçº¦åœ°å€
);

// æ·»åŠ eventç±»å‹åŠå…¶å‚æ•°
filter.addSingleTopic(EventEncoder.encode(event));

// è·å–ç¬¦åˆè¿‡æ»¤å™¨æ¡ä»¶çš„æ‰€æœ‰æ—¥å¿—
EthLog log = web3j.ethGetLogs(filter).send();
```

## 2. è®¢é˜…åŒºå—é“¾ä¸­çš„æŒ‡å®šäº‹ä»¶

web3j.ethLogFlowable(filter).subscribe(log -> {})

ç¤ºä¾‹ï¼š
```java
// è¦ç›‘å¬çš„äº‹ä»¶
Event event = new Event("TokenMinted", Arrays.asList(new TypeReference<Uint256>() {},
        new TypeReference<Uint256>() {},
        new TypeReference<Utf8String>() {}));

// è¿‡æ»¤å¼€å§‹åŒºå—ï¼Œç»“æŸåŒºå—ï¼Œåˆçº¦åœ°å€
EthFilter filter = new EthFilter(
    DefaultBlockParameterName.EARLIEST, DefaultBlockParameterName.LATEST, contractAddress);
        
filter.addSingleTopic(EventEncoder.encode(event));

web3j.ethLogFlowable(filter).subscribe(log -> {

    System.out.println(log.getTopics());

    // è§£ç éindexå‚æ•°
    List<Type> results = FunctionReturnDecoder.decode(log.getData(), event.getNonIndexedParameters());
    BigInteger value = (BigInteger) results.get(0).getValue();
    System.out.println("supply is: " +  value);
});
```
