# ethers.jsç¯å¢ƒæ­å»ºå’ŒåŸºæœ¬æ“ä½œ

> ğŸ“¹ [è§†é¢‘æ•™ç¨‹](https://www.bilibili.com/video/BV1Y84y1A7Mh/?share_source=copy_web&vd_source=6dc648c02f2bdc5a6e650dadc1136eed)

## 1. å®‰è£…ethers.js

```bash
# æœ€æ–°ç‰ˆæœ¬æ˜¯6.x, æ¼”ç¤ºä½¿ç”¨çš„æ˜¯5.7.2ç‰ˆæœ¬
npm install ethers@5.7.2
```

## 2. ethers.jså¸¸ç”¨æŸ¥è¯¢

ethers.jsæ¥å£æ–‡æ¡£ï¼š https://docs.ethers.org/v5/
- ä¸‹é¢æ¼”ç¤ºçš„æ¥å£éƒ½æ˜¯åŸºäºV5çš„ç‰ˆæœ¬ï¼Œ V5å’ŒV6ç‰ˆæœ¬çš„æ¥å£æœ‰åŒºåˆ«ï¼Œè¦æ³¨æ„åŒºåˆ†ç‰ˆæœ¬  

```javascript
# è¿æ¥åŒºå—é“¾
const { ethers } = require("ethers");
// rpcè¿æ¥
const provider = new ethers.JsonRpcProvider("http://localhost:8545");
```

ä»¥ä¸‹åˆ—ä¸¾çš„éƒ½æ˜¯é€‚ç”¨äºchain33çš„å¸¸ç”¨æŸ¥è¯¢æ¥å£  
```javascript
// æŸ¥è¯¢åŒºå—é«˜åº¦
const blocknumber = await provider.getBlockNumber();
console.log(`åŒºå—é«˜åº¦ï¼š${blocknumber}`) 

// æŸ¥è¯¢è´¦æˆ·ä½™é¢
const balance = await provider.getBalance("0x4797A444f34C26e71803A1d98D5031a3cAE70650")

// æ ¼å¼åŒ–è´¦æˆ·ä½™é¢
const balanceformat = ethers.utils.formatEther(balance)
console.log(`è´¦æˆ·ä½™é¢ï¼š${balanceformat}`)  

// è·å¾—è´¦æˆ·äº¤æ˜“æ•°
const txCount = await  provider.getTransactionCount("0x4797A444f34C26e71803A1d98D5031a3cAE70650")
console.log(`è´¦æˆ·äº¤æ˜“æ•°ï¼š${txCount}`)  

// è·å–é“¾ID
const chainId = (await provider.getNetwork()).chainId
console.log(`ChainIdï¼š${chainId}`)

// è·å–èŠ‚ç‚¹ä¸Šè´¦æˆ·ä¿¡æ¯
const listenerCount = await provider.listAccounts()
console.log(listenerCount)  

// è·å–äº¤æ˜“ä¿¡æ¯
const txInfo = await provider.getTransaction("0x1cfe5918bdd29772c0c57ae6f702c62636318dbe7f27145e3c386aeaa67a8bca")
console.log(txInfo)

// è·å–äº¤æ˜“å›æ‰§
const txreceipt = await provider.getTransactionReceipt("0x1cfe5918bdd29772c0c57ae6f702c62636318dbe7f27145e3c386aeaa67a8bca")
console.log(txreceipt)

// è·å–åŒºå—ä¿¡æ¯
const blockInfo = await provider.getBlock(10)
console.log(blockInfo) 

// è·å–æŒ‡å®šåˆçº¦åœ°å€çš„åˆçº¦bytecode
const code = await provider.getCode("0x61b35E8804F87589fBb7da3A6B68c563C05Bb2f1")
console.log(code)
```

## 3. ethers.jså‘é€è½¬è´¦äº¤æ˜“(rpcæ¥å£)

TODO: è¿™ç§æ–¹å¼chain33æ”¯æŒä¸Šè¿˜æœ‰äº›é—®é¢˜, å‘é€äº¤æ˜“è¿”å›çš„hashæ˜¯chain33åŸç”Ÿçš„,å¯¼è‡´äº¤æ˜“æ£€æŸ¥ä¸é€šè¿‡
å·²ç»æäº†issueè®©ä»–ä»¬è§£å†³. 

```javascript
// å‘é€æ–¹ç§é’¥
   const privatekey = "0x76491916cf0e70437cbed8c2ce9ac2241221e56f8e64ec74e3282b07f24018e1";

   // åˆ›å»ºä¸€ä¸ªé’±åŒ…
   const wallet = new ethers.Wallet(privatekey, provider);

   // è®¾ç½®æ¥æ”¶æ–¹åœ°å€
   const toAddress = '0xFd89C32962f19bcEA69B76093a64A03618cB33BE';

   // è®¾ç½®è½¬è´¦æ•°é‡
   const value = ethers.utils.parseEther('12345.0');

   // åˆ›å»ºäº¤æ˜“å¯¹è±¡
   const tx = {
       to: toAddress,
       value: value,
       gasLimit: 21000,
       gasPrice: ethers.utils.parseUnits("10", "gwei"),
       chainId: 999,
       nonce: await provider.getTransactionCount(wallet.address)
   };

   // ç­¾åäº¤æ˜“
   const signedTx = await wallet.signTransaction(tx);

   // å‘é€äº¤æ˜“
   provider.sendTransaction(signedTx)
```

## 4. ethers.jså‘é€è½¬è´¦äº¤æ˜“(metamask)

1. å¯¼å…¥ethers.js
```html
<script src="https://cdn.ethers.io/lib/ethers-5.5.2.umd.min.js"></script>
```

2. è¿æ¥matemask,ç­¾åå¹¶å‘é€äº¤æ˜“
```javascript
<script>
    window.addEventListener('load', async () => {
      // Wait for MetaMask to be installed
      if (typeof window.ethereum === 'undefined') {
        alert('Please install MetaMask first.');
        return;
      }
      
      // Request account access from MetaMask
      await window.ethereum.enable();
      
      // Connect to the Ethereum network using ethers.js
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      
      // Create a signer object to sign transactions with
      const signer = provider.getSigner();
      
      // Get the user's Ethereum address
      const address = await signer.getAddress();
      
      // Listen for form submission
      document.getElementById('send-form').addEventListener('submit', async (event) => {
        event.preventDefault();
        
        // Get form data
        const to = "to address";
        const value = "amount";
        
        // Create a transaction object
        const tx = {
          to,
          value
        };
        
        // Sign and send the transaction
        const result = await signer.sendTransaction(tx);
        console.log('Transaction result:', result);
      });
    });
  </script>
```
