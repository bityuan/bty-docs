# ethers.jsäº‹ä»¶ç›‘å¬

> ğŸ“¹ [è§†é¢‘æ•™ç¨‹](https://www.bilibili.com/video/BV1wv4y157wP/?share_source=copy_web&vd_source=6dc648c02f2bdc5a6e650dadc1136eed)

æ¦‚å¿µæè¿°[å‚è€ƒL8](./8.web3.jsåˆçº¦äº‹ä»¶.md)

## 1. æŸ¥è¯¢åˆçº¦å†å²äº‹ä»¶

provider.getLogs(filter)
è¿‡æ»¤å™¨å¯¹è±¡ï¼š
- fromBlock: èµ·å§‹åŒºå—ï¼ˆæœ€å°å€¼æ”¯æŒä»1å¼€å§‹ï¼‰
- toBlock: ç»ˆæ­¢åŒºå—ï¼Œ è¿™ä¸ªå‚æ•°ä¸å¸¦ä»£è¡¨ä¸€ç›´åˆ°æœ€å¤§åŒºå—
- address: åˆçº¦åœ°å€
- topics: æ—¥å¿—é¡¹ä¸­çš„ä¸»é¢˜å€¼æ•°ç»„

ç¤ºä¾‹ï¼š 
```javascript
// rpcè¿æ¥
const provider = new ethers.providers.JsonRpcProvider("http://localhost:8545");

// åˆçº¦åœ°å€
var contractAddress = '0x61b35E8804F87589fBb7da3A6B68c563C05Bb2f1';

// topicå€¼
const eventTopic = ethers.utils.id('TokenMinted(uint256,uint256,string)');

const filter = {
    address: contractAddress,
    fromBlock: 1, // æœ€å°é«˜åº¦æ˜¯1ï¼Œä¸èƒ½ä»0å¼€å§‹
    toBlock: 'latest',
    topics: [eventTopic]
  };
  
  const logs = await provider.getLogs(filter);
  console.log(logs)

[
  {
    address: '0x61b35E8804F87589fBb7da3A6B68c563C05Bb2f1',
    topics: [
      '0x30b042f6d29a39b7c10c2dfbd81016db37ea3d11e72ec5764fb0d0f7a1012a3a',
      '0x0000000000000000000000000000000000000000000000000000000000002718'
    ],
    data: '........',
    blockNumber: 79,
    transactionHash: '0xc5bb3cd573e04e5561d262c394218bc3ad3457f6f0aa2f8101464ebb108700fb',
    transactionIndex: 0,
    blockHash: '0x7b0b108c8b55bdefb5edd6a1ce1ec05180f3cd0b58aa373ff88e9682ab694b7a',
    logIndex: 1,
    removed: false,
    id: 'log_bab13c4d'
  }
]
```

## 2. è®¢é˜…åŒºå—é“¾ä¸­çš„æŒ‡å®šäº‹ä»¶

ethers.Contract.on("äº‹ä»¶å", (args));  

ç¤ºä¾‹ï¼š
```javascript
// websocketè¿æ¥
const providerWs = new ethers.providers.WebSocketProvider('ws://localhost:8546');

// åˆ›å»ºåˆçº¦å®ä¾‹
const contract = new ethers.Contract(contractAddress, abi, providerWs);

// ç›‘å¬mintäº‹ä»¶
contract.on("TokenMinted", (tokenId, supply, uri) => {
    console.log(`TokenMinted event received for ${tokenId}ï¼Œsupply: ${supply}, uri: ${uri}`);
});
```

## 3. æ ¹æ®äº‹ä»¶ç­¾åè®¡ç®—topicsçš„å€¼

```javascript
// æ–¹å¼ä¸€ï¼š
const iface = new ethers.utils.Interface(abi);

const eventName = "TokenMinted";
const eventArgs = [{name: "tokenId", type: "uint256"}, {name: "supply", type: "uint256"},{name: "uri", type: "string"}];

const eventTopic = iface.getEventTopic(eventName, eventArgs);
console.log(eventTopic)

// æ–¹æ³•äºŒï¼š
const topic1 = ethers.utils.id('TokenMinted(uint256,uint256,string)');
console.log(topic1)
```
