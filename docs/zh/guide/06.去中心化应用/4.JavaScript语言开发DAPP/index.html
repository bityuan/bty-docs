<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript语言开发DAPP | BitYuan</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="A demo for vuepress-theme-hope">
    <meta property="og:url" content="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP.html">
    <meta property="og:site_name" content="BitYuan">
    <meta property="og:title" content="JavaScript语言开发DAPP">
    <meta property="og:description" content="JavaScript语言开发DAPP&quot;使用JavaScript语言进行DApp开发，首先要按照一定格式编写一个合约，然后可以使用cli调试工具或者调用JSON RPC接口将合约部署到链上，通过调用相应的方法完成想要的操作。&quot; 用JavaScript编写合约 一般js文件包含如下规则:定义Init(context)函数：该函数在部署合约时会被调用，作用是为">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh-CN">
    <meta property="og:locale:alternate" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="BitYuan">
    
    <link rel="preload" href="/assets/css/0.styles.b9744494.css" as="style"><link rel="preload" href="/assets/js/app.0ace8b6b.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.9cca5321.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.273fc434.js" as="script"><link rel="preload" href="/assets/js/page-JavaScript语言开发DAPP.9516e8f2.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.4a182f2f.js" as="script"><link rel="prefetch" href="/assets/js/155.6fa004fb.js"><link rel="prefetch" href="/assets/js/156.0e13db96.js"><link rel="prefetch" href="/assets/js/157.c07e4930.js"><link rel="prefetch" href="/assets/js/158.041d7eb0.js"><link rel="prefetch" href="/assets/js/159.d4cb1ad8.js"><link rel="prefetch" href="/assets/js/layout-Blog.928a5d56.js"><link rel="prefetch" href="/assets/js/layout-Layout.85d11602.js"><link rel="prefetch" href="/assets/js/layout-NotFound.138a8572.js"><link rel="prefetch" href="/assets/js/layout-Slide.69d59065.js"><link rel="prefetch" href="/assets/js/page-AccountModel.939fd834.js"><link rel="prefetch" href="/assets/js/page-BalanceInquiry.fa764758.js"><link rel="prefetch" href="/assets/js/page-BitYuanIntroduction.69777e2d.js"><link rel="prefetch" href="/assets/js/page-BitYuanMainNetworkEnvironmentConfiguration.85807c04.js"><link rel="prefetch" href="/assets/js/page-BitYuanWalletGuidelines.740cf436.js"><link rel="prefetch" href="/assets/js/page-BlockchainInterface.777260ff.js"><link rel="prefetch" href="/assets/js/page-BlockchainModule.fc3dc749.js"><link rel="prefetch" href="/assets/js/page-Blockchain模块.bd230652.js"><link rel="prefetch" href="/assets/js/page-Buildparachain.70ba7942.js"><link rel="prefetch" href="/assets/js/page-CA工具使用说明.36b278c6.js"><link rel="prefetch" href="/assets/js/page-CA服务使用说明.f349aab5.js"><link rel="prefetch" href="/assets/js/page-CaseFoodTraceability.92b4acae.js"><link rel="prefetch" href="/assets/js/page-Chain33系统接口.284c99d1.js"><link rel="prefetch" href="/assets/js/page-CommunityAutonomyDAO.82921cd7.js"><link rel="prefetch" href="/assets/js/page-CompatiblewithEthereumEVM.54c1a58f.js"><link rel="prefetch" href="/assets/js/page-ConsensusModule.86d50c45.js"><link rel="prefetch" href="/assets/js/page-CreateBitYuanparentBlockchain.ec2cca9f.js"><link rel="prefetch" href="/assets/js/page-DAPPdevelopmentinGolanguage.50adaa09.js"><link rel="prefetch" href="/assets/js/page-DAPPdevelopmentinJavaScriptlanguage.94b4f29a.js"><link rel="prefetch" href="/assets/js/page-DAPPdevelopmentinSoliditylanguage.7b4e2111.js"><link rel="prefetch" href="/assets/js/page-DAPP开发介绍.ceebbece.js"><link rel="prefetch" href="/assets/js/page-DecentralizedApplication.e3fa2d43.js"><link rel="prefetch" href="/assets/js/page-Deployblockchainbrowser.817c50de.js"><link rel="prefetch" href="/assets/js/page-Deploysmartcontract.bdba5306.js"><link rel="prefetch" href="/assets/js/page-Deploywallet.c1ec8d70.js"><link rel="prefetch" href="/assets/js/page-Dockingwithexternalapplication.9e222c8d.js"><link rel="prefetch" href="/assets/js/page-EVMInterface.6c5907ae.js"><link rel="prefetch" href="/assets/js/page-EVM接口.044f402d.js"><link rel="prefetch" href="/assets/js/page-EventInterface.7dcd2ba1.js"><link rel="prefetch" href="/assets/js/page-ExecutorInterface.3084b84b.js"><link rel="prefetch" href="/assets/js/page-ExecutorModule.5ed117cc.js"><link rel="prefetch" href="/assets/js/page-FuelConsumption.94d09b00.js"><link rel="prefetch" href="/assets/js/page-GRPC接口约定.5f88411e.js"><link rel="prefetch" href="/assets/js/page-Go语言开发DAPP.a5e68602.js"><link rel="prefetch" href="/assets/js/page-InterfaceContract.37e479ab.js"><link rel="prefetch" href="/assets/js/page-IntroductiontoDAppDevelopment.bc4df42b.js"><link rel="prefetch" href="/assets/js/page-Manage.4fb0372a.js"><link rel="prefetch" href="/assets/js/page-ManageInterface.fcff75e5.js"><link rel="prefetch" href="/assets/js/page-MempoolInterface.2367aa92.js"><link rel="prefetch" href="/assets/js/page-MempoolModule.d05c778e.js"><link rel="prefetch" href="/assets/js/page-Mempool接口.792c60d2.js"><link rel="prefetch" href="/assets/js/page-Mempool模块.a0911410.js"><link rel="prefetch" href="/assets/js/page-MiningInterface.19a8a491.js"><link rel="prefetch" href="/assets/js/page-NetworkType.22762881.js"><link rel="prefetch" href="/assets/js/page-P2PModule.49ee17b6.js"><link rel="prefetch" href="/assets/js/page-P2P模块.af7df625.js"><link rel="prefetch" href="/assets/js/page-ParachainTokenIssuance.828fdb31.js"><link rel="prefetch" href="/assets/js/page-Project.e747a049.js"><link rel="prefetch" href="/assets/js/page-QueueModule.aac765a8.js"><link rel="prefetch" href="/assets/js/page-Queue模块.a30a8f54.js"><link rel="prefetch" href="/assets/js/page-RPCModule.851ae581.js"><link rel="prefetch" href="/assets/js/page-RPC接口编程样例.44587368.js"><link rel="prefetch" href="/assets/js/page-RPC模块.119b31f5.js"><link rel="prefetch" href="/assets/js/page-SPOSConsensus.6ed46fc1.js"><link rel="prefetch" href="/assets/js/page-SPOS共识.b7d71945.js"><link rel="prefetch" href="/assets/js/page-SmartContract.eb1ad91a.js"><link rel="prefetch" href="/assets/js/page-Solidity语言开发DAPP.87f6e094.js"><link rel="prefetch" href="/assets/js/page-StorageModule.b077e82c.js"><link rel="prefetch" href="/assets/js/page-StorageSharding.8d78925a.js"><link rel="prefetch" href="/assets/js/page-SystemInterface.c35166aa.js"><link rel="prefetch" href="/assets/js/page-SystemModule.55dbb3b8.js"><link rel="prefetch" href="/assets/js/page-TechnicalArchitecture.ceeaa350.js"><link rel="prefetch" href="/assets/js/page-Terminology.154d433f.js"><link rel="prefetch" href="/assets/js/page-TokenInterface.f14f54fc.js"><link rel="prefetch" href="/assets/js/page-TokenIssuance.57017b5d.js"><link rel="prefetch" href="/assets/js/page-Token接口.395e8f9d.js"><link rel="prefetch" href="/assets/js/page-Trade.d0081a08.js"><link rel="prefetch" href="/assets/js/page-Trade接口.b13b0a67.js"><link rel="prefetch" href="/assets/js/page-TransactionInterface.8d7e6a13.js"><link rel="prefetch" href="/assets/js/page-Unfreeze.267e8d71.js"><link rel="prefetch" href="/assets/js/page-UnfreezeInterface.c3b16d0b.js"><link rel="prefetch" href="/assets/js/page-WalletInterface.2bf203dd.js"><link rel="prefetch" href="/assets/js/page-WalletModule.481bd723.js"><link rel="prefetch" href="/assets/js/page-WalletRecoveryContract.90eced10.js"><link rel="prefetch" href="/assets/js/page-Wallet接口.cc138e04.js"><link rel="prefetch" href="/assets/js/page-Zero-KnowledgeProof.61af8a7c.js"><link rel="prefetch" href="/assets/js/page-autonomy接口.97ec3b38.js"><link rel="prefetch" href="/assets/js/page-ethersjs事件监听.31ae3adc.js"><link rel="prefetch" href="/assets/js/page-ethersjs合约部署和读写.66cbbc4e.js"><link rel="prefetch" href="/assets/js/page-ethersjs环境搭建和基本操作.c918747f.js"><link rel="prefetch" href="/assets/js/page-go-sdk基本开发环境搭建及常用方法.bcdeb1f1.js"><link rel="prefetch" href="/assets/js/page-web3js合约事件.455af4c6.js"><link rel="prefetch" href="/assets/js/page-web3js合约读写.555111f5.js"><link rel="prefetch" href="/assets/js/page-web3js合约部署.383bbd50.js"><link rel="prefetch" href="/assets/js/page-web3js基本开发环境搭建及常用查询函数.6967125a.js"><link rel="prefetch" href="/assets/js/page-web3js账户操作和发送交易.d0f4661c.js"><link rel="prefetch" href="/assets/js/page-web3j事件监听.c7118d8d.js"><link rel="prefetch" href="/assets/js/page-web3j合约部署和读写.2cfb88b4.js"><link rel="prefetch" href="/assets/js/page-web3j基本开发环境搭建及常用查询函数.1ec0a77b.js"><link rel="prefetch" href="/assets/js/page-事件接口.0bd2844c.js"><link rel="prefetch" href="/assets/js/page-交易接口.ff3f25b0.js"><link rel="prefetch" href="/assets/js/page-公链发展趋势.3e6f9431.js"><link rel="prefetch" href="/assets/js/page-共识模块.492f5b0d.js"><link rel="prefetch" href="/assets/js/page-兼容以太坊EVM.da65763a.js"><link rel="prefetch" href="/assets/js/page-创建比特元主链节点.26da0e2e.js"><link rel="prefetch" href="/assets/js/page-区块链接口.db3444aa.js"><link rel="prefetch" href="/assets/js/page-去中心化NFT交易系统.70777158.js"><link rel="prefetch" href="/assets/js/page-去中心化域名系统.0d4d1d50.js"><link rel="prefetch" href="/assets/js/page-去中心化委托投票.f28df0d2.js"><link rel="prefetch" href="/assets/js/page-去中心化应用.a2584e68.js"><link rel="prefetch" href="/assets/js/page-命令行工具介绍.d35fe73f.js"><link rel="prefetch" href="/assets/js/page-国密支持.e4e48958.js"><link rel="prefetch" href="/assets/js/page-多重签名.3aa2da0b.js"><link rel="prefetch" href="/assets/js/page-存储分片.eaea8e19.js"><link rel="prefetch" href="/assets/js/page-存储模块.f1d3e1d5.js"><link rel="prefetch" href="/assets/js/page-对接外部应用.43f27c19.js"><link rel="prefetch" href="/assets/js/page-平行链共识节点挖矿奖励规则.58a7ebd2.js"><link rel="prefetch" href="/assets/js/page-平行链发行Token.90b176e5.js"><link rel="prefetch" href="/assets/js/page-平行链环境配置.12feddc5.js"><link rel="prefetch" href="/assets/js/page-平行链资产转移管理介绍.faf77f8a.js"><link rel="prefetch" href="/assets/js/page-平行链超级节点创建和超级账户管理介绍.0bc51ea7.js"><link rel="prefetch" href="/assets/js/page-执行器接口.9fbe576b.js"><link rel="prefetch" href="/assets/js/page-执行器模块.250093ef.js"><link rel="prefetch" href="/assets/js/page-技术架构.4bb976fc.js"><link rel="prefetch" href="/assets/js/page-挖矿接口.69ad9c9d.js"><link rel="prefetch" href="/assets/js/page-接口约定.405f0843.js"><link rel="prefetch" href="/assets/js/page-搭建平行链.bb5cb18e.js"><link rel="prefetch" href="/assets/js/page-文档主页.6e55bd60.js"><link rel="prefetch" href="/assets/js/page-智能合约.0976118a.js"><link rel="prefetch" href="/assets/js/page-术语介绍.b7238fda.js"><link rel="prefetch" href="/assets/js/page-查询余额.013fecbb.js"><link rel="prefetch" href="/assets/js/page-比特元主网环境配置.a6adfbb5.js"><link rel="prefetch" href="/assets/js/page-比特元简介.d1ab8669.js"><link rel="prefetch" href="/assets/js/page-比特元钱包操作手册.a050ecad.js"><link rel="prefetch" href="/assets/js/page-燃料消耗.a6c24bce.js"><link rel="prefetch" href="/assets/js/page-社区自治DAO.6d9a9a17.js"><link rel="prefetch" href="/assets/js/page-系统模块.1f7df7eb.js"><link rel="prefetch" href="/assets/js/page-系统要求.bbf5d857.js"><link rel="prefetch" href="/assets/js/page-网络类型.b2c9a866.js"><link rel="prefetch" href="/assets/js/page-账户模型.4e1c14bc.js"><link rel="prefetch" href="/assets/js/page-通证发行.45696e55.js"><link rel="prefetch" href="/assets/js/page-通过SDK与BTY公链交互.a8645b7a.js"><link rel="prefetch" href="/assets/js/page-部署区块链浏览器.2b614976.js"><link rel="prefetch" href="/assets/js/page-部署智能合约.36c97758.js"><link rel="prefetch" href="/assets/js/page-部署钱包.9d8dbab7.js"><link rel="prefetch" href="/assets/js/page-钱包找回合约.886b5372.js"><link rel="prefetch" href="/assets/js/page-钱包模块.cd857db9.js"><link rel="prefetch" href="/assets/js/page-错误码.4898d98a.js"><link rel="prefetch" href="/assets/js/page-隐私保护.de6587a2.js"><link rel="prefetch" href="/assets/js/page-零知识证明.3a983a3a.js"><link rel="prefetch" href="/assets/js/page-食品溯源案例.00fa3991.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.3721f523.js"><link rel="prefetch" href="/assets/js/vendors~mermaid.ab218c64.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.6a18d66a.js"><link rel="prefetch" href="/assets/js/vendors~reveal.9c56f7ec.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b9744494.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/zh/" class="home-link router-link-active"><img src="/logo.svg" alt="BitYuan" class="logo"> <!----> <span class="site-name can-hide">BitYuan</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><!----> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">主题模式:</label> <div class="darkmode-switch"><div class="switch"><input id="switch" type="checkbox" checked="checked" class="switch-input"> <label for="switch" class="label"><span class="label-content"></span></label></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/" class="nav-link router-link-active"><!---->
  主页
</a></div><div class="nav-item"><a href="/zh/guide/" class="nav-link router-link-active active"><!---->
  指南
</a></div></nav> <div class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" style="width:1rem;height:1rem;vertical-align:middle;margin-left:1rem;"><path d="M639.981 344.075c14.805 44.45 34.542 79.023 69.084 113.596 29.603-29.634 49.34-69.146 64.145-113.596H639.981zM314.33 591.024h128.29l-64.145-172.865-64.145 172.865z" fill="currentColor"></path> <path d="M807.746 116.882H215.643c-54.274 0-98.681 44.45-98.681 98.78v592.677c0 54.329 44.407 98.78 98.68 98.78h592.104c54.273 0 98.681-44.451 98.681-98.78V215.66c0-54.329-39.475-98.78-98.68-98.78zM565.971 754.01c-9.866 9.878-19.738 9.878-29.603 9.878-4.94 0-14.805 0-19.738-4.939-4.939-4.939-9.872 0-9.872-4.939s-4.932-9.878-9.865-19.756c-4.94-9.878-4.94-14.817-9.872-24.695L467.29 655.23H294.592l-19.737 54.33c-9.866 19.755-14.805 34.572-19.738 44.45-4.939 9.878-14.804 9.878-29.603 9.878-9.871 0-19.737-4.939-29.609-9.878-9.865-9.878-14.798-14.817-14.798-24.695 0-4.939 0-9.878 4.933-19.756 4.939-9.878 4.939-14.817 9.865-24.695l108.553-276.583c4.939-9.878 4.939-19.756 9.872-29.633 4.932-9.878 9.865-19.756 14.798-24.695 4.939-4.94 9.872-14.817 19.737-19.756 9.872-4.94 19.738-4.94 29.61-4.94 9.865 0 19.73 0 29.603 4.94 9.865 4.939 14.804 9.878 19.737 19.756 4.933 4.939 9.866 14.817 14.798 24.695 4.94 9.877 9.872 19.755 14.805 34.572l108.553 271.644c9.865 19.756 14.804 34.573 14.804 44.451-4.939 4.94-9.872 14.817-14.804 24.695zm271.378-192.62c-54.273-19.756-93.748-44.451-128.29-74.085-34.536 34.573-78.943 59.268-133.223 74.085l-14.798-24.695c54.273-14.817 98.68-34.573 133.223-69.146-34.542-34.573-64.145-79.024-74.017-128.413h-49.34V319.38h133.228c-9.877-14.817-19.743-34.573-29.609-49.39l14.799-4.94c9.871 14.818 24.676 34.574 34.542 54.33h123.35v24.695h-49.34c-14.798 49.39-39.468 93.84-69.077 123.474 34.541 29.634 74.01 54.329 128.29 69.146l-19.738 24.695z" fill="currentColor"></path></svg> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/" class="nav-link router-link-active"><!---->
  English
</a></li><li class="dropdown-item"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/" aria-current="page" class="nav-link router-link-exact-active router-link-active active"><!---->
  简体中文
</a></li></ul></div></div></div> <a rel="noopener noreferrer" href="https://github.com/bityuan/bty-docs" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/zh/" class="nav-link router-link-active"><!---->
  主页
</a></div><div class="nav-item"><a href="/zh/guide/" class="nav-link router-link-active active"><!---->
  指南
</a></div> <a rel="noopener noreferrer" href="https://github.com/bityuan/bty-docs" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/guide/" aria-current="page" class="sidebar-link">公链发展趋势</a></li><li><a href="/zh/guide/00/" class="sidebar-link">比特元简介</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">经济模型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">技术特色</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">开发入门</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">开发进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable open"><!----> <span class="title">去中心化应用</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/1.DAPP%E5%BC%80%E5%8F%91%E4%BB%8B%E7%BB%8D/" class="sidebar-link">DAPP 开发介绍</a></li><li><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/2.Go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/" class="sidebar-link">Go语言开发DAPP</a></li><li><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/3.Solidity%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/" class="sidebar-link">Solidity语言开发DAPP</a></li><li><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/" aria-current="page" class="active sidebar-link">JavaScript语言开发DAPP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#用javascript编写合约" class="sidebar-link">用JavaScript编写合约</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#定义存储结构" class="sidebar-link heading3">定义存储结构</a></li><li class="sidebar-sub-header"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#init函数" class="sidebar-link heading3">Init函数</a></li><li class="sidebar-sub-header"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#exec的xxxx方法" class="sidebar-link heading3">Exec的xxxx方法</a></li><li class="sidebar-sub-header"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#execlocal的xxxx方法" class="sidebar-link heading3">ExecLocal的xxxx方法</a></li><li class="sidebar-sub-header"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#query的xxxx方法" class="sidebar-link heading3">Query的xxxx方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#使用cli调试工具部署智能合约" class="sidebar-link">使用cli调试工具部署智能合约</a></li><li class="sidebar-sub-header"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#调用jsonrpc接口部署智能合约" class="sidebar-link">调用JSONRPC接口部署智能合约</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#部署一个jsvm合约-createtransaction" class="sidebar-link heading3">部署一个jsvm合约 CreateTransaction</a></li><li class="sidebar-sub-header"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#调用创建的jsvm合约的方法-createtransaction" class="sidebar-link heading3">调用创建的jsvm合约的方法  CreateTransaction</a></li><li class="sidebar-sub-header"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#查询创建的jsvm合约" class="sidebar-link heading3">查询创建的jsvm合约</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">区块链浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">钱包</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">API参考</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">案例介绍</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">JavaScript语言开发DAPP</span></h1> <div class="page-info"><!----> <!----><span aria-label="写作日期📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2023-5-26</span></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#用javascript编写合约" class="anchor-link heading2"><div>用JavaScript编写合约</div></a></li><li class="anchor"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#定义存储结构" class="anchor-link heading3"><div>定义存储结构</div></a></li><li class="anchor"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#init函数" class="anchor-link heading3"><div>Init函数</div></a></li><li class="anchor"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#exec的xxxx方法" class="anchor-link heading3"><div>Exec的xxxx方法</div></a></li><li class="anchor"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#execlocal的xxxx方法" class="anchor-link heading3"><div>ExecLocal的xxxx方法</div></a></li><li class="anchor"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#query的xxxx方法" class="anchor-link heading3"><div>Query的xxxx方法</div></a></li><li class="anchor"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#使用cli调试工具部署智能合约" class="anchor-link heading2"><div>使用cli调试工具部署智能合约</div></a></li><li class="anchor"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#调用jsonrpc接口部署智能合约" class="anchor-link heading2"><div>调用JSONRPC接口部署智能合约</div></a></li><li class="anchor"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#部署一个jsvm合约-createtransaction" class="anchor-link heading3"><div>部署一个jsvm合约 CreateTransaction</div></a></li><li class="anchor"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#调用创建的jsvm合约的方法-createtransaction" class="anchor-link heading3"><div>调用创建的jsvm合约的方法  CreateTransaction</div></a></li><li class="anchor"><a href="/zh/guide/06.%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BA%94%E7%94%A8/4.JavaScript%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91DAPP/#查询创建的jsvm合约" class="anchor-link heading3"><div>查询创建的jsvm合约</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="javascript语言开发dapp"><a href="#javascript语言开发dapp" class="header-anchor">#</a> JavaScript语言开发DAPP</h1> <blockquote><p>使用JavaScript语言进行DApp开发，首先要按照一定格式编写一个合约，然后可以使用cli调试工具或者调用JSON RPC接口将合约部署到链上，通过调用相应的方法完成想要的操作。</p></blockquote> <h2 id="用javascript编写合约"><a href="#用javascript编写合约" class="header-anchor">#</a> 用JavaScript编写合约</h2> <p>一般js文件包含如下规则:</p> <ul><li>定义Init(context)函数：该函数在部署合约时会被调用，作用是为一个合约准备资源，主要是存储对象kvcreator和上下文信息context。</li> <li>定义Exec对象的xxxx方法：将一些数据写入stateDB，并传递一些需要记录在表中的log信息。</li> <li>定义ExecLocal对象的xxxx：将log信息写入表或写入一些数据到localDB。</li> <li>定义Query对象的xxxx方法：查询表中的数据或者localDB中的数据。</li></ul> <blockquote><p>基于chain33的框架，通过jsvm的Call调用一个方法会依次执行对应的Exec对象和ExecLocal对象的同名方法，比如Call的payload.funcname为&quot;NewGame&quot;，就会依次执行Exec对象的NewGame方法和ExecLocal对象的NewGame方法。</p></blockquote> <p>下面结合示例合约<a href="https://github.com/33cn/plugin/blob/master/plugin/dapp/js/executor/game.js" target="_blank" rel="noopener noreferrer">game.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>具体介绍一下：</p> <p>game.js定义了一种猜数字的游戏，游戏规则：</p> <ul><li>庄家出一个0~10的数字hash(随机数+9) (一共的赔偿金额)。对应NewGame方法。</li> <li>用户可以猜这个数字，多个用户都可以猜测。对应Guess方法。</li> <li>开奖。对应CloseGame方法。</li></ul> <blockquote><p>下面仅以NewGame方法举例，另外两个方法可以参考上面链接的代码。</p></blockquote> <h3 id="定义存储结构"><a href="#定义存储结构" class="header-anchor">#</a> 定义存储结构</h3> <p>为了存储上述信息，需要创建三张表，一张GameLocalTable，一张MatchLocalTable，一张MatchGameTable。其中MatchGameTable是基于上述两表的连接表，类似于关系数据库的join操作产生的临时表。</p> <p>创建一张表包含config和defaultvalue两部分（创建连接表只需调用JoinTable方法即可）config设置表结构，包含表属性配置项（用#开头）和列属性配置两类，表属性有表名，主键和存储db类型三个。defaultvalue用于设置列属性的默认值。</p> <p>下面是创建GameLocalTable的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">GameLocalTable</span><span class="token punctuation">(</span><span class="token parameter">kvc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>config <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;#tablename&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;game&quot;</span><span class="token punctuation">,</span><span class="token comment">//定义表名</span>
        <span class="token string">&quot;#primary&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;gameid&quot;</span><span class="token punctuation">,</span> <span class="token comment">//定义主键</span>
        <span class="token string">&quot;#db&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;localdb&quot;</span><span class="token punctuation">,</span>            <span class="token comment">//定义存储的db类型，一般为localdb</span>
        <span class="token string">&quot;gameid&quot;</span>    <span class="token operator">:</span> <span class="token string">&quot;%018d&quot;</span><span class="token punctuation">,</span>  <span class="token comment">//表主键，游戏id，可以用交易总索引(txID())定义</span>
        <span class="token string">&quot;status&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;%d&quot;</span><span class="token punctuation">,</span>               <span class="token comment">//游戏状态：0-未开始，1-开始，2-关闭</span>
        <span class="token string">&quot;hash&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span>                  <span class="token comment">//交易hash</span>
        <span class="token string">&quot;addr&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span>                  <span class="token comment">//创建交易者的地址</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>defaultvalue <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;gameid&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">&quot;status&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">&quot;hash&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;addr&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Table</span><span class="token punctuation">(</span>kvc<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>defaultvalue<span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>下面是创建MatchLocalTable的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">MatchLocalTable</span><span class="token punctuation">(</span><span class="token parameter">kvc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>config <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;#tablename&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;match&quot;</span><span class="token punctuation">,</span>   <span class="token comment">//定义表名</span>
        <span class="token string">&quot;#primary&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>                  <span class="token comment">//定义主键</span>
        <span class="token string">&quot;#db&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;localdb&quot;</span><span class="token punctuation">,</span>                  <span class="token comment">//定义存储的db类型，一般为localdb</span>
        <span class="token string">&quot;id&quot;</span>    <span class="token operator">:</span> <span class="token string">&quot;%018d&quot;</span><span class="token punctuation">,</span>                   <span class="token comment">//表主键，可以用交易总索引(txID())定义</span>
        <span class="token string">&quot;gameid&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;%018d&quot;</span><span class="token punctuation">,</span>           <span class="token comment">//表外键，对应GameLocalTable表主键</span>
        <span class="token string">&quot;hash&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span>                         <span class="token comment">//交易hash</span>
        <span class="token string">&quot;addr&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span>                          <span class="token comment">//参与游戏的猜数字者的地址</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>defaultvalue <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;id&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">&quot;gameid&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">&quot;hash&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;addr&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Table</span><span class="token punctuation">(</span>kvc<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>defaultvalue<span class="token punctuation">)</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>下面是创建MatchGameTable的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">MatchGameTable</span><span class="token punctuation">(</span><span class="token parameter">kvc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//参数lefttable是使用外键的表，数据量相对较大，参数index是需要查询连接表的字段名</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JoinTable</span><span class="token punctuation">(</span><span class="token function">MatchLocalTable</span><span class="token punctuation">(</span>kvc<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">GameLocalTable</span><span class="token punctuation">(</span>kvc<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;addr#status&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="init函数"><a href="#init函数" class="header-anchor">#</a> Init函数</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Init</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>kvc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">kvcreator</span><span class="token punctuation">(</span><span class="token string">&quot;init&quot;</span><span class="token punctuation">)</span><span class="token comment">//创建init类型对象，用于存储key,value值</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context <span class="token comment">//保存上下文信息</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kvc<span class="token punctuation">.</span><span class="token function">receipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="exec的xxxx方法"><a href="#exec的xxxx方法" class="header-anchor">#</a> Exec的xxxx方法</h3> <p>此方法可以通过chain33-cli调试工具或JSONRPC的call方法调用到，xxxx与payload.funcname值一致。主要作用是通过kvc.add()将一些信息写入stateDB，通过kvc.addlog()传递log信息。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Exec</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">NewGame</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
    <span class="token keyword">var</span> game <span class="token operator">=</span> <span class="token punctuation">{</span>__type__ <span class="token operator">:</span> <span class="token string">&quot;game&quot;</span><span class="token punctuation">}</span>
    game<span class="token punctuation">.</span>gameid <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">txID</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>height
    game<span class="token punctuation">.</span>randhash <span class="token operator">=</span> args<span class="token punctuation">.</span>randhash
    game<span class="token punctuation">.</span>bet <span class="token operator">=</span> args<span class="token punctuation">.</span>bet
    game<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>txhash
    game<span class="token punctuation">.</span>obet <span class="token operator">=</span> game<span class="token punctuation">.</span>bet
    game<span class="token punctuation">.</span>addr <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>from
    game<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">//open</span>
    <span class="token comment">//最大值是 9000万,否则js到 int 会溢出</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>game<span class="token punctuation">.</span>bet <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token constant">COINS</span> <span class="token operator">||</span> game<span class="token punctuation">.</span>bet <span class="token operator">&gt;</span> <span class="token number">10000000</span> <span class="token operator">*</span> <span class="token constant">COINS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">throwerr</span><span class="token punctuation">(</span><span class="token string">&quot;bet low than 10 or hight than 10000000&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>kvc<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>randhash<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//如果randhash 已经被使用了</span>
        <span class="token function">throwerr</span><span class="token punctuation">(</span><span class="token string">&quot;dup rand hash&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> err <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>acc<span class="token punctuation">.</span><span class="token function">execFrozen</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>from<span class="token punctuation">,</span> game<span class="token punctuation">.</span>bet<span class="token punctuation">)</span>    <span class="token comment">//冻结庄家的奖池</span>
    <span class="token function">throwerr</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>kvc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>gameid<span class="token punctuation">,</span> game<span class="token punctuation">)</span>  <span class="token comment">//存储key:gameid与value:game到stateDB</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>kvc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>randhash<span class="token punctuation">,</span> <span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token comment">//存储key:randhash与value:&quot;ok&quot;到stateDB</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>kvc<span class="token punctuation">.</span><span class="token function">addlog</span><span class="token punctuation">(</span>game<span class="token punctuation">)</span>  <span class="token comment">//传递game对象到ExecLocal.prototype.NewGame</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kvc<span class="token punctuation">.</span><span class="token function">receipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="execlocal的xxxx方法"><a href="#execlocal的xxxx方法" class="header-anchor">#</a> ExecLocal的xxxx方法</h3> <p>此方法将对应的Exec的xxxx方法传递的log信息写入到对应的表中，或者调用kvc.add()直接将数据写入stateDB。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">localprocess</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> local <span class="token operator">=</span> <span class="token function">MatchGameTable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>kvc<span class="token punctuation">)</span>
    local<span class="token punctuation">.</span><span class="token function">addlogs</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logs<span class="token punctuation">)</span>   <span class="token comment">//操作join表，达到自动更新关联表的目的</span>
    local<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment">//保存数据</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kvc<span class="token punctuation">.</span><span class="token function">receipt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token class-name">ExecLocal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">NewGame</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">localprocess</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="query的xxxx方法"><a href="#query的xxxx方法" class="header-anchor">#</a> Query的xxxx方法</h3> <p>此方法可以通过chain33-cli调试工具或JSONRPC的query方法调用到，xxxx与payload.funcname值一致，实现按照传入参数查询数据的功能，可以通过表进行查询，也可以直接查询localDB。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//提供按照游戏创建者地址查询game信息</span>
<span class="token class-name">Query</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">ListGameByAddr</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> local <span class="token operator">=</span> <span class="token function">GameLocalTable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>kvc<span class="token punctuation">)</span>
    <span class="token keyword">var</span> q <span class="token operator">=</span> local<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;addr&quot;</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span>addr<span class="token punctuation">,</span> args<span class="token punctuation">.</span>primaryKey<span class="token punctuation">,</span> args<span class="token punctuation">.</span>count<span class="token punctuation">,</span> args<span class="token punctuation">.</span>direction<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">querytojson</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="使用cli调试工具部署智能合约"><a href="#使用cli调试工具部署智能合约" class="header-anchor">#</a> 使用cli调试工具部署智能合约</h2> <p>chain33-cli是我们的调试程序，使用chain33-cli命令可以方便的完成一些操作，下面演示使用chain33-cli命令部署智能合约到chain33链上以及调用智能合约中的方法。</p> <hr> <blockquote><p>**step1:**使用chain33-cli命令将智能合约部署到chain33链上：</p></blockquote> <div class="language- extra-class"><pre><code>./chain33-cli send jsvm create -c &quot;合约代码文件的路径&quot; -n &quot;合约名&quot; -k &quot;合约创建者的私钥或者地址&quot;

root@ubuntu055-3:/home/lcj0# ./chain33-cli send jsvm create -c &quot;/home/hugo/game.js&quot; -n game -k 14KEKbYtKKQm4wMthSK9J4La4nAiidGozt
</code></pre></div><hr> <blockquote><p>**step2：**上面的合约代码部署成功后，会生成一个交易哈希，然后使用此哈希查询交易：</p></blockquote> <div class="language- extra-class"><pre><code>./chain33-cli tx query_hash -s &quot;交易哈希&quot;

root@ubuntu055-3:/home/lcj0# ./chain33-cli tx query_hash -s 0xd4cfd1606ea1d9382b3334351e3e741cad8a68b4e7b38a4b02c981203865cb03
</code></pre></div><ul><li>在返回的结果可以看到如下：其中name 合约名称，涉及到合约转账或取回操作时要使用此名称；code是js文件内容；</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code>...
<span class="token property">&quot;execer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jsvm&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;payload&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;create&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;...js文件内容...&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;game&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ty&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><hr> <blockquote><p>**step3:**向合约充值</p></blockquote> <p>由于game合约需要创建游戏者(庄家)首先抵押一些资产做奖池，所以需要先充值到合约中，通过命令行充100 BTY到合约中，注意-e 参数必须是&quot;user.jsvm.合约名&quot;的形式。</p> <div class="language- extra-class"><pre><code>./chain33-cli send coins send_exec -a BTY个数 -e &quot;合约名&quot; -n &quot;附言&quot; -k &quot;合约创建者的私钥或者地址&quot;

./chain33-cli send coins send_exec -a 100 -e &quot;user.jsvm.game&quot; -n &quot;12312&quot; -k 14KEKbYtKKQm4wMthSK9J4La4nAiidGozt
</code></pre></div><blockquote><p>使用查询交易命令查询充值是否成功。</p></blockquote> <div class="language- extra-class"><pre><code>./chain33-cli tx query_hash -s 0xa627e07e3ba7c47fd2e16812b34f82d6e07c6c074d2043abdb6b2d57dc9b4d4b
</code></pre></div><div class="language-json line-numbers-mode"><pre class="language-json"><code>...
    <span class="token property">&quot;ty&quot;</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token property">&quot;tyName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LogExecDeposit&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;log&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;execAddr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;15mjHYNvPkSMrp3SQxtczXL6cinMAEdeKs&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;prev&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;currency&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">&quot;balance&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;frozen&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;addr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;14KEKbYtKKQm4wMthSK9J4La4nAiidGozt&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;currency&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">&quot;balance&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10000000000&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;frozen&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;addr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;14KEKbYtKKQm4wMthSK9J4La4nAiidGozt&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 ...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>可以看到current.balance为100* 1e8</p> <hr> <blockquote><p>**step4:**充值完成后，调用合约中的NewGame方法创建游戏。</p></blockquote> <div class="language- extra-class"><pre><code>./chain33-cli send jsvm call -n &quot;合约名&quot; -f  &quot;方法名&quot; -a &quot;以json格式表示的参数列表&quot; -k &quot;合约创建者的私钥或者地址&quot;

./chain33-cli send jsvm call -n game -f NewGame -a &quot;{\&quot;bet\&quot;:1500000000, \&quot;randhash\&quot;:\&quot;0x5d2ac15654aa1859af80d1dfa5d7a5775c359fe3a49abce03796f4fbc313b57f\&quot;}&quot; -k 14KEKbYtKKQm4wMthSK9J4La4nAiidGozt
</code></pre></div><blockquote><p>使用查询交易命令查询是否创建成功。</p></blockquote> <div class="language-json line-numbers-mode"><pre class="language-json"><code>...
    <span class="token property">&quot;ty&quot;</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
    <span class="token property">&quot;tyName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LogExecFrozen&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;log&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;execAddr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;15mjHYNvPkSMrp3SQxtczXL6cinMAEdeKs&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;prev&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;currency&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">&quot;balance&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10000000000&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;frozen&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;addr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;14KEKbYtKKQm4wMthSK9J4La4nAiidGozt&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;currency&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">&quot;balance&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8500000000&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;frozen&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1500000000&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;addr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;14KEKbYtKKQm4wMthSK9J4La4nAiidGozt&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>可以看到冻结量：current.frozen为15* 1e8，剩余量：current.balance为85* 1e8</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>...
    <span class="token property">&quot;ty&quot;</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
    <span class="token property">&quot;tyName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;TyLogJs&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;log&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\&quot;__type__\&quot;:\&quot;game\&quot;,\&quot;addr\&quot;:\&quot;14KEKbYtKKQm4wMthSK9J4La4nAiidGozt\&quot;,\&quot;bet\&quot;:1500000000,\&quot;gameid\&quot;:4100000,\&quot;hash\&quot;:\&quot;0x2b3e9d1bd4dfcd6766f6aacc366d8e360e9896de1cc4da0501b30d696a506d2a\&quot;,\&quot;height\&quot;:41,\&quot;obet\&quot;:1500000000,\&quot;randhash\&quot;:\&quot;0x5d2ac15654aa1859af80d1dfa5d7a5775c359fe3a49abce03796f4fbc313b57f\&quot;,\&quot;status\&quot;:1}&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>可以看到游戏创建成功了，gameid为4100000。然后可以使用同样的方法，调用合约中的Guess方法和CloseGame方法来猜数字和开奖，不在此赘述。</p> <hr> <blockquote><p><strong>step5:</strong> 调用查询接口列出由某个地址创建的游戏</p></blockquote> <div class="language- extra-class"><pre><code>./chain33-cli jsvm query -a &quot;以json格式表示的参数列表&quot; -f &quot;方法名&quot; -n &quot;合约名&quot;

./chain33-cli jsvm query -a &quot;{\&quot;addr\&quot;:\&quot;14KEKbYtKKQm4wMthSK9J4La4nAiidGozt\&quot;, \&quot;count\&quot;:20}&quot; -f &quot;ListGameByAddr&quot; -n game
</code></pre></div><p>返回内容如下：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;[{\&quot;left\&quot;:{\&quot;__type__\&quot;:\&quot;game\&quot;,\&quot;addr\&quot;:\&quot;14KEKbYtKKQm4wMthSK9J4La4nAiidGozt\&quot;,\&quot;bet\&quot;:1500000000,\&quot;gameid\&quot;:4100000,\&quot;hash\&quot;:\&quot;0x2b3e9d1bd4dfcd6766f6aacc366d8e360e9896de1cc4da0501b30d696a506d2a\&quot;,\&quot;height\&quot;:41,\&quot;obet\&quot;:1500000000,\&quot;randhash\&quot;:\&quot;0x5d2ac15654aa1859af80d1dfa5d7a5775c359fe3a49abce03796f4fbc313b57f\&quot;,\&quot;status\&quot;:1}}]&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>可以使用相同的方法调用ListMatchByAddr方法，列举出某地址创建的处于某种状态的游戏，由于用到连表查询，需要先通过方法JoinKey查到结果，再将结果作为参数，调用ListMatchByAddr方法获得最终结果。</p></blockquote> <h2 id="调用jsonrpc接口部署智能合约"><a href="#调用jsonrpc接口部署智能合约" class="header-anchor">#</a> 调用JSONRPC接口部署智能合约</h2> <h3 id="部署一个jsvm合约-createtransaction"><a href="#部署一个jsvm合约-createtransaction" class="header-anchor">#</a> 部署一个jsvm合约 CreateTransaction</h3> <blockquote><p>这里创建的是原始交易，除此之外，还需要进行交易的签名以及发送操作
如果合约中要使用数字货币，在调用合约前需要先向合约充值</p></blockquote> <p><strong>请求报文：</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Chain33.CreateTransaction&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;execer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;actionName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;payload&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;string&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span>int32<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>参数说明：</strong></p> <table><thead><tr><th>参数</th> <th>类型</th> <th>是否必填</th> <th>说明</th></tr></thead> <tbody><tr><td>execer</td> <td>string</td> <td>是</td> <td>执行器名称，这里固定为jsvm</td></tr> <tr><td>actionName</td> <td>string</td> <td>是</td> <td>操作名称，这里固定为Create</td></tr> <tr><td>payload.code</td> <td>string</td> <td>是</td> <td>javascript代码</td></tr> <tr><td>payload.name</td> <td>string</td> <td>是</td> <td>合约名</td></tr></tbody></table> <p><strong>响应报文：</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span>int32<span class="token punctuation">,</span>
    <span class="token property">&quot;result&quot;</span><span class="token operator">:</span><span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;error&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>参数说明：</strong></p> <table><thead><tr><th>参数</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>result</td> <td>string</td> <td>交易内容十六进制字符串</td></tr></tbody></table> <p><strong>示例：</strong>
Request1 部署合约交易:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Chain33.CreateTransaction&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;execer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jsvm&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;actionName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Create&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;payload&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;//........................\n//............: ............... 0 - 10 ......... hash(......... + 9) (.....................) NewGame()\n//............................................................ Guess()\n//...... CloseGame()\nfunction Init(context) {\n    this.kvc = new kvcreator(\&quot;init\&quot;)\n    this.context = context\n    return this.kvc.receipt()\n}\n\nvar MIN_WAIT_BLOCK = 2\nvar RAND_MAX = 10\n\nfunction ExecInit() {\n    this.acc = new account(this.kvc, \&quot;coins\&quot;, \&quot;bty\&quot;)\n}\n\nExec.prototype.NewGame = function(args) {\n    var game = {__type__ : \&quot;game\&quot;}\n    game.gameid = this.txID()\n    game.height = this.context.height\n    game.randhash = args.randhash\n    game.bet = args.bet\n    game.hash = this.context.txhash\n    game.obet = game.bet\n    game.addr = this.context.from\n    game.status = 1 //open\n    //............ 9000...,......js... int .........\n    if (game.bet &lt; 10 * COINS || game.bet &gt; 10000000 * COINS) {\n        throwerr(\&quot;bet low than 10 or hight than 10000000\&quot;)\n    }\n    if (this.kvc.get(game.randhash)) { //......randhash ..................\n        throwerr(\&quot;dup rand hash\&quot;)\n    }\n    var err = this.acc.execFrozen(this.name, this.context.from, game.bet)\n    throwerr(err)\n    this.kvc.add(game.gameid, game)\n    this.kvc.add(game.randhash, \&quot;ok\&quot;)\n    this.kvc.addlog(game)\n    return this.kvc.receipt()\n}\n\nExec.prototype.Guess = function(args) {\n    var match = {__type__ : \&quot;match\&quot;}\n    match.gameid = args.gameid\n    match.bet = args.bet\n    match.id = this.txID()\n    match.addr = this.context.from\n    match.hash = this.context.txhash\n    match.num = args.num\n    var game = this.kvc.get(match.gameid)\n    if (!game) {\n        throwerr(\&quot;guess: game id not found\&quot;)\n    }\n    if (game.status != 1) {\n        throwerr(\&quot;guess: game status not open\&quot;)\n    }\n    if (this.context.from == game.addr) {\n        throwerr(\&quot;guess: game addr and match addr is same\&quot;)\n    }\n    if (match.bet &lt; 1 * COINS || match.bet &gt; game.bet / RAND_MAX) {\n        throwerr(\&quot;match bet litte than 1 or big than game.bet/10\&quot;)\n    }\n    var err = this.acc.execFrozen(this.name, this.context.from, match.bet)\n    console.log(this.name, this.context.from, err)\n    throwerr(err)\n    this.kvc.add(match.id, match)\n    this.kvc.addlog(match)\n    return this.kvc.receipt()\n}\n\nExec.prototype.CloseGame = function(args) {\n    var local = MatchLocalTable(this.kvc)\n    var game = this.kvc.get(args.gameid)\n    if (!game) {\n        throwerr(\&quot;game id not found\&quot;)\n    }\n    var querykey = local.get(\&quot;gameid\&quot;, args)\n    var matches = local.query(\&quot;gameid\&quot;, querykey, \&quot;\&quot;, 0, 1)\n    if (!matches) {\n        matches = []\n    }\n    var n = -1\n    for (var i = 0; i &lt; RAND_MAX; i++) {\n        if (Sha256(args.randstr + i) == game.randhash) {\n            n = i\n        }\n    }\n    if (n == -1) {\n        throwerr(\&quot;err rand str\&quot;)\n    }\n    //.........................................................\n    if (this.context.height - game.height &lt; MIN_WAIT_BLOCK) {\n        throwerr(\&quot;close game must wait \&quot;+MIN_WAIT_BLOCK+\&quot; block\&quot;)\n    }\n    for (var i = 0; i &lt; matches.length; i++) {\n        var match = matches[i].left\n        if (match.num == n) {\n            //................................................................................................ this\n            win.call(this, game, match)\n        } else {\n            fail.call(this, game, match)\n        }\n    }\n    if (game.bet &gt; 0) {\n        var err = this.acc.execActive(this.name, game.addr, game.bet)\n        throwerr(err)\n        game.bet = 0\n    }\n    game.status = 2\n    this.kvc.add(game.gameid, game)\n    this.kvc.addlog(game)\n    return this.kvc.receipt()\n}\n\nfunction win(game, match) {\n    var amount = (RAND_MAX - 1) * match.bet\n    if (game.bet - amount &lt; 0) {\n        amount = game.bet\n    }\n    var err \n    if (amount &gt; 0) {\n        err = this.acc.execTransFrozenToActive(this.name, game.addr, match.addr, amount)\n        throwerr(err, \&quot;execTransFrozenToActive\&quot;)\n        game.bet -= amount\n    }\n    err = this.acc.execActive(this.name, match.addr, match.bet)\n    throwerr(err, \&quot;execActive\&quot;)\n}\n\nfunction fail(game, match) {\n    var amount = match.bet\n    err = this.acc.execTransFrozenToFrozen(this.name, match.addr, game.addr, amount)\n    throwerr(err)\n    game.bet += amount\n}\n\nExec.prototype.ForceCloseGame = function(args) {\n    var local = new MatchLocalTable(this.kvc)\n    var game = this.kvc.get(args.id)\n    if (!game) {\n        throwerr(\&quot;game id not found\&quot;)\n    }\n    var matches = local.getmath(args.id)\n    if (!matches) {\n        matches = []\n    }\n    if (this.context.height - game.height &lt; 100) {\n        throwerr(\&quot;force close game must wait 100 block\&quot;)\n    }\n    for (var i = 0; i &lt; matches.length; i++) {\n        var match = matches[i]\n        win.call(this.kvc, game, match)\n    }\n    if (game.bet &gt; 0) {\n        var err = this.acc.execActive(this.name, game.addr, game.bet)\n        throwerr(err)\n        game.bet = 0\n    }\n    game.status = 2\n    this.kvc.add(game.gameid, game)\n    this.kvc.addlog(game)\n    return this.kvc.receipt()\n}\n\nExecLocal.prototype.NewGame = function(args) {\n    return localprocess.call(this, args)\n}\n\nExecLocal.prototype.Guess = function(args) {\n    return localprocess.call(this, args)\n}\n\nExecLocal.prototype.CloseGame = function(args) {\n    return localprocess.call(this, args)\n}\n\nExecLocal.prototype.ForceCloseGame = function(args) {\n    return localprocess.call(this, args)\n}\n\nfunction localprocess(args) {\n    var local = MatchGameTable(this.kvc)\n    local.addlogs(this.logs)\n    local.save()\n    return this.kvc.receipt()\n}\n\nQuery.prototype.ListGameByAddr = function(args) {\n    var local = GameLocalTable(this.kvc)\n    var q = local.query(\&quot;addr\&quot;, args.addr, args.primaryKey, args.count, args.direction)\n    return querytojson(q)\n}\n\nQuery.prototype.ListMatchByAddr = function(args) {\n    var local = MatchGameTable(this.kvc)\n    var q= local.query(\&quot;addr#status\&quot;, args[\&quot;addr#status\&quot;], args.primaryKey, args.count, args.direction)\n    return querytojson(q)\n}\n\nfunction GameLocalTable(kvc) {\n    this.config = {\n        \&quot;#tablename\&quot; : \&quot;game\&quot;,\n        \&quot;#primary\&quot; : \&quot;gameid\&quot;,\n        \&quot;#db\&quot; : \&quot;localdb\&quot;,\n        \&quot;gameid\&quot;    : \&quot;%018d\&quot;,\n        \&quot;status\&quot; : \&quot;%d\&quot;,\n        \&quot;hash\&quot; : \&quot;%s\&quot;,\n        \&quot;addr\&quot; : \&quot;%s\&quot;,\n    }\n    this.defaultvalue = {\n        \&quot;gameid\&quot; : 0,\n        \&quot;status\&quot; : 0,\n        \&quot;hash\&quot; : \&quot;\&quot;,\n        \&quot;addr\&quot; : \&quot;\&quot;,\n    }\n    return new Table(kvc, this.config, this.defaultvalue) \n}\n\nfunction MatchLocalTable(kvc) {\n    this.config = {\n        \&quot;#tablename\&quot; : \&quot;match\&quot;,\n        \&quot;#primary\&quot; : \&quot;id\&quot;,\n        \&quot;#db\&quot; : \&quot;localdb\&quot;,\n        \&quot;id\&quot;    : \&quot;%018d\&quot;,\n        \&quot;gameid\&quot; : \&quot;%018d\&quot;,\n        \&quot;hash\&quot; : \&quot;%s\&quot;,\n        \&quot;addr\&quot; : \&quot;%s\&quot;,\n    }\n    this.defaultvalue = {\n        \&quot;id\&quot; : 0,\n        \&quot;gameid\&quot; : 0,\n        \&quot;hash\&quot; : \&quot;\&quot;,\n        \&quot;addr\&quot; : \&quot;\&quot;,\n    }\n    return new Table(kvc, this.config, this.defaultvalue)  \n}\n\nfunction MatchGameTable(kvc) {\n    return new JoinTable(MatchLocalTable(kvc), GameLocalTable(kvc), \&quot;addr#status\&quot;)\n}\n&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;game&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="调用创建的jsvm合约的方法-createtransaction"><a href="#调用创建的jsvm合约的方法-createtransaction" class="header-anchor">#</a> 调用创建的jsvm合约的方法  CreateTransaction</h3> <p><strong>请求报文：</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Chain33.CreateTransaction&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
        <span class="token property">&quot;execer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;actionName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;payload&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;funcname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>参数说明：</strong></p> <table><thead><tr><th>参数</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>execer</td> <td>string</td> <td>合约名字，固定格式为user.jsvm.xxxx</td></tr> <tr><td>actionName</td> <td>string</td> <td>调用，这里固定为Call</td></tr> <tr><td>payload.name</td> <td>string</td> <td>合约名字，之前定义的名字</td></tr> <tr><td>payload.funcname</td> <td>string</td> <td>调用的方法名</td></tr> <tr><td>payload.args</td> <td>string</td> <td>参数列表</td></tr></tbody></table> <p><strong>响应报文：</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span>int32<span class="token punctuation">,</span>
    <span class="token property">&quot;result&quot;</span><span class="token operator">:</span><span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;error&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>参数说明：</strong></p> <table><thead><tr><th>参数</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>result</td> <td>string</td> <td>交易内容十六进制字符串</td></tr></tbody></table> <p><strong>示例：</strong>
Request：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Chain33.CreateTransaction&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
        <span class="token property">&quot;execer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user.jsvm.game&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;actionName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Call&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;payload&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;game&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;funcname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NewGame&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\&quot;bet\&quot;:10000000000, \&quot;randhash\&quot;:\&quot;0x5d2ac15654aa1859af80d1dfa5d7a5775c359fe3a49abce03796f4fbc313b57f\&quot;}&quot;</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>Response:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0a0e757365722e6a73766d2e67616d651279180112750a0467616d6512074e657747616d651a647b22626574223a31303030303030303030302c202272616e6468617368223a22307835643261633135363534616131383539616638306431646661356437613537373563333539666533613439616263653033373936663466626333313362353766227d20a08d0630ae97b68eead9ec99083a2231356d6a48594e76506b534d72703353517874637a584c3663696e4d414564654b73&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="查询创建的jsvm合约"><a href="#查询创建的jsvm合约" class="header-anchor">#</a> 查询创建的jsvm合约</h3> <p><strong>请求报文：</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Chain33.Query&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;execer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;funcName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;payload&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;funcname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\&quot;addr\&quot;:\&quot;14KEKbYtKKQm4wMthSK9J4La4nAiidGozt\&quot;, \&quot;count\&quot;:20}&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>参数说明：</strong></p> <table><thead><tr><th>参数</th> <th>类型</th> <th>是否必填</th> <th>说明</th></tr></thead> <tbody><tr><td>execer</td> <td>string</td> <td>是</td> <td>执行器名称，这里固定为jsvm</td></tr> <tr><td>funcName</td> <td>string</td> <td>是</td> <td>操作名称，这里固定为Query</td></tr> <tr><td>payload.name</td> <td>string</td> <td>是</td> <td>合约名</td></tr> <tr><td>payload.funcname</td> <td>string</td> <td>是</td> <td>javascript中定义的查询方法名</td></tr> <tr><td>payload.args</td> <td>string</td> <td>是</td> <td>javascript中定义的查询方法的参数列表，用json格式表示</td></tr></tbody></table> <p><strong>响应报文：</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> int32<span class="token punctuation">,</span>
  <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>参数说明：</strong></p> <table><thead><tr><th>参数</th> <th>类型说明</th></tr></thead> <tbody><tr><td>result.data</td> <td>string</td></tr></tbody></table> <p><strong>示例：</strong>
Request：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Chain33.Query&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;execer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jsvm&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;funcName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Query&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;payload&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;game&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;funcname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ListGameByAddr&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\&quot;addr\&quot;:\&quot;14KEKbYtKKQm4wMthSK9J4La4nAiidGozt\&quot;, \&quot;count\&quot;:20}&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Response：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;[{\&quot;left\&quot;:{\&quot;__type__\&quot;:\&quot;game\&quot;,\&quot;addr\&quot;:\&quot;14KEKbYtKKQm4wMthSK9J4La4nAiidGozt\&quot;,\&quot;bet\&quot;:10000000000,\&quot;gameid\&quot;:121400000,\&quot;hash\&quot;:\&quot;0xd3894f7ab60a535d8de47f8a5e06d7c127a22bfe9ff8f1e00971fae19091126f\&quot;,\&quot;height\&quot;:1214,\&quot;obet\&quot;:10000000000,\&quot;randhash\&quot;:\&quot;0x5d2ac15654aa1859af80d1dfa5d7a5775c359fe3a49abce03796f4fbc313b57f\&quot;,\&quot;status\&quot;:1}}]&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/bityuan/bty-docs/edit/main/zh/guide/06.去中心化应用/4.JavaScript语言开发DAPP.md" target="_blank" rel="noopener noreferrer">编辑此页</a></div> <div class="meta-item update-time"><span class="label">上次编辑于:</span> <span class="info">2023年5月26日 16:48</span></div> <!----></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.0ace8b6b.js" defer></script><script src="/assets/js/vendors~layout-Layout.9cca5321.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.273fc434.js" defer></script><script src="/assets/js/page-JavaScript语言开发DAPP.9516e8f2.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.4a182f2f.js" defer></script>
  </body>
</html>
