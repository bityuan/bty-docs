<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>执行器模块 | BitYuan</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="A demo for vuepress-theme-hope">
    <meta property="og:url" content="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97.html">
    <meta property="og:site_name" content="BitYuan">
    <meta property="og:title" content="执行器模块">
    <meta property="og:description" content="执行器模块 模块介绍 顾名思义，执行器模块主要是用于执行逻辑的。在区块链中，所有的数据都是通过交易生成的，这些数据按照一定的规则，组装成一个个区块，最终形成一个完整的区块链条。 而在一个完整的区块链系统中，交易的执行是核心，比如一次A到B的转账交易，A账户的余额会减少，B账户的余额会增加，这个账户余额变更的逻辑就是执行器要执行的内容。 拿智能合约来说，合约中">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh-CN">
    <meta property="og:locale:alternate" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="BitYuan">
    
    <link rel="preload" href="/assets/css/0.styles.b9744494.css" as="style"><link rel="preload" href="/assets/js/app.f3c503cb.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.1136eb17.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.273fc434.js" as="script"><link rel="preload" href="/assets/js/page-执行器模块.a346e5c7.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.4a182f2f.js" as="script"><link rel="prefetch" href="/assets/js/151.65f190ce.js"><link rel="prefetch" href="/assets/js/152.006f379e.js"><link rel="prefetch" href="/assets/js/153.553b1bfd.js"><link rel="prefetch" href="/assets/js/154.14d5e117.js"><link rel="prefetch" href="/assets/js/155.0f1cee54.js"><link rel="prefetch" href="/assets/js/layout-Blog.06a4aba6.js"><link rel="prefetch" href="/assets/js/layout-Layout.85d11602.js"><link rel="prefetch" href="/assets/js/layout-NotFound.08f6c85c.js"><link rel="prefetch" href="/assets/js/layout-Slide.ac4b19ea.js"><link rel="prefetch" href="/assets/js/page-AccountModel.af5b1417.js"><link rel="prefetch" href="/assets/js/page-BalanceInquiry.de0f9215.js"><link rel="prefetch" href="/assets/js/page-BitYuanIntroduction.8d32e84b.js"><link rel="prefetch" href="/assets/js/page-BitYuanMainNetworkEnvironmentConfiguration.c204121b.js"><link rel="prefetch" href="/assets/js/page-BitYuanWalletGuidelines.53538f07.js"><link rel="prefetch" href="/assets/js/page-BlockchainInterface.dbbaa1c5.js"><link rel="prefetch" href="/assets/js/page-BlockchainModule.924f231b.js"><link rel="prefetch" href="/assets/js/page-Blockchain模块.6d393d61.js"><link rel="prefetch" href="/assets/js/page-Buildparachain.da9f3c57.js"><link rel="prefetch" href="/assets/js/page-CA工具使用说明.a163d347.js"><link rel="prefetch" href="/assets/js/page-CA服务使用说明.0af37bfb.js"><link rel="prefetch" href="/assets/js/page-CaseFoodTraceability.a394947e.js"><link rel="prefetch" href="/assets/js/page-Chain33系统接口.f4ba2ad9.js"><link rel="prefetch" href="/assets/js/page-CompatiblewithEthereumEVM.db7fcc50.js"><link rel="prefetch" href="/assets/js/page-ConsensusModule.ed492200.js"><link rel="prefetch" href="/assets/js/page-CreateBitYuanparentBlockchain.ef5730f3.js"><link rel="prefetch" href="/assets/js/page-DAPPdevelopmentinGolanguage.99bf9af5.js"><link rel="prefetch" href="/assets/js/page-DAPPdevelopmentinJavaScriptlanguage.6d351f8c.js"><link rel="prefetch" href="/assets/js/page-DAPPdevelopmentinSoliditylanguage.d0eb1641.js"><link rel="prefetch" href="/assets/js/page-DAPP开发介绍.e188e97d.js"><link rel="prefetch" href="/assets/js/page-DecentralizedApplication.c40d4a48.js"><link rel="prefetch" href="/assets/js/page-Deployblockchainbrowser.62c77586.js"><link rel="prefetch" href="/assets/js/page-Deploysmartcontract.087be624.js"><link rel="prefetch" href="/assets/js/page-Deploywallet.e50f490c.js"><link rel="prefetch" href="/assets/js/page-Dockingwithexternalapplication.251c0f95.js"><link rel="prefetch" href="/assets/js/page-EVMInterface.82c08659.js"><link rel="prefetch" href="/assets/js/page-EVM接口.63d7113c.js"><link rel="prefetch" href="/assets/js/page-EventInterface.171c1008.js"><link rel="prefetch" href="/assets/js/page-ExecutorInterface.f4ff4019.js"><link rel="prefetch" href="/assets/js/page-ExecutorModule.3e9258c5.js"><link rel="prefetch" href="/assets/js/page-GRPC接口约定.11cc8ee5.js"><link rel="prefetch" href="/assets/js/page-Go语言开发DAPP.2a64b3ed.js"><link rel="prefetch" href="/assets/js/page-InterfaceContract.0180a8ed.js"><link rel="prefetch" href="/assets/js/page-IntroductiontoDAppDevelopment.79ef11fb.js"><link rel="prefetch" href="/assets/js/page-JavaScript语言开发DAPP.2e642631.js"><link rel="prefetch" href="/assets/js/page-Manage.950bbcea.js"><link rel="prefetch" href="/assets/js/page-ManageInterface.3a9e6ab9.js"><link rel="prefetch" href="/assets/js/page-MempoolInterface.572b8c83.js"><link rel="prefetch" href="/assets/js/page-MempoolModule.ef0b251d.js"><link rel="prefetch" href="/assets/js/page-Mempool接口.0feea304.js"><link rel="prefetch" href="/assets/js/page-Mempool模块.a1a38d34.js"><link rel="prefetch" href="/assets/js/page-MiningInterface.cd70ef6a.js"><link rel="prefetch" href="/assets/js/page-NetworkType.f4f3c8b5.js"><link rel="prefetch" href="/assets/js/page-P2PModule.6a383b2b.js"><link rel="prefetch" href="/assets/js/page-P2P模块.482c4cce.js"><link rel="prefetch" href="/assets/js/page-ParachainTokenIssuance.7ac004d1.js"><link rel="prefetch" href="/assets/js/page-Project.bcf5d8a0.js"><link rel="prefetch" href="/assets/js/page-QueueModule.eae700a7.js"><link rel="prefetch" href="/assets/js/page-Queue模块.59fcecd5.js"><link rel="prefetch" href="/assets/js/page-RPCModule.6cc51207.js"><link rel="prefetch" href="/assets/js/page-RPC接口编程样例.21b82c3a.js"><link rel="prefetch" href="/assets/js/page-RPC模块.1683ee51.js"><link rel="prefetch" href="/assets/js/page-SPOSConsensus.3e53cf49.js"><link rel="prefetch" href="/assets/js/page-SPOS共识.4aea894f.js"><link rel="prefetch" href="/assets/js/page-SmartContract.b5d92460.js"><link rel="prefetch" href="/assets/js/page-Solidity语言开发DAPP.17501dcd.js"><link rel="prefetch" href="/assets/js/page-StorageModule.492b47c3.js"><link rel="prefetch" href="/assets/js/page-StorageSharding.290c613c.js"><link rel="prefetch" href="/assets/js/page-SystemInterface.132c89fd.js"><link rel="prefetch" href="/assets/js/page-SystemModule.71975ad1.js"><link rel="prefetch" href="/assets/js/page-TechnicalArchitecture.2a97fea3.js"><link rel="prefetch" href="/assets/js/page-Terminology.6a02d524.js"><link rel="prefetch" href="/assets/js/page-TokenInterface.d9f4177a.js"><link rel="prefetch" href="/assets/js/page-Token接口.bcf7d3f3.js"><link rel="prefetch" href="/assets/js/page-Trade.43166b5b.js"><link rel="prefetch" href="/assets/js/page-Trade接口.ccffce54.js"><link rel="prefetch" href="/assets/js/page-TransactionInterface.32653e63.js"><link rel="prefetch" href="/assets/js/page-Unfreeze.f1c3c8a8.js"><link rel="prefetch" href="/assets/js/page-UnfreezeInterface.81858e68.js"><link rel="prefetch" href="/assets/js/page-WalletInterface.fd6c6847.js"><link rel="prefetch" href="/assets/js/page-WalletModule.4e3996df.js"><link rel="prefetch" href="/assets/js/page-WalletRecoveryContract.5332a838.js"><link rel="prefetch" href="/assets/js/page-Wallet接口.53f0374a.js"><link rel="prefetch" href="/assets/js/page-Zero-KnowledgeProof.2b9faa98.js"><link rel="prefetch" href="/assets/js/page-autonomy接口.f53d27ba.js"><link rel="prefetch" href="/assets/js/page-ethersjs事件监听.18349138.js"><link rel="prefetch" href="/assets/js/page-ethersjs合约部署和读写.dd7e3361.js"><link rel="prefetch" href="/assets/js/page-ethersjs环境搭建和基本操作.1b5545a9.js"><link rel="prefetch" href="/assets/js/page-go-sdk基本开发环境搭建及常用方法.2f26e43d.js"><link rel="prefetch" href="/assets/js/page-web3js合约事件.4051436e.js"><link rel="prefetch" href="/assets/js/page-web3js合约读写.4802c906.js"><link rel="prefetch" href="/assets/js/page-web3js合约部署.8ae635cf.js"><link rel="prefetch" href="/assets/js/page-web3js基本开发环境搭建及常用查询函数.a4d11cdc.js"><link rel="prefetch" href="/assets/js/page-web3js账户操作和发送交易.bd78d82d.js"><link rel="prefetch" href="/assets/js/page-web3j事件监听.0b549779.js"><link rel="prefetch" href="/assets/js/page-web3j合约部署和读写.07833d6f.js"><link rel="prefetch" href="/assets/js/page-web3j基本开发环境搭建及常用查询函数.f37017d7.js"><link rel="prefetch" href="/assets/js/page-事件接口.1d4b51da.js"><link rel="prefetch" href="/assets/js/page-交易接口.6c3ed873.js"><link rel="prefetch" href="/assets/js/page-公链发展趋势.6856d26f.js"><link rel="prefetch" href="/assets/js/page-共识模块.b95b8995.js"><link rel="prefetch" href="/assets/js/page-兼容以太坊EVM.b8c01df7.js"><link rel="prefetch" href="/assets/js/page-创建比特元主链节点.6e2223b4.js"><link rel="prefetch" href="/assets/js/page-区块链接口.44eab0c9.js"><link rel="prefetch" href="/assets/js/page-去中心化NFT交易系统.0c331116.js"><link rel="prefetch" href="/assets/js/page-去中心化域名系统.b640ee19.js"><link rel="prefetch" href="/assets/js/page-去中心化应用.ca33cab3.js"><link rel="prefetch" href="/assets/js/page-命令行工具介绍.27e36b59.js"><link rel="prefetch" href="/assets/js/page-国密支持.b216e3ef.js"><link rel="prefetch" href="/assets/js/page-多重签名.442123b9.js"><link rel="prefetch" href="/assets/js/page-存储分片.2984fd0b.js"><link rel="prefetch" href="/assets/js/page-存储模块.520849dd.js"><link rel="prefetch" href="/assets/js/page-对接外部应用.130da003.js"><link rel="prefetch" href="/assets/js/page-平行链共识节点挖矿奖励规则.5d43496b.js"><link rel="prefetch" href="/assets/js/page-平行链发行Token.4dc3bd4b.js"><link rel="prefetch" href="/assets/js/page-平行链环境配置.6f24911e.js"><link rel="prefetch" href="/assets/js/page-平行链资产转移管理介绍.a80759fb.js"><link rel="prefetch" href="/assets/js/page-平行链超级节点创建和超级账户管理介绍.b3068c7b.js"><link rel="prefetch" href="/assets/js/page-执行器接口.6712f08a.js"><link rel="prefetch" href="/assets/js/page-技术架构.106393c4.js"><link rel="prefetch" href="/assets/js/page-挖矿接口.973b862e.js"><link rel="prefetch" href="/assets/js/page-接口约定.a066391a.js"><link rel="prefetch" href="/assets/js/page-搭建平行链.ffd58887.js"><link rel="prefetch" href="/assets/js/page-文档主页.c1f06507.js"><link rel="prefetch" href="/assets/js/page-智能合约.b462e938.js"><link rel="prefetch" href="/assets/js/page-术语介绍.2492e8bb.js"><link rel="prefetch" href="/assets/js/page-查询余额.729ac02e.js"><link rel="prefetch" href="/assets/js/page-比特元主网环境配置.a794cb1e.js"><link rel="prefetch" href="/assets/js/page-比特元简介.e03c1231.js"><link rel="prefetch" href="/assets/js/page-比特元钱包操作手册.6ef615cf.js"><link rel="prefetch" href="/assets/js/page-燃料消耗.bea6c493.js"><link rel="prefetch" href="/assets/js/page-社区自治DAO.142cf618.js"><link rel="prefetch" href="/assets/js/page-系统模块.bfe62b8d.js"><link rel="prefetch" href="/assets/js/page-系统要求.7addc4c9.js"><link rel="prefetch" href="/assets/js/page-网络类型.ef19de3b.js"><link rel="prefetch" href="/assets/js/page-账户模型.68ae831b.js"><link rel="prefetch" href="/assets/js/page-通证发行.41f5803b.js"><link rel="prefetch" href="/assets/js/page-通过SDK与BTY公链交互.ce2dee69.js"><link rel="prefetch" href="/assets/js/page-部署区块链浏览器.3365420d.js"><link rel="prefetch" href="/assets/js/page-部署智能合约.5fef792c.js"><link rel="prefetch" href="/assets/js/page-部署钱包.37455bf9.js"><link rel="prefetch" href="/assets/js/page-钱包找回合约.5d05d1c8.js"><link rel="prefetch" href="/assets/js/page-钱包模块.46e01bf3.js"><link rel="prefetch" href="/assets/js/page-错误码.98613853.js"><link rel="prefetch" href="/assets/js/page-隐私保护.6829c56b.js"><link rel="prefetch" href="/assets/js/page-零知识证明.39904e6d.js"><link rel="prefetch" href="/assets/js/page-食品溯源案例.cd11ead0.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.f0f9ccda.js"><link rel="prefetch" href="/assets/js/vendors~mermaid.39f7aac0.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.37b37225.js"><link rel="prefetch" href="/assets/js/vendors~reveal.09a4a79b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b9744494.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/zh/" class="home-link router-link-active"><img src="/logo.svg" alt="BitYuan" class="logo"> <!----> <span class="site-name can-hide">BitYuan</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><!----> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">主题模式:</label> <div class="darkmode-switch"><div class="switch"><input id="switch" type="checkbox" checked="checked" class="switch-input"> <label for="switch" class="label"><span class="label-content"></span></label></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/" class="nav-link router-link-active"><!---->
  主页
</a></div><div class="nav-item"><a href="/zh/guide/" class="nav-link router-link-active active"><!---->
  指南
</a></div></nav> <div class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" style="width:1rem;height:1rem;vertical-align:middle;margin-left:1rem;"><path d="M639.981 344.075c14.805 44.45 34.542 79.023 69.084 113.596 29.603-29.634 49.34-69.146 64.145-113.596H639.981zM314.33 591.024h128.29l-64.145-172.865-64.145 172.865z" fill="currentColor"></path> <path d="M807.746 116.882H215.643c-54.274 0-98.681 44.45-98.681 98.78v592.677c0 54.329 44.407 98.78 98.68 98.78h592.104c54.273 0 98.681-44.451 98.681-98.78V215.66c0-54.329-39.475-98.78-98.68-98.78zM565.971 754.01c-9.866 9.878-19.738 9.878-29.603 9.878-4.94 0-14.805 0-19.738-4.939-4.939-4.939-9.872 0-9.872-4.939s-4.932-9.878-9.865-19.756c-4.94-9.878-4.94-14.817-9.872-24.695L467.29 655.23H294.592l-19.737 54.33c-9.866 19.755-14.805 34.572-19.738 44.45-4.939 9.878-14.804 9.878-29.603 9.878-9.871 0-19.737-4.939-29.609-9.878-9.865-9.878-14.798-14.817-14.798-24.695 0-4.939 0-9.878 4.933-19.756 4.939-9.878 4.939-14.817 9.865-24.695l108.553-276.583c4.939-9.878 4.939-19.756 9.872-29.633 4.932-9.878 9.865-19.756 14.798-24.695 4.939-4.94 9.872-14.817 19.737-19.756 9.872-4.94 19.738-4.94 29.61-4.94 9.865 0 19.73 0 29.603 4.94 9.865 4.939 14.804 9.878 19.737 19.756 4.933 4.939 9.866 14.817 14.798 24.695 4.94 9.877 9.872 19.755 14.805 34.572l108.553 271.644c9.865 19.756 14.804 34.573 14.804 44.451-4.939 4.94-9.872 14.817-14.804 24.695zm271.378-192.62c-54.273-19.756-93.748-44.451-128.29-74.085-34.536 34.573-78.943 59.268-133.223 74.085l-14.798-24.695c54.273-14.817 98.68-34.573 133.223-69.146-34.542-34.573-64.145-79.024-74.017-128.413h-49.34V319.38h133.228c-9.877-14.817-19.743-34.573-29.609-49.39l14.799-4.94c9.871 14.818 24.676 34.574 34.542 54.33h123.35v24.695h-49.34c-14.798 49.39-39.468 93.84-69.077 123.474 34.541 29.634 74.01 54.329 128.29 69.146l-19.738 24.695z" fill="currentColor"></path></svg> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/" class="nav-link router-link-active"><!---->
  English
</a></li><li class="dropdown-item"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/" aria-current="page" class="nav-link router-link-exact-active router-link-active active"><!---->
  简体中文
</a></li></ul></div></div></div> <a rel="noopener noreferrer" href="https://github.com/bityuan/bty-docs" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/zh/" class="nav-link router-link-active"><!---->
  主页
</a></div><div class="nav-item"><a href="/zh/guide/" class="nav-link router-link-active active"><!---->
  指南
</a></div> <a rel="noopener noreferrer" href="https://github.com/bityuan/bty-docs" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/guide/" aria-current="page" class="sidebar-link">公链发展趋势</a></li><li><a href="/zh/guide/00/" class="sidebar-link">比特元简介</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">经济模型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">技术特色</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">开发入门</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable open"><!----> <span class="title">开发进阶</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading clickable open"><!----> <span class="title">功能模块</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/1.P2P%E6%A8%A1%E5%9D%97/" class="sidebar-link">P2P模块</a></li><li><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/2.%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9D%97/" class="sidebar-link">存储模块</a></li><li><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/3.Blockchain%E6%A8%A1%E5%9D%97/" class="sidebar-link">Blockchain模块</a></li><li><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/4.Mempool%E6%A8%A1%E5%9D%97/" class="sidebar-link">Mempool模块</a></li><li><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/5.%E5%85%B1%E8%AF%86%E6%A8%A1%E5%9D%97/" class="sidebar-link">共识模块</a></li><li><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/6.%E9%92%B1%E5%8C%85%E6%A8%A1%E5%9D%97/" class="sidebar-link">钱包模块</a></li><li><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/" aria-current="page" class="active sidebar-link">执行器模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#模块介绍" class="sidebar-link">模块介绍</a></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#执行器模块交互" class="sidebar-link">执行器模块交互</a></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#执行器内部逻辑结构" class="sidebar-link">执行器内部逻辑结构</a></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#处理逻辑" class="sidebar-link">处理逻辑</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#交易校验" class="sidebar-link heading3">交易校验</a></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#交易执行" class="sidebar-link heading3">交易执行</a></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#历史查询" class="sidebar-link heading3">历史查询</a></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#新增区块" class="sidebar-link heading3">新增区块</a></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#回滚区块" class="sidebar-link heading3">回滚区块</a></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#执行器整体处理逻辑" class="sidebar-link heading3">执行器整体处理逻辑</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#二次开发" class="sidebar-link">二次开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#echo执行器整体介绍" class="sidebar-link heading3">Echo执行器整体介绍</a></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#交易校验-2" class="sidebar-link heading3">交易校验</a></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#交易执行-2" class="sidebar-link heading3">交易执行</a></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#新增区块-2" class="sidebar-link heading3">新增区块</a></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#回滚区块-2" class="sidebar-link heading3">回滚区块</a></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#历史查询-2" class="sidebar-link heading3">历史查询</a></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#创建交易逻辑" class="sidebar-link heading3">创建交易逻辑</a></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#注册执行器" class="sidebar-link heading3">注册执行器</a></li><li class="sidebar-sub-header"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#测试执行器" class="sidebar-link heading3">测试执行器</a></li></ul></li></ul></li><li><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/8.Queue%E6%A8%A1%E5%9D%97/" class="sidebar-link">Queue模块</a></li><li><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/9.RPC%E6%A8%A1%E5%9D%97/" class="sidebar-link">RPC模块</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading clickable"><!----> <span class="title">系统使用</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">去中心化应用</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">区块链浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">钱包</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">API参考</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">案例介绍</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">执行器模块</span></h1> <div class="page-info"><!----> <!----><span aria-label="写作日期📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2023-9-7</span></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#模块介绍" class="anchor-link heading2"><div>模块介绍</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#执行器模块交互" class="anchor-link heading2"><div>执行器模块交互</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#执行器内部逻辑结构" class="anchor-link heading2"><div>执行器内部逻辑结构</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#处理逻辑" class="anchor-link heading2"><div>处理逻辑</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#交易校验" class="anchor-link heading3"><div>交易校验</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#交易执行" class="anchor-link heading3"><div>交易执行</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#历史查询" class="anchor-link heading3"><div>历史查询</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#新增区块" class="anchor-link heading3"><div>新增区块</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#回滚区块" class="anchor-link heading3"><div>回滚区块</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#执行器整体处理逻辑" class="anchor-link heading3"><div>执行器整体处理逻辑</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#二次开发" class="anchor-link heading2"><div>二次开发</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#echo执行器整体介绍" class="anchor-link heading3"><div>Echo执行器整体介绍</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#交易校验-2" class="anchor-link heading3"><div>交易校验</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#交易执行-2" class="anchor-link heading3"><div>交易执行</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#新增区块-2" class="anchor-link heading3"><div>新增区块</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#回滚区块-2" class="anchor-link heading3"><div>回滚区块</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#历史查询-2" class="anchor-link heading3"><div>历史查询</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#创建交易逻辑" class="anchor-link heading3"><div>创建交易逻辑</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#注册执行器" class="anchor-link heading3"><div>注册执行器</div></a></li><li class="anchor"><a href="/zh/guide/05.%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/1.%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/7.%E6%89%A7%E8%A1%8C%E5%99%A8%E6%A8%A1%E5%9D%97/#测试执行器" class="anchor-link heading3"><div>测试执行器</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="执行器模块"><a href="#执行器模块" class="header-anchor">#</a> 执行器模块</h1> <h2 id="模块介绍"><a href="#模块介绍" class="header-anchor">#</a> 模块介绍</h2> <p>顾名思义，执行器模块主要是用于执行逻辑的。在区块链中，所有的数据都是通过交易生成的，这些数据按照一定的规则，组装成一个个区块，最终形成一个完整的区块链条。</p> <p>而在一个完整的区块链系统中，交易的执行是核心，比如一次A到B的转账交易，A账户的余额会减少，B账户的余额会增加，这个账户余额变更的逻辑就是执行器要执行的内容。</p> <p>拿智能合约来说，合约中包含的所有逻辑，就是执行器要执行的逻辑；只不过，合约只是一个具体的逻辑，而执行器则是一个容器，它可以执行数个合约，而不需要知道合约的具体内容。</p> <p>所以说，执行器模块是一个容器，它支持各种合约的运行（包括系统合约以及各种扩展合约）；接收交易，并将交易分配给对应的合约具体执行；同时响应区块链上的各种事件（交易校验、查询请求、执行交易、新增区块、回滚区块），并将事件派发给具体的合约逻辑。</p> <h2 id="执行器模块交互"><a href="#执行器模块交互" class="header-anchor">#</a> 执行器模块交互</h2> <p><img src="/assets/img/Executor_template_interaction.f0d8c1bd.png" alt="执行器模块交互"></p> <p>执行器自身能力对外体现为5个接口：</p> <p>两个只读接口：</p> <ul><li><strong>交易校验</strong>：通过EventCheckTx事件触发，对交易的有效性进行检查，请求来源于Mempool模块。</li> <li><strong>查询请求</strong>：查询操作，从交易生成的数据中查询指定信息，具体查询内容不固定，因调用的查询方法而异，一般请求来源于Wallet/Client/Consensus模块。</li></ul> <p>三个写接口：</p> <ul><li><p><strong>交易执行</strong>：通过EventExecTxList事件触发，执行交易列表中的每一笔交易，并返回执行结果，请求来源于Blockchain模块。</p></li> <li><p><strong>区块新增</strong>：通过EventAddBlock事件触发，执行区块写入链的后处理操作，生成一些本地数据并返回，请求来源于Blockchain模块。</p></li> <li><p><strong>区块回滚</strong>：通过EventDelBlock事件触发，执行链中区块回滚的后处理操作，生成一些本地数据并返回，请求来源于Blockchain模块。</p></li></ul> <h2 id="执行器内部逻辑结构"><a href="#执行器内部逻辑结构" class="header-anchor">#</a> 执行器内部逻辑结构</h2> <p><img src="/assets/img/Executor_Architecture.78d5a673.png" alt="执行器内部逻辑结构"></p> <p>如上图所示，执行器本身是一个容器框架，它本身只包含一些通用的调度处理逻辑，将请求分发给具体的执行器合约进行执行，然后收集结果返回。</p> <p>从设计上来说，每一个具体的执行器（这里指合约，可以认为两者等价）都实现了Driver中的几个核心方法，容器在执行操作时，会根据交易中附带的执行器信息，调用具体的XXXExecutor执行逻辑。</p> <p>每一个具体的执行器在实现时均分成两部分：</p> <ul><li><p><strong>执行器对象(XXXExecutor)</strong>：</p> <p>实现Driver接口，继承DriverBase基类。</p> <p>是执行器的主体，包含执行器的主要执行逻辑，一般根据功能划分成多个程序文件，分别执行对应的逻辑。</p></li> <li><p><strong>执行器对象类型(XXXType)</strong>：</p> <p>实现ExecutorType接口，继承ExecTypeBase基类。</p> <p>包装执行器类型相关的一些通用能力，如方法列表、Payload结构等，辅助执行器框架完成定制化的处理逻辑。</p></li></ul> <h2 id="处理逻辑"><a href="#处理逻辑" class="header-anchor">#</a> 处理逻辑</h2> <blockquote><p>上面介绍了执行器实现的5个主要能力接口，下面分别介绍每个接口的具体功能以及实现逻辑。</p></blockquote> <h3 id="交易校验"><a href="#交易校验" class="header-anchor">#</a> 交易校验</h3> <h4 id="接口定义"><a href="#接口定义" class="header-anchor">#</a> 接口定义</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Driver <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">CheckTx</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>此接口包含两个参数：</p> <ul><li><code>tx *types.Transaction</code>：为本次交易对象，里面包含了交易的所有信息</li> <li><code>index int</code>：为本交易在本次打包区块中的索引位置。</li></ul> <blockquote><p><strong>实现功能</strong>：对本次交易进行业务合法性检查（交易自身的合法性，签名校验等无需检查，已经在Mempool模块进行过滤），只允许满足本执行器要求的交易执行，否则返回具体的错误信息。</p></blockquote> <h4 id="通用处理逻辑"><a href="#通用处理逻辑" class="header-anchor">#</a> 通用处理逻辑</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//默认情况下，tx.To地址指向合约地址。</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>d <span class="token operator">*</span>DriverBase<span class="token punctuation">)</span> <span class="token function">CheckTx</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	execer <span class="token operator">:=</span> <span class="token function">string</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Execer<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token function">ExecAddress</span><span class="token punctuation">(</span>execer<span class="token punctuation">)</span> <span class="token operator">!=</span> tx<span class="token punctuation">.</span>To <span class="token punctuation">{</span>
		<span class="token keyword">return</span> types<span class="token punctuation">.</span>ErrToAddrNotSameToExecAddr
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在DriverBase基类中，仅实现了最基础的校验逻辑，就是检查交易的目标地址是否为本执行器合约的地址，其中：</p> <ul><li><p><code>ExecAddress(execer)</code>：实现的能力是从执行器名称获取执行器合约地址。</p></li> <li><p><code>tx.To</code>：则是本次交易的目标地址。</p></li></ul> <h4 id="执行器实现"><a href="#执行器实现" class="header-anchor">#</a> 执行器实现</h4> <p>在实现具体的执行器交易校验逻辑时，需要根据自己的业务场景来确定对哪些内容进行检查，尽量确保通过校验的交易都可以正确执行。</p> <p>如果，仅仅需要检查目标地址，则执行器可以不实现这个校验逻辑，系统会自动重用DriverBase的校验逻辑；</p> <p>如果，本执行器不需要对交易的任何内容进行校验，则覆盖此方法，仅仅返回空即可，如下代码：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>x <span class="token operator">*</span>XXXExecutor<span class="token punctuation">)</span> <span class="token function">CheckTx</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token comment">// 不需要执行任何校验逻辑。</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p><strong>注意：</strong> 在执行器开发时，一旦确定实行某一类校验规则，后面不能随意变更，否则可能会引起区块链分叉。如果实在需要变更，则需要对代码进行分叉逻辑处理，保证区块执行结果的一致性。</p> <p>二次开发时，如果存在校验逻辑，建议单独一个check.go实现。</p></blockquote> <h3 id="交易执行"><a href="#交易执行" class="header-anchor">#</a> 交易执行</h3> <h4 id="接口定义-2"><a href="#接口定义-2" class="header-anchor">#</a> 接口定义</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Driver <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Exec</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Receipt<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>此接口同样包含两个参数，和交易校验的方法参数含义相同，唯独返回值不同：</p> <ul><li><code>tx *types.Transaction</code>：为本次交易对象，里面包含了交易的所有信息</li> <li><code>index int</code>：为本交易在本次打包区块中的索引位置</li> <li><code>*types.Receipt</code>：返回值，可以参考Receipt的消息结构定义，其中ty用于填写本次交易执行的结果类型，如成功、失败类型；KV则是用来填写本次交易执行的结果，logs为本次交易执行生成的收据信息。如下代码：</li></ul> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">message</span> <span class="token class-name">Receipt</span> <span class="token punctuation">{</span>
    <span class="token builtin">int32</span>    ty              <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">KeyValue</span> KV     <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">ReceiptLog</span> logs <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p><strong>实现功能：</strong> 交易执行的核心逻辑，执行器合约的主要逻辑在这里体现，它将会解析交易对象中携带的相关信息，然后根据合约设计的规则，执行不同的业务逻辑分支，最终结果将体现在返回的数据中，而这些数据将会在区块内的所有交易执行完成后，写入到区块链上。</p></blockquote> <h4 id="通用处理逻辑-2"><a href="#通用处理逻辑-2" class="header-anchor">#</a> 通用处理逻辑</h4> <p>DriverBase基类的通用处理逻辑比较复杂，这里以伪代码加注释的方式来呈现。</p> <p>其中xxx表示具体的执行器实现，xxxType表示具体的执行器类型对象。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>d <span class="token operator">*</span>DriverBase<span class="token punctuation">)</span> <span class="token function">Exec</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>Receipt<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> xxxType <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 获取具体执行器的消息结构。</span>
    <span class="token keyword">if</span> xxx<span class="token punctuation">.</span><span class="token function">GetPayloadValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 使用类型对象解析交易中携带的合约相关请求信息。</span>
    actionName<span class="token punctuation">,</span> actionValue<span class="token punctuation">,</span> err <span class="token operator">=</span> xxxType<span class="token punctuation">.</span><span class="token function">DecodePayloadValue</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span>
    <span class="token comment">// 约定方法名结构为固定前缀 + 合约的请求动作。</span>
    funcName <span class="token operator">=</span> <span class="token string">&quot;Exec_&quot;</span> <span class="token operator">+</span> actionName
    <span class="token comment">// 获取本执行器实现的所有方法对象字典，其实本质调用的是。xxxType.GetExecFuncMap</span>
    funcMap <span class="token operator">=</span> xxx<span class="token punctuation">.</span><span class="token function">GetFuncMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 定位到具体的方法对象。</span>
    funcObj <span class="token operator">=</span> funcMap<span class="token punctuation">[</span>funcName<span class="token punctuation">]</span>
    <span class="token comment">// 通过反射调用此方法对象。</span>
    funcObj<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token comment">// 获取反射调用结果并返回。</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>从上面的伪代码逻辑可以看出，在DriverBase基类中，实现的是一个框架逻辑，它会将交易载体对象的解析委托给具体的执行器类型去实现，然后按照约定的规则拼装方法名，最后通过反射的方式调用具体的执行方法。</p> <p>所以，一般情况下开发者在进行执行器开发时，是不需要实现此方法的，只需要实现此框架逻辑依赖的几个相关方法即可。</p> <h4 id="执行器实现-2"><a href="#执行器实现-2" class="header-anchor">#</a> 执行器实现</h4> <p>参考上面的分析，总共有几处和交易执行相关的地方需要具体执行器的开发者关注。</p> <ul><li>执行器类型方法：</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> ExecutorType <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token comment">// 从交易中解析出action名称，action对象 （具体action信息只有具体执行器自己才认识）。</span>
    <span class="token function">DecodePayloadValue</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>Transaction<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> reflect<span class="token punctuation">.</span>Value<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
    <span class="token comment">// 获取本执行器的方法字典。</span>
    <span class="token function">GetExecFuncMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Method
<span class="token punctuation">}</span>        
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>执行器对象方法：</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Driver <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取本执行器对应的Payload定义结构。</span>
    <span class="token comment">// 这个方法其实是委托给ExecutorType.GetPayload()方法执行的。</span>
    <span class="token function">GetPayloadValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> types<span class="token punctuation">.</span>Message
    <span class="token comment">// 获取本执行器可用的方法字典。</span>
    <span class="token comment">// 此方法也是委托给ExecutorType.GetExecFuncMap()方法执行的。</span>
    <span class="token function">GetFuncMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Method
<span class="token punctuation">}</span>    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>具体执行方法签名：</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>XXX<span class="token punctuation">)</span> <span class="token function">Exec_Transfer</span><span class="token punctuation">(</span>transfer <span class="token operator">*</span>types<span class="token punctuation">.</span>XXXAction<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Receipt<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p><strong>注意：</strong> 在真正的执行器开发中，实现执行交易逻辑时，不需要去实现基类的Exec方法，只需要按照上面的规则，实现几个周边的依赖方法；并且根据自己的合约逻辑实现几个Exec_XXX方法即可（方法签名如上）。具体实现方式，在后面的二次开发章节会详细介绍。</p> <p>二次开发时，交易执行逻辑建议单独放在一个exec.go文件中。</p></blockquote> <h3 id="历史查询"><a href="#历史查询" class="header-anchor">#</a> 历史查询</h3> <h4 id="接口定义-3"><a href="#接口定义-3" class="header-anchor">#</a> 接口定义</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Driver <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Query</span><span class="token punctuation">(</span>funcName <span class="token builtin">string</span><span class="token punctuation">,</span> params <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>types<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>此接口包含两个参数：</p> <ul><li><code>funcName string</code>：为本次查询请求的具体方法名，系统会将本次请求自动路由到对应的方法实现。</li> <li><code>params []byte</code>：为本次查询的具体参数信息，这里接收的为序列化之后的值，查询框架会进行反序列化后再调用具体的查询方法。</li></ul> <blockquote><p><strong>实现功能：</strong> 实现任何查询操作（前提是此操作对应的方法存在），因为是只读的查询操作，不以交易的形式体现，不影响区块数据，不会写入区块链。</p></blockquote> <h4 id="通用处理逻辑-3"><a href="#通用处理逻辑-3" class="header-anchor">#</a> 通用处理逻辑</h4> <p>本逻辑实现代码，下面以伪代码形式呈现。其中xxx表示具体的执行器实现。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>d <span class="token operator">*</span>DriverBase<span class="token punctuation">)</span> <span class="token function">Query</span><span class="token punctuation">(</span>funcname <span class="token builtin">string</span><span class="token punctuation">,</span> params <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>msg types<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取本执行器实现的所有方法对象字典，其实本质调用的是xxxType.GetExecFuncMap。</span>
    funcMap <span class="token operator">=</span> xxx<span class="token punctuation">.</span><span class="token function">GetFuncMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 约定方法名结构为固定前缀 + 请求方法名。</span>
    funcname <span class="token operator">=</span> <span class="token string">&quot;Query_&quot;</span> <span class="token operator">+</span> funcname
    <span class="token comment">// 定位到具体的方法对象。</span>
    funcObj <span class="token operator">=</span> funcMap<span class="token punctuation">[</span>funcName<span class="token punctuation">]</span>
    <span class="token comment">// 通过funcObj获取到查询方法参数类型，并将params反序列化。</span>
    <span class="token comment">// 通过反射调用方法对象。</span>
    funcObj<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token comment">// 获取反射调用结果并返回。 </span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>和执行交易的逻辑类似，在DriverBase基类中实现的也是一套框架逻辑，通过方法名定位到具体的方法对象，然后在根据方法类型中定义的参数类型信息，对传入的params参数进行反向序列化，从而得到具体的参数结构信息，最后再利用反射调用具体的查询方法逻辑并返回结果。</p> <p>所以，一般情况下开发者在进行执行器开发时，也不需要实现此方法的，只需要实现此框架逻辑依赖的几个相关方法即可；</p> <h4 id="执行器实现-3"><a href="#执行器实现-3" class="header-anchor">#</a> 执行器实现</h4> <p>参考上面的分析，总共有几处和查询相关的地方需要具体执行器的开发者关注。</p> <ul><li>执行器类型方法：</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> ExecutorType <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取本执行器的方法字典。</span>
    <span class="token function">GetExecFuncMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Method
<span class="token punctuation">}</span>        
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>执行器对象方法：</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Driver <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取本执行器可用的方法字典。</span>
    <span class="token comment">// 此方法也是委托给ExecutorType.GetExecFuncMap()方法执行的。</span>
    <span class="token function">GetFuncMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Method
<span class="token punctuation">}</span>    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>具体查询方法签名：</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>XXX<span class="token punctuation">)</span> <span class="token function">Query_XxxYyyZzz</span><span class="token punctuation">(</span>in <span class="token operator">*</span>types<span class="token punctuation">.</span>XXXReq<span class="token punctuation">)</span> <span class="token punctuation">(</span>types<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p><strong>注意：</strong> 在真正的执行器开发中，实现查询逻辑时，不需要去实现基类的Query方法，只需要按照上面的规则，实现几个周边的依赖方法；并且根据自己的合约逻辑实现几个Query_XXX方法即可。具体实现方式，在后面的二次开发章节会详细介绍。</p> <p>二次开发时，查询逻辑建议单独放在一个query.go文件中。</p></blockquote> <h3 id="新增区块"><a href="#新增区块" class="header-anchor">#</a> 新增区块</h3> <h4 id="接口定义-4"><a href="#接口定义-4" class="header-anchor">#</a> 接口定义</h4> <p>在一个区块内的全部交易都执行完成之后，会将此区块打包上链，在上链之前，会触发这个新增区块的逻辑，系统会遍历区块内的所有交易，逐个调用对应的ExecLocal逻辑。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Driver <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">ExecLocal</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>此接口包含三个参数：</p> <ul><li><code>x *types.Transaction</code>：为本次交易对象，里面包含了交易的所有信息。</li> <li><code>receipt *types.ReceiptData</code>：为本次交易执行时生成的结果信息，其结构定义如下：</li></ul> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">message</span> <span class="token class-name">ReceiptData</span> <span class="token punctuation">{</span>
    <span class="token builtin">int32</span>    ty              <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">ReceiptLog</span> logs <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>index int</code>：为本次交易在打包区块中的索引位置</li></ul> <blockquote><p><strong>实现功能：</strong> 根据交易执行生成的结果信息，增加自己的逻辑，生成一些新的数据，用于辅助合约逻辑。这些数据可以认为是本地数据，不会上链（但每个区块节点都会生成），一般用于做多重索引，保存中间数据等，具体视合约逻辑而定。</p></blockquote> <h4 id="通用处理逻辑-4"><a href="#通用处理逻辑-4" class="header-anchor">#</a> 通用处理逻辑</h4> <p>DriverBase基类的通用处理逻辑比较复杂，这里以伪代码加注释的方式来呈现。其中xxx表示具体的执行器实现，xxxType表示具体的执行器类型对象。</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>d <span class="token operator">*</span>DriverBase<span class="token punctuation">)</span> <span class="token function">ExecLocal</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用类型对象解析交易中携带的合约相关请求信息。</span>
    actionName<span class="token punctuation">,</span> actionValue<span class="token punctuation">,</span> err <span class="token operator">=</span> xxxType<span class="token punctuation">.</span><span class="token function">DecodePayloadValue</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span>
    <span class="token comment">// 约定方法名结构为固定前缀 + 合约的请求动作。</span>
    funcName <span class="token operator">=</span> <span class="token string">&quot;ExecLocal_&quot;</span> <span class="token operator">+</span> actionName
    <span class="token comment">// 获取本执行器实现的所有方法对象字典，其实本质调用的是xxxType.GetExecFuncMap。</span>
    funcMap <span class="token operator">=</span> xxx<span class="token punctuation">.</span><span class="token function">GetFuncMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 定位到具体的方法对象。</span>
    funcObj <span class="token operator">=</span> funcMap<span class="token punctuation">[</span>funcName<span class="token punctuation">]</span>
    <span class="token comment">// 通过反射调用此方法对象。</span>
    funcObj<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token comment">// 获取反射调用结果并返回。    </span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>主体框架逻辑基本和前面的执行交易类似，使用到的相关方法前面也都介绍过，唯一不同的就是方法前缀，这里是&quot;ExecLocal_&quot;。</p> <p>同样，一般情况下开发者在进行执行器开发时，也不需要实现此方法的，只需要实现此框架逻辑依赖的几个相关方法即可；</p> <h4 id="执行器实现-4"><a href="#执行器实现-4" class="header-anchor">#</a> 执行器实现</h4> <p>本操作涉及到的具体执行器方法和执行器类型方法，和前面的重复，不再列举，这里仅列出ExecLocal_XXX的方法签名。</p> <ul><li>具体查询方法签名：</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>XXX<span class="token punctuation">)</span> <span class="token function">ExecLocal_XYZ</span><span class="token punctuation">(</span>action <span class="token operator">*</span>types<span class="token punctuation">.</span>XXXyz<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p><strong>注意：</strong> 在真正的执行器开发中，实现本逻辑时，只需要根据自己的合约逻辑实现几个ExecLocal_XXX方法即可。具体实现方式，在后面的二次开发章节会详细介绍。</p> <p>二次开发时，本逻辑建议单独放在一个exec_local.go文件中。</p></blockquote> <h3 id="回滚区块"><a href="#回滚区块" class="header-anchor">#</a> 回滚区块</h3> <h4 id="接口定义-5"><a href="#接口定义-5" class="header-anchor">#</a> 接口定义</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Driver <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">ExecDelLocal</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>本接口和新增区块相同，不再详细描述方法定义。</p> <blockquote><p><strong>实现功能：</strong> 本逻辑和新增区块刚好相反，新增区块中新增的数据，这里需要删除；新增区块中用新值代替旧值，这里需要用旧值代替新值；将数据恢复到原始状态。</p></blockquote> <h4 id="通用处理逻辑-5"><a href="#通用处理逻辑-5" class="header-anchor">#</a> 通用处理逻辑</h4> <p>和新增区块的逻辑相同，唯一不同的地方仅为方法前缀不同，这里的方法前缀为&quot;<strong>ExecDelLocal_</strong>&quot;；</p> <h4 id="执行器实现-5"><a href="#执行器实现-5" class="header-anchor">#</a> 执行器实现</h4> <p>本操作涉及到的具体执行器方法和执行器类型方法，和前面的重复，不再列举，这里仅列出ExecDelLocal_XXX的方法签名。</p> <ul><li>具体查询方法签名：</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>XXX<span class="token punctuation">)</span> <span class="token function">ExecDelLocal_XYZ</span><span class="token punctuation">(</span>action <span class="token operator">*</span>types<span class="token punctuation">.</span>XXXyz<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p><strong>注意：</strong> 在真正的执行器开发中，实现本逻辑时，只需要根据自己的合约逻辑实现几个ExecLocal_XXX方法即可。具体实现方式，在后面的二次开发章节会详细介绍。</p> <p>二次开发时，本逻辑建议单独放在一个exec_del_local.go文件中。</p></blockquote> <h3 id="执行器整体处理逻辑"><a href="#执行器整体处理逻辑" class="header-anchor">#</a> 执行器整体处理逻辑</h3> <p><img src="/assets/img/excutor_framework.50302c08.png" alt="excutor-call-back-framework"></p> <h2 id="二次开发"><a href="#二次开发" class="header-anchor">#</a> 二次开发</h2> <p>本章节将会以一个简单的例子来介绍执行器的二次开发过程，例子实现的功能比较简单，但包含了实现一个执行器所需要的各方面的方法。</p> <h3 id="echo执行器整体介绍"><a href="#echo执行器整体介绍" class="header-anchor">#</a> Echo执行器整体介绍</h3> <p>本执行器实现一个简单的消息响应功能，支持ping和pang两种操作，交易执行时会往区块链上写入响应数据，本地执行时会记录同一个消息调用的次数，本执行器也支持对消息的调用次数进行查询操作。</p> <p>执行器目录结构如下：</p> <p><img src="/assets/img/excutor_Catalog.19a58fd3.png" alt="开发目录结构"></p> <p>其中三个目录作用如下：</p> <ul><li><p>executor</p> <p>执行器的逻辑主题，包含执行器的交易校验、交易执行、区块新增、区块回滚、历史查询的逻辑主体</p></li> <li><p>proto</p> <p>本执行器中使用到的消息结构定义，protobuf格式</p></li> <li><p>types</p> <p>执行器类型对象定义，以及protobuf生成的消息结构定义</p></li></ul> <h4 id="结构定义"><a href="#结构定义" class="header-anchor">#</a> 结构定义</h4> <p>执行器中用到的消息结构统一使用protobuf格式定义，本执行器用到的结构如下：</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">syntax</span> <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">package</span> types<span class="token punctuation">;</span>
<span class="token comment">// ping操作action</span>
<span class="token keyword">message</span> <span class="token class-name">Ping</span> <span class="token punctuation">{</span>
    <span class="token builtin">string</span> msg     <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// pang操作action</span>
<span class="token keyword">message</span> <span class="token class-name">Pang</span> <span class="token punctuation">{</span>
    <span class="token builtin">string</span> msg     <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 本执行器的统一Action结构</span>
<span class="token keyword">message</span> <span class="token class-name">EchoAction</span> <span class="token punctuation">{</span>
    <span class="token keyword">oneof</span> value <span class="token punctuation">{</span>
        <span class="token positional-class-name class-name">Ping</span>       ping       <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token positional-class-name class-name">Pang</span>       pang       <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token builtin">int32</span> ty <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ping操作生成的日志结构</span>
<span class="token keyword">message</span> <span class="token class-name">PingLog</span> <span class="token punctuation">{</span>
    <span class="token builtin">string</span> msg     <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token builtin">string</span> echo    <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token builtin">int32</span>  count    <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// pang操作生成的日志结构</span>
<span class="token keyword">message</span> <span class="token class-name">PangLog</span> <span class="token punctuation">{</span>
    <span class="token builtin">string</span> msg     <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token builtin">string</span> echo    <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token builtin">int32</span>  count    <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 查询请求结构</span>
<span class="token keyword">message</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span>
    <span class="token builtin">string</span> msg     <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 查询结果结构</span>
<span class="token keyword">message</span> <span class="token class-name">QueryResult</span> <span class="token punctuation">{</span>
    <span class="token builtin">string</span> msg     <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token builtin">int32</span>  count   <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>同目录下的create_protobuf.sh会使用此文件生成go程序，放入到types目录下。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>//<span class="token operator">!</span>/bin/sh
protoc --go_out<span class="token operator">=</span>plugins<span class="token operator">=</span>grpc:<span class="token punctuation">..</span>/types ./*.proto --proto_path<span class="token operator">=</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="执行器类型和执行器对象"><a href="#执行器类型和执行器对象" class="header-anchor">#</a> 执行器类型和执行器对象</h4> <p>执行器类型用于定义类型相关的一些信息，本例实现如下：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> types
<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/33cn/chain33/types&quot;</span>
	log <span class="token string">&quot;github.com/33cn/chain33/common/log/log15&quot;</span>
	<span class="token string">&quot;reflect&quot;</span>
<span class="token punctuation">)</span>
<span class="token comment">// 定义本执行器支持的Action种类</span>
<span class="token keyword">const</span> <span class="token punctuation">(</span>
	ActionPing <span class="token operator">=</span> <span class="token boolean">iota</span>
	ActionPang
<span class="token punctuation">)</span>
<span class="token comment">// 定义本执行器生成的log类型</span>
<span class="token keyword">const</span> <span class="token punctuation">(</span>
	TyLogPing <span class="token operator">=</span> <span class="token number">100001</span>
	TyLogPang <span class="token operator">=</span> <span class="token number">100002</span>
<span class="token punctuation">)</span>
<span class="token keyword">var</span> <span class="token punctuation">(</span>
	<span class="token comment">// 本执行器名称</span>
	EchoX <span class="token operator">=</span> <span class="token string">&quot;echo&quot;</span>
	<span class="token comment">// 定义本执行器支持的Action对应关系</span>
	actionName <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int32</span><span class="token punctuation">{</span>
		<span class="token string">&quot;Ping&quot;</span><span class="token punctuation">:</span> ActionPing<span class="token punctuation">,</span>
		<span class="token string">&quot;Pang&quot;</span><span class="token punctuation">:</span> ActionPang<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 定义本执行器的Log收据解析结构</span>
	logInfo <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int64</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LogInfo<span class="token punctuation">{</span>
		TyLogPing<span class="token punctuation">:</span> <span class="token punctuation">{</span>reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>PingLog<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;PingLog&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		TyLogPang<span class="token punctuation">:</span> <span class="token punctuation">{</span>reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>PangLog<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;PangLog&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token keyword">var</span> elog <span class="token operator">=</span> log<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span> EchoX<span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 将本执行器添加到系统白名单</span>
	types<span class="token punctuation">.</span>AllowUserExec <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span>AllowUserExec<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>EchoX<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// 向系统注册本执行器类型</span>
	types<span class="token punctuation">.</span><span class="token function">RegistorExecutor</span><span class="token punctuation">(</span>EchoX<span class="token punctuation">,</span> <span class="token function">NewType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 定义本执行器类型</span>
<span class="token keyword">type</span> EchoType <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	types<span class="token punctuation">.</span>ExecTypeBase
<span class="token punctuation">}</span>
<span class="token comment">// 初始化本执行器类型</span>
<span class="token keyword">func</span> <span class="token function">NewType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>EchoType <span class="token punctuation">{</span>
	c <span class="token operator">:=</span> <span class="token operator">&amp;</span>EchoType<span class="token punctuation">{</span><span class="token punctuation">}</span>
	c<span class="token punctuation">.</span><span class="token function">SetChild</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
	<span class="token keyword">return</span> c
<span class="token punctuation">}</span>
<span class="token comment">// 返回本执行器的负载类型</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>EchoType<span class="token punctuation">)</span> <span class="token function">GetPayload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> types<span class="token punctuation">.</span>Message <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>EchoAction<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 返回本执行器名称</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>EchoType<span class="token punctuation">)</span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> EchoX
<span class="token punctuation">}</span>
<span class="token comment">// 返回本执行器中的action字典，支持双向查找</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>EchoType<span class="token punctuation">)</span> <span class="token function">GetTypeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int32</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> actionName
<span class="token punctuation">}</span>
<span class="token comment">// 返回本执行器的日志类型信息，用于rpc解析日志数据</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>EchoType<span class="token punctuation">)</span> <span class="token function">GetLogMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int64</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LogInfo <span class="token punctuation">{</span>
	<span class="token keyword">return</span> logInfo
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><blockquote><p>执行器对象则定义执行器的主体逻辑</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> executor
<span class="token keyword">import</span> <span class="token punctuation">(</span>
	echotypes <span class="token string">&quot;github.com/33cn/plugin/plugin/dapp/echo/types&quot;</span>
	<span class="token string">&quot;github.com/33cn/chain33/system/dapp&quot;</span>
	<span class="token string">&quot;github.com/33cn/chain33/types&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">var</span> <span class="token punctuation">(</span>
	<span class="token comment">// 执行交易生成的数据KEY</span>
	KeyPrefixPing <span class="token operator">=</span> <span class="token string">&quot;mavl-echo-ping:%s&quot;</span>
	KeyPrefixPang <span class="token operator">=</span> <span class="token string">&quot;mavl-echo-pang:%s&quot;</span>
	<span class="token comment">// 本地执行生成的数据KEY</span>
	KeyPrefixPingLocal <span class="token operator">=</span> <span class="token string">&quot;LODB-echo-ping:%s&quot;</span>
	KeyPrefixPangLocal <span class="token operator">=</span> <span class="token string">&quot;LODB-echo-pang:%s&quot;</span>
<span class="token punctuation">)</span>
<span class="token comment">// 初始化时通过反射获取本执行器的方法列表</span>
<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	ety <span class="token operator">:=</span> types<span class="token punctuation">.</span><span class="token function">LoadExecutorType</span><span class="token punctuation">(</span>echotypes<span class="token punctuation">.</span>EchoX<span class="token punctuation">)</span>
	ety<span class="token punctuation">.</span><span class="token function">InitFuncList</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">ListMethod</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Echo<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//本执行器的初始化动作，向系统注册本执行器，这里生效高度暂写为0</span>
<span class="token keyword">func</span> <span class="token function">Init</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">,</span> sub <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	dapp<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>echotypes<span class="token punctuation">.</span>EchoX<span class="token punctuation">,</span> newEcho<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 定义执行器对象</span>
<span class="token keyword">type</span> Echo <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	dapp<span class="token punctuation">.</span>DriverBase
<span class="token punctuation">}</span>
<span class="token comment">// 执行器对象初始化包装逻辑，后面的两步设置子对象和设置执行器类型必不可少</span>
<span class="token keyword">func</span> <span class="token function">newEcho</span><span class="token punctuation">(</span><span class="token punctuation">)</span> dapp<span class="token punctuation">.</span>Driver <span class="token punctuation">{</span>
	c <span class="token operator">:=</span> <span class="token operator">&amp;</span>Echo<span class="token punctuation">{</span><span class="token punctuation">}</span>
	c<span class="token punctuation">.</span><span class="token function">SetChild</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
	c<span class="token punctuation">.</span><span class="token function">SetExecutorType</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">LoadExecutorType</span><span class="token punctuation">(</span>echotypes<span class="token punctuation">.</span>EchoX<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> c
<span class="token punctuation">}</span>
<span class="token comment">// 返回本执行器驱动名称</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">GetDriverName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> echotypes<span class="token punctuation">.</span>EchoX
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>可以看到，这个执行器对象的实现逻辑中基本都是初始化相关的代码，没有真正的处理逻辑，这些逻辑被分散到各个具体的程序文件中实现，下面会详细介绍。</p> <h3 id="交易校验-2"><a href="#交易校验-2" class="header-anchor">#</a> 交易校验</h3> <blockquote><p>executor/check.go</p> <p>本执行器不对交易执行任何校验，实现逻辑如下：</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> executor
<span class="token keyword">import</span> <span class="token string">&quot;github.com/33cn/chain33/types&quot;</span>
<span class="token comment">// 本执行器不做任何校验</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">CheckTx</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="交易执行-2"><a href="#交易执行-2" class="header-anchor">#</a> 交易执行</h3> <blockquote><p>executor/exec.go</p> <p>根据交易中携带的信息，执行对应的合约逻辑，实现逻辑如下：</p> <p>以Exec_Ping为例，它接收携带ping操作的交易，其中第一个参数ping即为我们在protobuf文件中定义的message Ping结构，本合约方法实现的逻辑是根据交易中的ping消息，生成对应的响应消息，如传递的ping msg为&quot;hello&quot;，则生成的响应消息为&quot;hello, ping ping ping!&quot;，而这个相应消息会以&quot;mavl-echo-ping:hello&quot;为KEY，写入到区块数据中，并且生成对应的PingLog写入交易收据中。</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> executor
<span class="token keyword">import</span> <span class="token punctuation">(</span>
	echotypes <span class="token string">&quot;github.com/33cn/plugin/plugin/dapp/echo/types&quot;</span>
	<span class="token string">&quot;github.com/33cn/chain33/types&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">Exec_Ping</span><span class="token punctuation">(</span>ping <span class="token operator">*</span>echotypes<span class="token punctuation">.</span>Ping<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Receipt<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	msg <span class="token operator">:=</span> ping<span class="token punctuation">.</span>Msg
	res <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%s, ping ping ping!&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
	xx <span class="token operator">:=</span> <span class="token operator">&amp;</span>echotypes<span class="token punctuation">.</span>PingLog<span class="token punctuation">{</span>Msg<span class="token punctuation">:</span>msg<span class="token punctuation">,</span> Echo<span class="token punctuation">:</span>res<span class="token punctuation">}</span>
	logs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptLog<span class="token punctuation">{</span><span class="token punctuation">{</span>echotypes<span class="token punctuation">.</span>TyLogPing<span class="token punctuation">,</span> types<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>xx<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	kv <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>KeyValue<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>KeyPrefixPing<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	receipt <span class="token operator">:=</span> <span class="token operator">&amp;</span>types<span class="token punctuation">.</span>Receipt<span class="token punctuation">{</span>types<span class="token punctuation">.</span>ExecOk<span class="token punctuation">,</span> kv<span class="token punctuation">,</span> logs<span class="token punctuation">}</span>
	<span class="token keyword">return</span> receipt<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">Exec_Pang</span><span class="token punctuation">(</span>ping <span class="token operator">*</span>echotypes<span class="token punctuation">.</span>Pang<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Receipt<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	msg <span class="token operator">:=</span> ping<span class="token punctuation">.</span>Msg
	res <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%s, pang pang pang!&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
	xx <span class="token operator">:=</span> <span class="token operator">&amp;</span>echotypes<span class="token punctuation">.</span>PangLog<span class="token punctuation">{</span>Msg<span class="token punctuation">:</span>msg<span class="token punctuation">,</span> Echo<span class="token punctuation">:</span>res<span class="token punctuation">}</span>
	logs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptLog<span class="token punctuation">{</span><span class="token punctuation">{</span>echotypes<span class="token punctuation">.</span>TyLogPang<span class="token punctuation">,</span> types<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>xx<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	kv <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>KeyValue<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>KeyPrefixPang<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	receipt <span class="token operator">:=</span> <span class="token operator">&amp;</span>types<span class="token punctuation">.</span>Receipt<span class="token punctuation">{</span>types<span class="token punctuation">.</span>ExecOk<span class="token punctuation">,</span> kv<span class="token punctuation">,</span> logs<span class="token punctuation">}</span>
	<span class="token keyword">return</span> receipt<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="新增区块-2"><a href="#新增区块-2" class="header-anchor">#</a> 新增区块</h3> <blockquote><p>executor/exec_local.go</p> <p>根据交易执行生成的收据信息，执行对应的本地附加逻辑，实现逻辑如下：</p> <p>以ExecLocal_Ping为例，它根据ping操作的交易执行生成的PingLog，获取到msg信息(还是以hello为例)，然后组装成固定的KEY &quot;LODB-echo-ping:hello&quot;，然后从LocalDB中读取此KEY数据，并将此消息的调用次数加1，最后将新的KV信息返回；系统会将新的KV写入LocalDB中。</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> executor
<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	echotypes <span class="token string">&quot;github.com/33cn/plugin/plugin/dapp/echo/types&quot;</span>
	<span class="token string">&quot;github.com/33cn/chain33/types&quot;</span>
<span class="token punctuation">)</span>
<span class="token comment">// 交易执行成功，将本消息对应的数值加1</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">ExecLocal_Ping</span><span class="token punctuation">(</span>ping <span class="token operator">*</span>echotypes<span class="token punctuation">.</span>Ping<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 这里简化处理，不做基本的零值及错误检查了</span>
	<span class="token keyword">var</span> pingLog echotypes<span class="token punctuation">.</span>PingLog
	types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>receipt<span class="token punctuation">.</span>Logs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Log<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pingLog<span class="token punctuation">)</span>
	localKey <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>KeyPrefixPingLocal<span class="token punctuation">,</span> pingLog<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
	oldValue<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">GetLocalDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>localKey<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> err <span class="token operator">!=</span> types<span class="token punctuation">.</span>ErrNotFound <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>oldValue<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pingLog<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	pingLog<span class="token punctuation">.</span>Count <span class="token operator">+=</span> <span class="token number">1</span>
	kv <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>KeyValue<span class="token punctuation">{</span><span class="token punctuation">{</span>localKey<span class="token punctuation">,</span> types<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pingLog<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">{</span>kv<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
<span class="token comment">// 交易执行成功，将本消息对应的数值加1</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">ExecLocal_Pang</span><span class="token punctuation">(</span>ping <span class="token operator">*</span>echotypes<span class="token punctuation">.</span>Pang<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 这里简化处理，不做基本的零值及错误检查了</span>
	<span class="token keyword">var</span> pangLog echotypes<span class="token punctuation">.</span>PangLog
	types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>receipt<span class="token punctuation">.</span>Logs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Log<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pangLog<span class="token punctuation">)</span>
	localKey <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>KeyPrefixPangLocal<span class="token punctuation">,</span> pangLog<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
	oldValue<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">GetLocalDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>localKey<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> err <span class="token operator">!=</span> types<span class="token punctuation">.</span>ErrNotFound <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>oldValue<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pangLog<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	pangLog<span class="token punctuation">.</span>Count <span class="token operator">+=</span> <span class="token number">1</span>
	kv <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>KeyValue<span class="token punctuation">{</span><span class="token punctuation">{</span>localKey<span class="token punctuation">,</span> types<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pangLog<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">{</span>kv<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="回滚区块-2"><a href="#回滚区块-2" class="header-anchor">#</a> 回滚区块</h3> <blockquote><p>executor/exec_del_local.go</p> <p>根据交易执行生成的收据信息，执行对应的本地附加逻辑，实现逻辑如下：</p> <p>以ExecLocal_Ping为例，和上面新增区块逻辑相反，这里会将消息的调用计数减1，如果减到0，则会删除此条数据。</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> executor
<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	echotypes <span class="token string">&quot;github.com/33cn/plugin/plugin/dapp/echo/types&quot;</span>
	<span class="token string">&quot;github.com/33cn/chain33/types&quot;</span>
<span class="token punctuation">)</span>
<span class="token comment">// 交易执行成功，将本消息对应的数值减1</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">ExecDelLocal_Ping</span><span class="token punctuation">(</span>ping <span class="token operator">*</span>echotypes<span class="token punctuation">.</span>Ping<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 这里简化处理，不做基本的零值及错误检查了</span>
	<span class="token keyword">var</span> pingLog echotypes<span class="token punctuation">.</span>PingLog
	types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>receipt<span class="token punctuation">.</span>Logs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Log<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pingLog<span class="token punctuation">)</span>
	localKey <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>KeyPrefixPingLocal<span class="token punctuation">,</span> pingLog<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
	oldValue<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">GetLocalDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>localKey<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>oldValue<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pingLog<span class="token punctuation">)</span>
	<span class="token keyword">if</span> pingLog<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		pingLog<span class="token punctuation">.</span>Count <span class="token operator">-=</span> <span class="token number">1</span>
	<span class="token punctuation">}</span>
	val <span class="token operator">:=</span> types<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pingLog<span class="token punctuation">)</span>
	<span class="token keyword">if</span> pingLog<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		val <span class="token operator">=</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
	kv <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>KeyValue<span class="token punctuation">{</span><span class="token punctuation">{</span>localKey<span class="token punctuation">,</span> val<span class="token punctuation">}</span><span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">{</span>kv<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
<span class="token comment">// 交易执行成功，将本消息对应的数值减1</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">ExecDelLocal_Pang</span><span class="token punctuation">(</span>ping <span class="token operator">*</span>echotypes<span class="token punctuation">.</span>Pang<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 这里简化处理，不做基本的零值及错误检查了</span>
	<span class="token keyword">var</span> pangLog echotypes<span class="token punctuation">.</span>PangLog
	types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>receipt<span class="token punctuation">.</span>Logs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Log<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pangLog<span class="token punctuation">)</span>
	localKey <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>KeyPrefixPangLocal<span class="token punctuation">,</span> pangLog<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
	oldValue<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">GetLocalDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>localKey<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>oldValue<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pangLog<span class="token punctuation">)</span>
	<span class="token keyword">if</span> pangLog<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		pangLog<span class="token punctuation">.</span>Count <span class="token operator">-=</span> <span class="token number">1</span>
	<span class="token punctuation">}</span>
	val <span class="token operator">:=</span> types<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pangLog<span class="token punctuation">)</span>
	<span class="token keyword">if</span> pangLog<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		val <span class="token operator">=</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
	kv <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>KeyValue<span class="token punctuation">{</span><span class="token punctuation">{</span>localKey<span class="token punctuation">,</span> val<span class="token punctuation">}</span><span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">{</span>kv<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="历史查询-2"><a href="#历史查询-2" class="header-anchor">#</a> 历史查询</h3> <blockquote><p>executor/query.go</p> <p>查询交易生成的数据，本合约实现了两个查询方法，分别查询ping操作和pang操作，针对某一个msg的调用次数，实现逻辑如下：</p> <p>以Query_Ping为例，根据查询请求传入的msg，使用同样的规则拼装KEY，然后从LocalDB中查询新增区块时写入的数据，然后返回此消息的调用次数信息。</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> executor
<span class="token keyword">import</span> <span class="token punctuation">(</span>
	echotypes <span class="token string">&quot;github.com/33cn/plugin/plugin/dapp/echo/types&quot;</span>
	<span class="token string">&quot;github.com/33cn/chain33/types&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">Query_GetPing</span><span class="token punctuation">(</span>in <span class="token operator">*</span>echotypes<span class="token punctuation">.</span>Query<span class="token punctuation">)</span> <span class="token punctuation">(</span>types<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> pingLog echotypes<span class="token punctuation">.</span>PingLog
	localKey <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>KeyPrefixPingLocal<span class="token punctuation">,</span> in<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
	value<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">GetLocalDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>localKey<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pingLog<span class="token punctuation">)</span>
	res <span class="token operator">:=</span> echotypes<span class="token punctuation">.</span>QueryResult<span class="token punctuation">{</span>Msg<span class="token punctuation">:</span>in<span class="token punctuation">.</span>Msg<span class="token punctuation">,</span> Count<span class="token punctuation">:</span>pingLog<span class="token punctuation">.</span>Count<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>res<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">Query_GetPang</span><span class="token punctuation">(</span>in <span class="token operator">*</span>echotypes<span class="token punctuation">.</span>Query<span class="token punctuation">)</span> <span class="token punctuation">(</span>types<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> pangLog echotypes<span class="token punctuation">.</span>PangLog
	localKey <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>KeyPrefixPangLocal<span class="token punctuation">,</span> in<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
	value<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">GetLocalDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>localKey<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pangLog<span class="token punctuation">)</span>
	res <span class="token operator">:=</span> echotypes<span class="token punctuation">.</span>QueryResult<span class="token punctuation">{</span>Msg<span class="token punctuation">:</span>in<span class="token punctuation">.</span>Msg<span class="token punctuation">,</span> Count<span class="token punctuation">:</span> pangLog<span class="token punctuation">.</span>Count<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>res<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="创建交易逻辑"><a href="#创建交易逻辑" class="header-anchor">#</a> 创建交易逻辑</h3> <blockquote><p>types/echo.go</p> <p>前面基本已经实现了执行器的大部分逻辑，但是如果想要在区块链上调用此执行器，还需要创建本执行器合约相关的交易，创建交易的逻辑在执行器类型对象中实现。</p> <p>需要实现CreateTx接口方法，示例如下：</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> types

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;encoding/json&quot;</span>
	<span class="token string">&quot;math/rand&quot;</span>
	<span class="token string">&quot;strings&quot;</span>
	<span class="token string">&quot;time&quot;</span>
	<span class="token string">&quot;github.com/33cn/chain33/types&quot;</span>
	<span class="token string">&quot;github.com/33cn/chain33/common/address&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>e EchoType<span class="token punctuation">)</span> <span class="token function">CreateTx</span><span class="token punctuation">(</span>action <span class="token builtin">string</span><span class="token punctuation">,</span> message json<span class="token punctuation">.</span>RawMessage<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	elog<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token string">&quot;echo.CreateTx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;action&quot;</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span>
	<span class="token comment">// 只接受ping/pang两种交易操作</span>
	<span class="token keyword">if</span> action <span class="token operator">==</span> <span class="token string">&quot;ping&quot;</span> <span class="token operator">||</span> action <span class="token operator">==</span> <span class="token string">&quot;pang&quot;</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> param EchoTx
		err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token operator">&amp;</span>param<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			elog<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;CreateTx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Error&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> types<span class="token punctuation">.</span>ErrInvalidParam
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token function">createPingTx</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> <span class="token operator">&amp;</span>param<span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> types<span class="token punctuation">.</span>ErrNotSupport
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">createPingTx</span><span class="token punctuation">(</span>op <span class="token builtin">string</span><span class="token punctuation">,</span> parm <span class="token operator">*</span>EchoTx<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> action <span class="token operator">*</span>EchoAction
	<span class="token keyword">var</span> err <span class="token builtin">error</span>
	<span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">EqualFold</span><span class="token punctuation">(</span>op<span class="token punctuation">,</span> <span class="token string">&quot;ping&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		action<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">getPingAction</span><span class="token punctuation">(</span>parm<span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		action<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">getPangAction</span><span class="token punctuation">(</span>parm<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	tx <span class="token operator">:=</span> <span class="token operator">&amp;</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">{</span>
		Execer<span class="token punctuation">:</span>  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">ExecName</span><span class="token punctuation">(</span>EchoX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		Payload<span class="token punctuation">:</span> types<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">,</span>
		Nonce<span class="token punctuation">:</span>   rand<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">NewSource</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Int63</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		To<span class="token punctuation">:</span>      address<span class="token punctuation">.</span><span class="token function">ExecAddress</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">ExecName</span><span class="token punctuation">(</span>EchoX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> tx<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">getPingAction</span><span class="token punctuation">(</span>parm <span class="token operator">*</span>EchoTx<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>EchoAction<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	pingAction <span class="token operator">:=</span> <span class="token operator">&amp;</span>Ping<span class="token punctuation">{</span>Msg<span class="token punctuation">:</span> parm<span class="token punctuation">.</span>Message<span class="token punctuation">}</span>
	action <span class="token operator">:=</span> <span class="token operator">&amp;</span>EchoAction<span class="token punctuation">{</span>
		Value<span class="token punctuation">:</span> <span class="token operator">&amp;</span>EchoAction_Ping<span class="token punctuation">{</span>Ping<span class="token punctuation">:</span> pingAction<span class="token punctuation">}</span><span class="token punctuation">,</span>
		Ty<span class="token punctuation">:</span>    ActionPing<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> action<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">getPangAction</span><span class="token punctuation">(</span>parm <span class="token operator">*</span>EchoTx<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>EchoAction<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	pangAction <span class="token operator">:=</span> <span class="token operator">&amp;</span>Pang<span class="token punctuation">{</span>Msg<span class="token punctuation">:</span> parm<span class="token punctuation">.</span>Message<span class="token punctuation">}</span>
	action <span class="token operator">:=</span> <span class="token operator">&amp;</span>EchoAction<span class="token punctuation">{</span>
		Value<span class="token punctuation">:</span> <span class="token operator">&amp;</span>EchoAction_Pang<span class="token punctuation">{</span>Pang<span class="token punctuation">:</span> pangAction<span class="token punctuation">}</span><span class="token punctuation">,</span>
		Ty<span class="token punctuation">:</span>    ActionPang<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> action<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><blockquote><p>types/tx.go
定义消息结构体</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> types

<span class="token keyword">type</span> EchoTx <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Message   <span class="token builtin">string</span> <span class="token string">`json:&quot;msg&quot;`</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="注册执行器"><a href="#注册执行器" class="header-anchor">#</a> 注册执行器</h3> <blockquote><p>plugin.go</p> <p>向系统注册本dapp插件，实现逻辑如下：</p> <p>一般情况下一个完整的dapp至少还要包含对应的命令行和rpc接口，可参考对应的章节进行实现。</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> echo

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/33cn/chain33/pluginmgr&quot;</span>
	<span class="token string">&quot;github.com/33cn/plugin/plugin/dapp/echo/executor&quot;</span>
	echotypes  <span class="token string">&quot;github.com/33cn/plugin/plugin/dapp/echo/types&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	pluginmgr<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pluginmgr<span class="token punctuation">.</span>PluginBase<span class="token punctuation">{</span>
		Name<span class="token punctuation">:</span>     <span class="token string">&quot;echo&quot;</span><span class="token punctuation">,</span>
		ExecName<span class="token punctuation">:</span> echotypes<span class="token punctuation">.</span>EchoX<span class="token punctuation">,</span>
		Exec<span class="token punctuation">:</span>     executor<span class="token punctuation">.</span>Init<span class="token punctuation">,</span>
		Cmd<span class="token punctuation">:</span>      <span class="token boolean">nil</span><span class="token punctuation">,</span>
		RPC<span class="token punctuation">:</span>      <span class="token boolean">nil</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><blockquote><p>plugin/init/init.go</p> <p>在init.go中导入本执行器：</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token boolean">_</span> <span class="token string">&quot;github.com/33cn/plugin/plugin/dapp/echo&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="测试执行器"><a href="#测试执行器" class="header-anchor">#</a> 测试执行器</h3> <p>经过上面几个步骤，执行器已经构建完成，使用chain33自带的部署工具部署完成后，可以测试下我们开发的执行器运行效果。</p> <ul><li>执行Ping操作</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> --data-binary <span class="token string">'{&quot;jsonrpc&quot;:&quot;2.0&quot;, &quot;id&quot;: 1, &quot;method&quot;:&quot;Chain33.CreateTransaction&quot;,&quot;params&quot;:[{&quot;execer&quot;:&quot;echo&quot;, &quot;actionName&quot;:&quot;ping&quot;, &quot;payload&quot;:{&quot;msg&quot;: &quot;hello&quot;}}] }'</span> <span class="token punctuation">\</span>
    -H <span class="token string">'content-type:text/plain;'</span> <span class="token punctuation">\</span>
    http://localhost:8801
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>其中，msg属性即为我们要发送的ping消息内容，可自行更改。</p> <p>输出结果如下：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;result&quot;</span><span class="token operator">:</span><span class="token string">&quot;0a046563686f12090a070a0568656c6c6f3081ec84bab6b28bbe6c3a223145414b6f7252777837426b51536e575155594b725558594e716f6d31473154366b&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;error&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其中，result内容即为未签名的交易原始内容。</p> <ul><li>对交易进行签名</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code> <span class="token function">curl</span> --data-binary <span class="token string">'{&quot;jsonrpc&quot;:&quot;2.0&quot;, &quot;id&quot;: 1, &quot;method&quot;:&quot;Chain33.SignRawTx&quot;,&quot;params&quot;:[{&quot;addr&quot;:&quot;1KhZDqKCFWgmCnWzmYhfBkjnW1AZ1SEdDn&quot;, &quot;expire&quot;:&quot;2h&quot;, &quot;txHex&quot;:&quot;0a046563686f12090a070a0568656c6c6f3081ec84bab6b28bbe6c3a223145414b6f7252777837426b51536e575155594b725558594e716f6d31473154366b&quot;}] }'</span> <span class="token punctuation">\</span>
    -H <span class="token string">'content-type:text/plain;'</span> <span class="token punctuation">\</span>
    http://localhost:8901
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>其中，txHex内容为上一步输出的结果，未签名的交易内容。addr为发送此交易的地址，可更改为自己的地址信息。</p> <p>输出结果如下：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;result&quot;</span><span class="token operator">:</span><span class="token string">&quot;0a046563686f12090a070a0568656c6c6f1a6d0801122102114453cbc6043184f17c106a21d65898c844e0b10bac38d9097229f537d09d331a46304402204f64f315637bf7bcdf82ef321c4516f7e77582ca854b301d2374d9248fa373d502202f1f24d769636a006652a0e96eee4579b7b6ae74295f0b8b3a912521cd71c3a328a9e6ffde053081ec84bab6b28bbe6c3a223145414b6f7252777837426b51536e575155594b725558594e716f6d31473154366b&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;error&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其中，result为经过签名的交易内容。</p> <ul><li>发送交易</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code> <span class="token function">curl</span> --data-binary <span class="token string">'{&quot;jsonrpc&quot;:&quot;2.0&quot;, &quot;id&quot;: 1, &quot;method&quot;:&quot;Chain33.SendTransaction&quot;,&quot;params&quot;:[{&quot;data&quot;:&quot;0a046563686f12090a070a0568656c6c6f1a6d0801122102114453cbc6043184f17c106a21d65898c844e0b10bac38d9097229f537d09d331a46304402204f64f315637bf7bcdf82ef321c4516f7e77582ca854b301d2374d9248fa373d502202f1f24d769636a006652a0e96eee4579b7b6ae74295f0b8b3a912521cd71c3a328a9e6ffde053081ec84bab6b28bbe6c3a223145414b6f7252777837426b51536e575155594b725558594e716f6d31473154366b&quot;}] }'</span> <span class="token punctuation">\</span>
    -H <span class="token string">'content-type:text/plain;'</span> <span class="token punctuation">\</span>
    http://localhost:8901 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>其中，data为签名后的交易内容。</p> <p>输出结果如下：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;result&quot;</span><span class="token operator">:</span><span class="token string">&quot;0xe912cdf7b7d132bf7915e0db80bad8be6ce2510c60c25b66fa96dff7cec89404&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;error&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其中，result为发送交易的哈希，可以使用下面命令查看具体的交易发送信息：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>./chain33-cli tx query -s 0xe912cdf7b7d132bf7915e0db80bad8be6ce2510c60c25b66fa96dff7cec89404
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>查询历史数据</li></ul> <p>重复测试几次，然后调用下面的命令，来查询携带hello消息的ping操作被调用了多少次：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code> <span class="token function">curl</span> --data-binary <span class="token string">'{&quot;jsonrpc&quot;:&quot;2.0&quot;, &quot;id&quot;: 1, &quot;method&quot;:&quot;Chain33.Query&quot;,&quot;params&quot;:[{&quot;execer&quot;:&quot;echo&quot;, &quot;funcName&quot;:&quot;GetPing&quot;, &quot;payload&quot;:{&quot;msg&quot;: &quot;hello&quot;}}] }'</span> <span class="token punctuation">\</span>
    -H <span class="token string">'content-type:text/plain;'</span> <span class="token punctuation">\</span>
    http://localhost:8901
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>输出结果如下：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;result&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;msg&quot;</span><span class="token operator">:</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;count&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;error&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/bityuan/bty-docs/edit/main/zh/guide/05.开发进阶/1.功能模块/7.执行器模块.md" target="_blank" rel="noopener noreferrer">编辑此页</a></div> <div class="meta-item update-time"><span class="label">上次编辑于:</span> <span class="info">2023年9月7日 17:13</span></div> <!----></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.f3c503cb.js" defer></script><script src="/assets/js/vendors~layout-Layout.1136eb17.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.273fc434.js" defer></script><script src="/assets/js/page-执行器模块.a346e5c7.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.4a182f2f.js" defer></script>
  </body>
</html>
