(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{657:function(s,n,a){"use strict";a.r(n);var e=a(1),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"ethers-js-环境搭建和基本操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ethers-js-环境搭建和基本操作"}},[s._v("#")]),s._v(" ethers.js 环境搭建和基本操作")]),s._v(" "),a("h3",{attrs:{id:"_1-安装-ethers-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-ethers-js"}},[s._v("#")]),s._v(" 1. 安装 ethers.js")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 最新版本是6.x, 演示使用的是5.7.2版本\nnpm install ethers@5.7.2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_2-ethers-js-常用查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ethers-js-常用查询"}},[s._v("#")]),s._v(" 2. ethers.js 常用查询")]),s._v(" "),a("p",[s._v("ethers.js 接口文档： https://docs.ethers.org/v5/")]),s._v(" "),a("ul",[a("li",[s._v("下面演示的接口都是基于 V5 的版本， V5 和 V6 版本的接口有区别，要注意区分版本")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# 连接区块链\nconst { ethers } = require("ethers");\n// rpc连接\nconst provider = new ethers.JsonRpcProvider("http://localhost:8545");\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("以下列举的都是适用于 chain33 的常用查询接口")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('// 查询区块高度\nconst blocknumber = await provider.getBlockNumber();\nconsole.log(`区块高度：${blocknumber}`)\n\n// 查询账户余额\nconst balance = await provider.getBalance("0x4797A444f34C26e71803A1d98D5031a3cAE70650")\n\n// 格式化账户余额\nconst balanceformat = ethers.utils.formatEther(balance)\nconsole.log(`账户余额：${balanceformat}`)\n\n// 获得账户交易数\nconst txCount = await  provider.getTransactionCount("0x4797A444f34C26e71803A1d98D5031a3cAE70650")\nconsole.log(`账户交易数：${txCount}`)\n\n// 获取链ID\nconst chainId = (await provider.getNetwork()).chainId\nconsole.log(`ChainId：${chainId}`)\n\n// 获取节点上账户信息\nconst listenerCount = await provider.listAccounts()\nconsole.log(listenerCount)\n\n// 获取交易信息\nconst txInfo = await provider.getTransaction("0x1cfe5918bdd29772c0c57ae6f702c62636318dbe7f27145e3c386aeaa67a8bca")\nconsole.log(txInfo)\n\n// 获取交易回执\nconst txreceipt = await provider.getTransactionReceipt("0x1cfe5918bdd29772c0c57ae6f702c62636318dbe7f27145e3c386aeaa67a8bca")\nconsole.log(txreceipt)\n\n// 获取区块信息\nconst blockInfo = await provider.getBlock(10)\nconsole.log(blockInfo)\n\n// 获取指定合约地址的合约bytecode\nconst code = await provider.getCode("0x61b35E8804F87589fBb7da3A6B68c563C05Bb2f1")\nconsole.log(code)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("h3",{attrs:{id:"_3-ethers-js-发送转账交易-rpc-接口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-ethers-js-发送转账交易-rpc-接口"}},[s._v("#")]),s._v(" 3 ethers.js 发送转账交易(rpc 接口)")]),s._v(" "),a("p",[s._v("TODO: 这种方式 chain33 支持上还有些问题, 发送交易返回的 hash 是 chain33 原生的,导致交易检查不通过\n已经提了 issue 让他们解决.")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('// 发送方私钥\n   const privatekey = "0x76491916cf0e70437cbed8c2ce9ac2241221e56f8e64ec74e3282b07f24018e1";\n\n   // 创建一个钱包\n   const wallet = new ethers.Wallet(privatekey, provider);\n\n   // 设置接收方地址\n   const toAddress = \'0xFd89C32962f19bcEA69B76093a64A03618cB33BE\';\n\n   // 设置转账数量\n   const value = ethers.utils.parseEther(\'12345.0\');\n\n   // 创建交易对象\n   const tx = {\n       to: toAddress,\n       value: value,\n       gasLimit: 21000,\n       gasPrice: ethers.utils.parseUnits("10", "gwei"),\n       chainId: 999,\n       nonce: await provider.getTransactionCount(wallet.address)\n   };\n\n   // 签名交易\n   const signedTx = await wallet.signTransaction(tx);\n\n   // 发送交易\n   provider.sendTransaction(signedTx)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("h3",{attrs:{id:"_4-ethers-js-发送转账交易-metamask"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-ethers-js-发送转账交易-metamask"}},[s._v("#")]),s._v(" 4 ethers.js 发送转账交易(metamask)")]),s._v(" "),a("ol",[a("li",[s._v("导入 ethers.js")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('<script src="https://cdn.ethers.io/lib/ethers-5.5.2.umd.min.js"><\/script>\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("连接 matemask,签名并发送交易")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" <script>\n     window.addEventListener('load', async () => {\n       // Wait for MetaMask to be installed\n       if (typeof window.ethereum === 'undefined') {\n         alert('Please install MetaMask first.');\n         return;\n       }\n\n       // Request account access from MetaMask\n       await window.ethereum.enable();\n\n       // Connect to the Ethereum network using ethers.js\n       const provider = new ethers.providers.Web3Provider(window.ethereum);\n\n       // Create a signer object to sign transactions with\n       const signer = provider.getSigner();\n\n       // Get the user's Ethereum address\n       const address = await signer.getAddress();\n\n       // Listen for form submission\n       document.getElementById('send-form').addEventListener('submit', async (event) => {\n         event.preventDefault();\n\n         // Get form data\n         const to = \"to address\";\n         const value = \"amount\";\n\n         // Create a transaction object\n         const tx = {\n           to,\n           value\n         };\n\n         // Sign and send the transaction\n         const result = await signer.sendTransaction(tx);\n         console.log('Transaction result:', result);\n       });\n     });\n   <\/script>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);