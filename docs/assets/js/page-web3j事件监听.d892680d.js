(window.webpackJsonp=window.webpackJsonp||[]).push([[95],{644:function(e,n,s){"use strict";s.r(n);var t=s(1),a=Object(t.a)({},(function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"web3j-事件监听"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#web3j-事件监听"}},[e._v("#")]),e._v(" web3j 事件监听")]),e._v(" "),s("p",[e._v("概念描述"),s("a",{attrs:{href:"https://github.com/andyYuanFZM/Chain33_Dapp_develop/blob/main/L8%20web3.js%E5%90%88%E7%BA%A6%E4%BA%8B%E4%BB%B6/L8_readme.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("[参考L8]"),s("OutboundLink")],1)]),e._v(" "),s("h3",{attrs:{id:"_1-查询合约历史事件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-查询合约历史事件"}},[e._v("#")]),e._v(" 1. 查询合约历史事件")]),e._v(" "),s("p",[e._v("web3j.ethGetLogs(filter)\n过滤器对象：")]),e._v(" "),s("ul",[s("li",[e._v("fromBlock: 起始区块（最小值支持从 1 开始）")]),e._v(" "),s("li",[e._v("toBlock: 终止区块， 这个参数不带代表一直到最大区块")]),e._v(" "),s("li",[e._v("address: 合约地址")]),e._v(" "),s("li",[e._v("event: 事件名和参数")])]),e._v(" "),s("p",[e._v("示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('// 要查询的事件\nEvent event = new Event("TokenMinted", Arrays.asList(new TypeReference<Uint256>() {},\n        new TypeReference<Uint256>() {},\n        new TypeReference<Utf8String>() {}));\n\nEthFilter filter = new EthFilter(\n                DefaultBlockParameterName.EARLIEST, // 日志的起始区块\n                DefaultBlockParameterName.LATEST, // 日志的结束区块\n                contractAddress // 查询的智能合约地址\n);\n\n// 添加event类型及其参数\nfilter.addSingleTopic(EventEncoder.encode(event));\n\n// 获取符合过滤器条件的所有日志\nEthLog log = web3j.ethGetLogs(filter).send();\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br")])]),s("h3",{attrs:{id:"_2-订阅区块链中的指定事件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-订阅区块链中的指定事件"}},[e._v("#")]),e._v(" 2. 订阅区块链中的指定事件")]),e._v(" "),s("p",[e._v("web3j.ethLogFlowable(filter).subscribe(log -> {})")]),e._v(" "),s("p",[e._v("示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('// 要监听的事件\nEvent event = new Event("TokenMinted", Arrays.asList(new TypeReference<Uint256>() {},\n        new TypeReference<Uint256>() {},\n        new TypeReference<Utf8String>() {}));\n\n// 过滤开始区块，结束区块，合约地址\nEthFilter filter = new EthFilter(\n    DefaultBlockParameterName.EARLIEST, DefaultBlockParameterName.LATEST, contractAddress);\n\nfilter.addSingleTopic(EventEncoder.encode(event));\n\nweb3j.ethLogFlowable(filter).subscribe(log -> {\n\n    System.out.println(log.getTopics());\n\n    // 解码非index参数\n    List<Type> results = FunctionReturnDecoder.decode(log.getData(), event.getNonIndexedParameters());\n    BigInteger value = (BigInteger) results.get(0).getValue();\n    System.out.println("supply is: " +  value);\n});\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br")])])])}),[],!1,null,null,null);n.default=a.exports}}]);