(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{578:function(s,a,n){"use strict";n.r(a);var e=n(1),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"ca工具使用说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ca工具使用说明"}},[s._v("#")]),s._v(" CA工具使用说明")]),s._v(" "),n("blockquote",[n("p",[s._v("chain33-ca-tool是平行链自带的CA证书生成工具，可根据配置文件生成证书文件，包含根证书、中间证书和用户证书。")])]),s._v(" "),n("h2",{attrs:{id:"工具下载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#工具下载"}},[s._v("#")]),s._v(" 工具下载")]),s._v(" "),n("p",[n("strong",[s._v("下载CA工具")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("wget https://bty33.oss-cn-shanghai.aliyuncs.com/chain33-ca-tool.tar.gz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("解压到任意指定目录")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("tar -xzvf chain33-ca-tool.tar.gz\ncd chain33-ca-tool\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("font",{attrs:{color:"blue"}},[s._v("说明：")]),s._v("软件包包含CA工具可执行文件"),n("code",[s._v("chain33-ca-tool")]),s._v("和配置文件"),n("code",[s._v("chain33.cryptogen.yaml")]),s._v("。")],1),s._v(" "),n("h2",{attrs:{id:"修改配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件"}},[s._v("#")]),s._v(" 修改配置文件")]),s._v(" "),n("p",[s._v("根据实际场景修改chain33.cryptogen.yaml配置文件。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("//签名方式，默认auth_sm2，支持auth_ecdsa\nSignType: auth_sm2\n//根证书配置\nRoot:\n  //证书名\n  Name: ca\n  //签发证书配置\n  CA:\n    CommonName: Chain33CA\n    Country: China\n    Province: Zhejiang\n    Locality: Hangzhou\n    Expire: 100\n  //用户名\n  User:\n    - Name: org1\n    - Name: org2  \n\n//中间证书配置\nOrganizations:\n  //企业org1证书配置\n  - Name: org1\n    CA:\n      CommonName: org1CA\n      Country: China\n      Province: Zhejiang\n      Locality: Hangzhou\n      Expire: 100\n    User:\n      - Name: user1\n      - Name: user2\n  \n//企业org2证书配置\n  - Name: org2\n    CA:\n      CommonName: org2CA\n      Country: China\n      Province: Zhejiang\n      Locality: Hangzhou\n      Expire: 100\n    User:\n      - Name: user1\n      - Name: user2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br")])]),n("h2",{attrs:{id:"使用方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用方法"}},[s._v("#")]),s._v(" 使用方法")]),s._v(" "),n("p",[s._v("###工具使用")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("./chain33-ca-tool [-f configfile] [-o output directory]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("配置文件默认chain33.cryptogen.yaml，输出路径默认"),n("code",[s._v("./authdir/crypto")]),s._v("。")]),s._v(" "),n("p",[s._v("eg.")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("./chain33-ca-tool -f chain33.cryptogen.yaml  \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"输出目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#输出目录"}},[s._v("#")]),s._v(" 输出目录")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("├── cacerts //根证书目录\n│   ├── ca-cert.pem //根证书文件\n│   └── d9443c03c7c272a8a96c35cd9d76203780e84707e4174ada0b82a74f3a9be5df_sk //根证书私钥\n├── org1 //企业1目录\n│   ├── cacerts //企业根证书\n│   │   └── ca-cert.pem\n│   ├── intermediatecerts //中间证书\n│   │   └── org1-cert.pem\n│   ├── keystore //企业证书私钥 \n│   │   └── 434d7b55dec2534008449bc60a8d8b4c9d334b4b4e85e3269030a27206438070_sk\n│   ├── signcerts //企业签名证书\n│   │   └── org1@ca-cert.pem\n│   ├── user1 //企业用户目录\n│   │   ├── cacerts //用户根证书\n│   │   │   └── org1-cert.pem\n│   │   ├── keystore //用户私钥\n│   │   │   └── b01568b358e336f28d86baaa27df2a07dd01b6991f82f9bc680896ce4ceeaf77_sk\n│   │   └── signcerts //用户签名证书 \n│   │       └── user1@org1-cert.pem\n│   └── user2 //与user1类似\n│       ...\n└── org2 //与org1类似\n    ...\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("h3",{attrs:{id:"chain33企业节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#chain33企业节点"}},[s._v("#")]),s._v(" chain33企业节点")]),s._v(" "),n("p",[s._v("chain33.toml配置文件打开证书校验开关。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('//是否启用证书验证和签名  \n//[exec.sub.cert]\nenable=true\n//加密文件路径\ncryptoPath="."\n//带证书签名类型，支持"auth_ecdsa", "auth_sm2"\nsignType="auth_sm2"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("将生成的org1目录下的cacerts和intermediatecerts目录拷贝到配置文件cryptoPath配置的目录，启动节点。")]),s._v(" "),n("h3",{attrs:{id:"chain33企业用户"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#chain33企业用户"}},[s._v("#")]),s._v(" chain33企业用户")]),s._v(" "),n("p",[s._v("将用户org1/user1目录下的keystore和signcerts拷贝到./test目录下。")]),s._v(" "),n("ul",[n("li",[s._v("Java语言")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('// chain33节点\nstatic RpcClient chain33client = new RpcClient("http://127.0.0.1:8801");\n// 从文件加载账户\nAccount account = new Account();\nAccountInfo accountInfo = account.loadGMAccountLocal("test", "", "./test/keystore/b01568b358e336f28d86baaa27df2a07dd01b6991f82f9bc680896ce4ceeaf77_sk");\n// 加载用户证书\nbyte[] certBytes = CertUtils.getCertFromFile("./test/signcerts/user1@org1-cert.pem");\n// 构造交易\nCertService.CertNormal.Builder normal = CertService.CertNormal.newBuilder();\nnormal.setValue(ByteString.copyFrom("value123".getBytes()));\nnormal.setKey("key123");\nCertService.CertNormal normalAction = normal.build();\nCertService.CertAction.Builder builder = CertService.CertAction.newBuilder();\nbuilder.setTy(CertUtils.CertActionNormal);\nbuilder.setNormal(normalAction);\nbyte[] reqBytes = builder.build().toByteArray();\nString transactionHash = TransactionUtil.createTxWithCert(accountInfo.getPrivateKey(), "cert", reqBytes, SignType.SM2, certBytes, "ca test".getBytes());\n// 发送交易\nString hash = chain33client.submitTransaction(transactionHash);\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("ul",[n("li",[s._v("Go语言")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('var (\n\tkeyFilePath = "./test/keystore/5c3682a5719cf5bc1bd6280938670c3acfcb67cc15744a7b9b348066795a4e62_sk"\n\tcertFilePath = "./test/signcerts/user1@org1-cert.pem"\n)\n// chain33节点\njsonclient, err := client.NewJSONClient("", "http://127.0.0.1:8801")\n// 从文件加载账户\naccount,err := sdk.NewAccountFromLocal(crypto.SM2, keyFilePath)\n// 加载用户证书\ncertByte,err := types.ReadFile(certFilePath)\n// 构造交易\ntx, err := CreateCertNormalTx("", account.PrivateKey, certByte, []byte("cert test"), "key1", []byte("value1"))\n// 发送交易\nsignTx := types.ToHexPrefix(types.Encode(tx))\nreply, err := jsonclient.SendTransaction(signTx)\n// 查询交易\ntxhash := types.ToHexPrefix(sdk.Hash(tx))\ntime.Sleep(2 * time.Second)\ndetail, err := jsonclient.QueryTransaction(txhash)\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h3",{attrs:{id:"平行链证书使用方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#平行链证书使用方法"}},[s._v("#")]),s._v(" 平行链证书使用方法")]),s._v(" "),n("ul",[n("li",[s._v("主链"),n("br"),s._v("\n将工具生成的cacerts目录和所有企业下的intermediatecerts目录拷贝到配置文件cryptoPath配置的目录，启动节点。")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("├── cacerts \n│   ├── ca-cert.pem \n├── intermediatecerts\n│   │── org1-cert.pem\n│   │── org2-cert.pem\n│   ...\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("主链校验所有平行链的用户身份，只要是所有平行链下的用户，都可以校验通过。")]),s._v(" "),n("ul",[n("li",[s._v("平行链"),n("br"),s._v("\n在配置文件cryptoPath配置的目录下创建cacerts目录，将工具生成的对应本平行链的企业目录下的intermediatecerts目录下的证书拷贝到cacerts目录下，启动节点。")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("├── cacerts \n│   └── org1-cert.pem //工具生成的企业org1的intermediatecerts目录\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("平行链校验本企业的用户，其他平行链用户校验不通过。")])])}),[],!1,null,null,null);a.default=t.exports}}]);