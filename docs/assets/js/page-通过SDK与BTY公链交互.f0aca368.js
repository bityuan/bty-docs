(window.webpackJsonp=window.webpackJsonp||[]).push([[139],{650:function(n,s,a){"use strict";a.r(s);var e=a(1),t=Object(e.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("h2",{attrs:{id:"通过-sdk-与-bty-公链交互"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过-sdk-与-bty-公链交互"}},[n._v("#")]),n._v(" 通过 SDK 与 BTY 公链交互")]),n._v(" "),a("p",[n._v("下文介绍在兼容以太坊接口之后，如何使用各语言 SDK 同 BTY 主链进行交互。")]),n._v(" "),a("h3",{attrs:{id:"_1-bty-环境说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-bty-环境说明"}},[n._v("#")]),n._v(" 1.BTY 环境说明")]),n._v(" "),a("p",[n._v("可以通过 BTY 公共节点进行交互；也可以自行部署 BTY 节点，再和自建节点交互。 前者使用比较方便，但有时受限于网络情况，不能保证一直稳定，可用于开发验证；后者需要自备服务器同步节点，但是连接稳定。")]),n._v(" "),a("ul",[a("li",[n._v("公共节点：\nrpc 接口：https://mainnet.bityuan.com/eth"),a("br"),n._v("\nwebsocket 接口： wss://mainnet.bityuan.com/ethws")]),n._v(" "),a("li",[n._v("自建节点：\n"),a("ol",[a("li",[n._v("节点下载地址： https://github.com/bityuan/bityuan/releases (从 0 开始同步，需要耗时一周以上)")]),n._v(" "),a("li",[n._v("以太坊兼容端口（可以用 ethers.js, web3j, go-ethereum 等 SDK 包进行交互）, 如果允许远程访问，需要修改配置文件中以下两个端口参数（去掉前面的 localhost）")])])])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('[rpc.sub.eth]\nhttpAddr=":8546"\nwsAddr=":8547"\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[n._v("区块链节点分全节点和分片节点（根据配置文件中的配置项区分）"),a("br"),n._v("\n3.1 全节点：存储全量信息，目前占用空间 300G 左右"),a("br"),n._v("\n3.2 分片节点： 会删除一些历史日志信息，目前占用空间 100G 左右"),a("br"),n._v("\n3.3 注意事项： 由于分片节点删除历史日志信息，会影响合约历史事件日志的查询；所以在需要用到智能合约事件监听以及历史事件日志查询的情况下，要用全节点。 其它情况下，分片节点就能满足使用要求。")])]),n._v(" "),a("h3",{attrs:{id:"_2-通过-web3j-和-bty-区块链交互"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-通过-web3j-和-bty-区块链交互"}},[n._v("#")]),n._v(" 2. 通过 web3j 和 BTY 区块链交互")]),n._v(" "),a("p",[n._v("web3j 是为 JAVA 语言提供的 SDK")]),n._v(" "),a("p",[n._v("2.1 添加 web3j 依赖")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("# 在pom.xml中添加以下依赖\n\x3c!-- web3j库 --\x3e\n<dependency>\n    <groupId>org.web3j</groupId>\n    <artifactId>core</artifactId>\n    <version>4.9.7</version>\n</dependency>\n\x3c!-- gson库 --\x3e\n<dependency>\n  <groupId>com.google.code.gson</groupId>\n  <artifactId>gson</artifactId>\n  <version>2.9.0</version>\n</dependency>\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br")])]),a("p",[n._v("2.2 常用接口："),a("br"),n._v("\nweb3j 本身接口不止以下这些，但并不是所有接口都适用于 BTY， 下面列出的是比较常用的接口：")]),n._v(" "),a("ul",[a("li",[n._v('web3.ethGetBalance("地址", DefaultBlockParameterName.LATEST): 获取账户余额')]),n._v(" "),a("li",[n._v("Convert.fromWei(balance.toString(), Convert.Unit.ETHER).toString()： 格式化余额（wei--\x3ebty）")]),n._v(" "),a("li",[n._v("web3.ethChainId(): 获取 chainid")]),n._v(" "),a("li",[n._v("web3.ethGetBlockByNumber(): 根据区块号获取区块信息")]),n._v(" "),a("li",[n._v('web3.ethGetTransactionByHash("交易 hash"): 根据交易 hash 获取交易内容')]),n._v(" "),a("li",[n._v("web3.ethGasPrice()： 获取 gasprice")]),n._v(" "),a("li",[n._v("Keys.createEcKeyPair().getPrivateKey(): 获取用户私钥")]),n._v(" "),a("li",[n._v('Credentials.create("用户私钥"): 根据私钥获取转账凭证')]),n._v(" "),a("li",[n._v('Credentials.create("用户私钥").getAddress()： 获取用户地址')]),n._v(" "),a("li",[n._v('Convert.toWei("转账数量", Convert.Unit.ETHER).toBigInteger()： 格式化转帐金额 (bty--\x3ewei)')]),n._v(" "),a("li",[n._v("RawTransaction.createEtherTransaction(nonce, gasPrice, gasLimit, to, value)： 创建交易对象")]),n._v(" "),a("li",[n._v("TransactionEncoder.signMessage(交易对象, chainid, 转账凭证)： 签名交易")]),n._v(" "),a("li",[n._v("web3.ethSendRawTransaction()： 交易上链")])]),n._v(" "),a("p",[n._v("注意事项： BTY 原来采用的是 BTC 的地址格式，如果资产在 BTC 地址格式下， 同样可以通过使用该地址的私钥签名，转给以太坊格式的地址（0x）开头。")]),n._v(" "),a("p",[n._v("2.3 使用参考：")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('/**\n* 通过JAVA代码同BTY区块链交互\n*\n*/\npublic class L17\n{\n   // 私钥，用于转账测试(from)\n   private static final String privateKey = "0x13f9a8ae7ba07878fb37e93a5fd624e6fedd028d9556581618c29931855c52e6";\n   // 私钥对应的地址，用于转账测试(from)\n   private static final String address = "0xcccda5358462f3cb7bf781b1003da66498bf4a56";\n   // to地址，用于转账测试(to)\n   private static final String toaddress = "0xFd89C32962f19bcEA69B76093a64A03618cB33BE";\n\n   public static void main( String[] args ) throws InterruptedException, ExecutionException, IOException, InvalidAlgorithmParameterException, NoSuchAlgorithmException, NoSuchProviderException\n   {\n       // 建立连接,此处用的是临时BTY节点，后面要替换成自己的BTY节点\n       Web3j web3 = Web3j.build(new HttpService("https://mainnet.bityuan.com/eth"));\n\n       // 获取区块高度\n       EthBlockNumber  ethBlockNumber = web3.ethBlockNumber().sendAsync().get();\n       BigInteger blockNumber = ethBlockNumber.getBlockNumber();\n       System.out.println("BlockNumber:" + blockNumber + "\\r\\n");\n\n       // 查询账户余额\n       BigInteger balance = web3.ethGetBalance(address, DefaultBlockParameterName.LATEST).send().getBalance();\n       System.out.println("Balance before format:" + balance + "\\r\\n");\n\n       // 格式化账户余额\n       String balanceStr = Convert.fromWei(balance.toString(), Convert.Unit.ETHER).toString();\n       System.out.println("Balance after format:" + balanceStr + "\\r\\n");\n\n       // 获取chainid\n       BigInteger chainId = web3.ethChainId().send().getChainId();\n       System.out.println("ChainId:" + chainId + "\\r\\n");\n\n       // 根据区块号获取区块信息\n       DefaultBlockParameterNumber defaultBlockParameterNumber = new DefaultBlockParameterNumber(26000000);\n       EthBlock ethBlock = web3.ethGetBlockByNumber(defaultBlockParameterNumber,true).sendAsync().get();\n       EthBlock.Block block = ethBlock.getBlock();\n       Gson gson = new Gson();\n       String info = gson.toJson(block);\n       System.out.println("BlockInfo:" + info + "\\r\\n");\n\n       // 获取区块交易信息\n       List<EthBlock.TransactionResult> transactions = block.getTransactions();\n       List<Transaction> txInfos = new ArrayList<>();\n       transactions.forEach(txInfo->{\n           Transaction transaction = (Transaction)txInfo;\n           txInfos.add(transaction);\n       });\n       String transactionInfos = gson.toJson(txInfos);\n       System.out.println("TransactionInfos:" + transactionInfos + "\\r\\n");\n       // 获取第一笔交易的hash值，用于下面的查询交易信息\n       String txHash = txInfos.get(0).getHash();\n\n       // 根据hash获取交易信息\n       EthTransaction transaction = web3.ethGetTransactionByHash(txHash).sendAsync().get();\n       Optional<Transaction> optionalTransaction = transaction.getTransaction();\n       StringBuilder txInfo = new StringBuilder();\n       if(optionalTransaction.isPresent()){\n           Transaction transactionInfo = optionalTransaction.get();\n           txInfo.append(gson.toJson(transactionInfo));\n       }\n       System.out.println("TransactionInfo:" + txInfo.toString() + "\\r\\n");\n\n       // 生成以太坊地址和私钥的方法\n       // ECKeyPair keyPair = Keys.createEcKeyPair();\n       // String privateKey = Numeric.toHexStringNoPrefix(keyPair.getPrivateKey());\n       // Credentials credentials = Credentials.create(keyPair);\n       // String address = credentials.getAddress();\n       // System.out.println("address:" + address);\n       // System.out.println("privateKey:" + privateKey);\n\n       // 转账\n       // 1. 加载转账所需的凭证，用私钥\n       Credentials credentials = Credentials.create(privateKey);\n       // 2. 获取nonce，交易笔数\n       BigInteger nonce = web3.ethGetTransactionCount(address, DefaultBlockParameterName.LATEST).send().getTransactionCount();\n\n       // 3. 手续费\n       EthGasPrice ethGasPrice = web3.ethGasPrice().sendAsync().get();\n       BigInteger gasPrice = ethGasPrice.getGasPrice();\n       BigInteger gasLimit = BigInteger.valueOf(60000L);\n\n       // 转账金额\n       BigInteger value = Convert.toWei("0.1", Convert.Unit.ETHER).toBigInteger();\n\n       // 4. 创建RawTransaction交易对象\n       RawTransaction rawTransaction = RawTransaction.createEtherTransaction(nonce, gasPrice, gasLimit, toaddress, value);\n       //签名Transaction，这里要对交易做签名\n       byte[] signMessage = TransactionEncoder.signMessage(rawTransaction, chainId.longValue(), credentials);\n       String hexValue = Numeric.toHexString(signMessage);\n       //发送交易\n       EthSendTransaction ethSendTransaction = web3.ethSendRawTransaction(hexValue).sendAsync().get();\n       System.out.println("转账交易的hash值" + ethSendTransaction.getTransactionHash());\n\n       // 确认交易上链\n       for (int i = 0; i < 10; i++) {\n           EthGetTransactionReceipt receipt = web3.ethGetTransactionReceipt(ethSendTransaction.getTransactionHash()).sendAsync().get();\n           if (receipt.getTransactionReceipt().isPresent()) {\n               // 查询转账后from地址下余额\n               balance = web3.ethGetBalance(address, DefaultBlockParameterName.LATEST).send().getBalance();\n               balanceStr = Convert.fromWei(balance.toString(), Convert.Unit.ETHER).toString();\n               System.out.println("Balance after transfer:" + balanceStr + "\\r\\n");\n\n               // 查询转账后to地址下余额\n               balance = web3.ethGetBalance(toaddress, DefaultBlockParameterName.LATEST).send().getBalance();\n               balanceStr = Convert.fromWei(balance.toString(), Convert.Unit.ETHER).toString();\n               System.out.println("Balance after transfer:" + balanceStr + "\\r\\n");\n               break;\n           }\n           Thread.sleep(5000);\n       }\n\n   }\n}\n\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br"),a("span",{staticClass:"line-number"},[n._v("59")]),a("br"),a("span",{staticClass:"line-number"},[n._v("60")]),a("br"),a("span",{staticClass:"line-number"},[n._v("61")]),a("br"),a("span",{staticClass:"line-number"},[n._v("62")]),a("br"),a("span",{staticClass:"line-number"},[n._v("63")]),a("br"),a("span",{staticClass:"line-number"},[n._v("64")]),a("br"),a("span",{staticClass:"line-number"},[n._v("65")]),a("br"),a("span",{staticClass:"line-number"},[n._v("66")]),a("br"),a("span",{staticClass:"line-number"},[n._v("67")]),a("br"),a("span",{staticClass:"line-number"},[n._v("68")]),a("br"),a("span",{staticClass:"line-number"},[n._v("69")]),a("br"),a("span",{staticClass:"line-number"},[n._v("70")]),a("br"),a("span",{staticClass:"line-number"},[n._v("71")]),a("br"),a("span",{staticClass:"line-number"},[n._v("72")]),a("br"),a("span",{staticClass:"line-number"},[n._v("73")]),a("br"),a("span",{staticClass:"line-number"},[n._v("74")]),a("br"),a("span",{staticClass:"line-number"},[n._v("75")]),a("br"),a("span",{staticClass:"line-number"},[n._v("76")]),a("br"),a("span",{staticClass:"line-number"},[n._v("77")]),a("br"),a("span",{staticClass:"line-number"},[n._v("78")]),a("br"),a("span",{staticClass:"line-number"},[n._v("79")]),a("br"),a("span",{staticClass:"line-number"},[n._v("80")]),a("br"),a("span",{staticClass:"line-number"},[n._v("81")]),a("br"),a("span",{staticClass:"line-number"},[n._v("82")]),a("br"),a("span",{staticClass:"line-number"},[n._v("83")]),a("br"),a("span",{staticClass:"line-number"},[n._v("84")]),a("br"),a("span",{staticClass:"line-number"},[n._v("85")]),a("br"),a("span",{staticClass:"line-number"},[n._v("86")]),a("br"),a("span",{staticClass:"line-number"},[n._v("87")]),a("br"),a("span",{staticClass:"line-number"},[n._v("88")]),a("br"),a("span",{staticClass:"line-number"},[n._v("89")]),a("br"),a("span",{staticClass:"line-number"},[n._v("90")]),a("br"),a("span",{staticClass:"line-number"},[n._v("91")]),a("br"),a("span",{staticClass:"line-number"},[n._v("92")]),a("br"),a("span",{staticClass:"line-number"},[n._v("93")]),a("br"),a("span",{staticClass:"line-number"},[n._v("94")]),a("br"),a("span",{staticClass:"line-number"},[n._v("95")]),a("br"),a("span",{staticClass:"line-number"},[n._v("96")]),a("br"),a("span",{staticClass:"line-number"},[n._v("97")]),a("br"),a("span",{staticClass:"line-number"},[n._v("98")]),a("br"),a("span",{staticClass:"line-number"},[n._v("99")]),a("br"),a("span",{staticClass:"line-number"},[n._v("100")]),a("br"),a("span",{staticClass:"line-number"},[n._v("101")]),a("br"),a("span",{staticClass:"line-number"},[n._v("102")]),a("br"),a("span",{staticClass:"line-number"},[n._v("103")]),a("br"),a("span",{staticClass:"line-number"},[n._v("104")]),a("br"),a("span",{staticClass:"line-number"},[n._v("105")]),a("br"),a("span",{staticClass:"line-number"},[n._v("106")]),a("br"),a("span",{staticClass:"line-number"},[n._v("107")]),a("br"),a("span",{staticClass:"line-number"},[n._v("108")]),a("br"),a("span",{staticClass:"line-number"},[n._v("109")]),a("br"),a("span",{staticClass:"line-number"},[n._v("110")]),a("br"),a("span",{staticClass:"line-number"},[n._v("111")]),a("br"),a("span",{staticClass:"line-number"},[n._v("112")]),a("br"),a("span",{staticClass:"line-number"},[n._v("113")]),a("br"),a("span",{staticClass:"line-number"},[n._v("114")]),a("br"),a("span",{staticClass:"line-number"},[n._v("115")]),a("br"),a("span",{staticClass:"line-number"},[n._v("116")]),a("br"),a("span",{staticClass:"line-number"},[n._v("117")]),a("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);