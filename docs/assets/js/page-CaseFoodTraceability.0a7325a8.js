(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{557:function(a,t,e){"use strict";e.r(t);var s=e(1),n=Object(s.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"case-food-traceability"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#case-food-traceability"}},[a._v("#")]),a._v(" Case Food Traceability")]),a._v(" "),e("blockquote",[e("p",[a._v("We will explain how to design, implement, deploy, and invoke smart contracts on the Bityuan parachain with a food traceability smart contract based on Solidity language.")])]),a._v(" "),e("h2",{attrs:{id:"parallel-chain-environment-deployment"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#parallel-chain-environment-deployment"}},[a._v("#")]),a._v(" Parallel Chain Environment Deployment")]),a._v(" "),e("p",[a._v("Build parachain, see "),e("a",{attrs:{href:"https://docs.bityuan.com/guide/1.Quick%20Start/2.%20Build%20parachain/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Build parachain"),e("OutboundLink")],1)]),a._v(" "),e("p",[e("strong",[a._v("Create wallet")])]),a._v(" "),e("p",[a._v("You don't need to do this step if you have already created a wallet.")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('//Generate random number seed. We suggest that users should generate the seed in person and keep it manually since it can be used to recover wallet.\n./chain33-cli --rpc_laddr="http://localhost:8901"  seed generate -l 0\n//Save seeds, and create password for wallet.\n//The password can be customerized. (More than 8 digits, combination of letters and numbers, such as fzm12345) Remember your password, which is used to unlock your wallet.  \n./chain33-cli --rpc_laddr="http://localhost:8901"  seed save -p fzm12345 -s "The seed generated in the previous step"\n//Unlock wallet. -p is password for wallet, -t is time for automatic wallet lock, -o means never lock unless restart.\n./chain33-cli --rpc_laddr="http://localhost:8901"  wallet unlock -p fzm12345 -t 0\n# (Optional) Check the wallet status.\n./chain33-cli --rpc_laddr="http://localhost:8901"  wallet status\n//Create an account address and private key \n./chain33-cli --rpc_laddr="http://localhost:8901"  account create -l testEvm\n//Query the address and private key of the above created account. \n./chain33-cli --rpc_laddr="http://localhost:8901"  account dump_key -a "The address generated in the previous step"\n//View account  \n./chain33-cli --rpc_laddr="http://localhost:8901" account list   \n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br")])]),e("p",[e("font",{attrs:{color:"red"}},[a._v("caution: ")]),a._v('--parameter[rpc_laddr] means the rpc address of the chain that users remote call. (it can be modified based on the real monitoring jrpc address of users, marked as "jrpcBindAddr" in configuration file.)')],1),a._v(" "),e("p",[e("strong",[a._v("View the status of block synchronization on parachain")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('./chain33-cli --rpc_laddr="http://localhost:8901"  block last_header\n{\n    "version": 0,\n    "parentHash": "0x905d3c3ab62718381436720382e436a52976b6798896c77c97cb4e751e3a67c9",\n    "txHash": "0x765a8babc9b63f7a5c608afb0943001741f3591f676026cd67dd99f6b3ad5122",\n    "stateHash": "0xeb240fe1248028e9c7271ae2838ea3970bb880031764c8154c8bce2d16262cb7",\n    "height": 57,\n    "blockTime": 1546501778,\n    "txCount": 1,\n    "hash": "0xac2be112305b231b9851a34f6db7bde1745a2b7c9c3a684c736dc59baf3e6e51",\n    "difficulty": 0\n}\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br")])]),e("h2",{attrs:{id:"contract-design"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#contract-design"}},[a._v("#")]),a._v(" Contract Design")]),a._v(" "),e("p",[a._v("To realize a food traceability process is to achieve the origin, production, circulation and other links of traceability.")]),a._v(" "),e("p",[a._v("The actual traceability is a very complicated process, which is reduced to the following steps: farm, food factory, supermarket, food quality inspection department, and user.")]),a._v(" "),e("p",[a._v("Properties of the product, take live pigs as an example:")]),a._v(" "),e("ol",[e("li",[a._v("Add Pork Information")]),a._v(" "),e("li",[a._v("Add Quality Control Information")]),a._v(" "),e("li",[a._v("Add Supermarket Shelf Information")]),a._v(" "),e("li",[a._v("User Rating Update")])]),a._v(" "),e("p",[a._v("See contract codes: "),e("a",{attrs:{href:"https://bty33.oss-cn-shanghai.aliyuncs.com/chain33Dev/solidity/Food.zip",target:"_blank",rel:"noopener noreferrer"}},[a._v("Smart Contract Code Download"),e("OutboundLink")],1)]),a._v(" "),e("h2",{attrs:{id:"contract-compilation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#contract-compilation"}},[a._v("#")]),a._v(" Contract Compilation")]),a._v(" "),e("p",[a._v("Get the "),e("code",[a._v("bytecode")]),a._v(" and "),e("code",[a._v("abi")]),a._v(" of the contract:")]),a._v(" "),e("ul",[e("li",[a._v("bytecode: 60806040526000805560006001556000....Omit the latter part and copy from the IDE...")]),a._v(" "),e("li",[a._v('abi: [{"inputs":[{"internalType":"address","name":"_creator","type":"address"}....Omit the latter part and copy from the IDE.....')])]),a._v(" "),e("h2",{attrs:{id:"contract-deployment-and-invocation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#contract-deployment-and-invocation"}},[a._v("#")]),a._v(" Contract deployment and invocation")]),a._v(" "),e("p",[a._v("Contract deployment and invocation, see "),e("a",{attrs:{href:"https://docs.bityuan.com/guide/1.Quick%20Start/7.%20Deploy%20smart%20contract/#",target:"_blank",rel:"noopener noreferrer"}},[a._v("Deploy smart contract"),e("OutboundLink")],1),a._v(".")]),a._v(" "),e("h3",{attrs:{id:"contract-deployment"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#contract-deployment"}},[a._v("#")]),a._v(" Contract Deployment")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('//Constructing contracts to deploy transactions. --user.p.mbaas. is the title of the parachain, this parameter must be filled in correctly, otherwise the transaction cannot be received.\n./chain33-cli --rpc_laddr="http://localhost:8901" --paraName="user.p.mbaas." evm create -s foodTest -f 1000000 -c "btyecode value" \n//Signature Transactions -k：Contract deployer\'s private key.\n./chain33-cli --rpc_laddr="http://localhost:8901" wallet sign -k 0xdb9415dfbd54ed84dccde80a0f9f2497c7b967116da92d8682900b324ea33d68 -d "data from last step"\n//Transaction sending\n./chain33-cli --rpc_laddr="http://localhost:8901" wallet send -d "data after signature from last step"\n//查询交易（在结果中 "receipt": {"ty": 2,"tyName": "ExecOk".....} 代表交易执行成功，如果ty=1,代表交易只是被打包但执行失败）\n./chain33-cli --rpc_laddr="http://localhost:8901" tx query_hash -s 上一步返回的hash\n//如果上述交易执行返回ExecOk,代表合约部署成功，计算此合约的地址, --user.p.mbaas. 是平行链的title，此参数一定要填对 -a 合约部署人的地址 -s 上一步返回的hash(去掉前面0x的值)，假设此处返回的是：174dwVy4fEY7WQkpuRZRci88BE5iuHHSY4\n./chain33-cli --rpc_laddr="http://localhost:8901" --paraName="user.p.mbaas." evm calc -a 1LQJbjsNxh6ve6RCXBuDnUuMQsqXsc4cWK -s 上一步返回的hash去掉最前面的0x\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br")])]),e("h3",{attrs:{id:"information-input"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#information-input"}},[a._v("#")]),a._v(" Information Input")]),a._v(" "),e("h4",{attrs:{id:"add-pork-information"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#add-pork-information"}},[a._v("#")]),a._v(" Add Pork Information")]),a._v(" "),e("p",[a._v("Cattle ranches selling")]),a._v(" "),e("table",[e("thead",[e("tr",[e("th",[a._v("Batch Number")]),a._v(" "),e("th",[a._v("Name")]),a._v(" "),e("th",[a._v("Weight")]),a._v(" "),e("th",[a._v("Date")]),a._v(" "),e("th",[a._v("Origin")])])]),a._v(" "),e("tbody",[e("tr",[e("td",[a._v("00001")]),a._v(" "),e("td",[a._v("pig001")]),a._v(" "),e("td",[a._v("500")]),a._v(" "),e("td",[a._v("20190221")]),a._v(" "),e("td",[a._v("NanJing")])])])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('//使用addPigInfo进行猪肉信息的录入  \n//重要： 先在本地生成一个174dwVy4fEY7WQkpuRZRci88BE5iuHHSY4.abi文件，复制IDE中生成的abi内容到此文件中  \n//其中174dwVy4fEY7WQkpuRZRci88BE5iuHHSY4替换成自己的合约地址    \n./chain33-cli --rpc_laddr="http://localhost:8901" --paraName="user.p.mbaas." evm call -e 174dwVy4fEY7WQkpuRZRci88BE5iuHHSY4 -p "addPigInfo("1CbEVT9RnM5oZhWMj4fxUrJX94VtRotzvs","pig001","00001","500","20190210","NanJing")"    \n//-k是调用合约人的私钥  \n./chain33-cli --rpc_laddr="http://localhost:8901" wallet sign -k 0xdb9415dfbd54ed84dccde80a0f9f2497c7b967116da92d8682900b324ea33d68 -d 上一步返回的结果  \n./chain33-cli --rpc_laddr="http://localhost:8901" wallet send -d 上一步返回的结果    \n//通过hash查看猪肉信息是否成功添加，如果返回"receipt": {"ty": 2,"tyName": "ExecOk".....} 代表交易执行成功，如果ty=1,代表交易只是被打包但执行失败）  \n./chain33-cli --rpc_laddr="http://localhost:8901" tx query -s "上一步返回的hash"  \n使用getPigNumber()函数查看录入了多少条生猪信息  \n其中-a 174dwVy4fEY7WQkpuRZRci88BE5iuHHSY4替换成合约地址，-c为调用人地址，-b为合约中查询方法  \n./chain33-cli --rpc_laddr="http://localhost:8801" --paraName="user.p.mbaas." evm query -a  174dwVy4fEY7WQkpuRZRci88BE5iuHHSY4 -c 1LQJbjsNxh6ve6RCXBuDnUuMQsqXsc4cWK -b "getPigNumber()"  \n通过getPigInfoByIndex函数，查询index对应的生猪详细信息  \n./chain33-cli --rpc_laddr="http://localhost:8801" --paraName="user.p.mbaas." evm query -a  174dwVy4fEY7WQkpuRZRci88BE5iuHHSY4 -c 1LQJbjsNxh6ve6RCXBuDnUuMQsqXsc4cWK -b "getPigInfoByIndex(0)"  \n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br")])]),e("h4",{attrs:{id:"add-food-information"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#add-food-information"}},[a._v("#")]),a._v(" Add Food Information")]),a._v(" "),e("p",[a._v("Food factory production (for example, ham)")]),a._v(" "),e("table",[e("thead",[e("tr",[e("th",[a._v("Food number(such as QR code)")]),a._v(" "),e("th",[a._v("Name")]),a._v(" "),e("th",[a._v("Weight")]),a._v(" "),e("th",[a._v("Production Date")]),a._v(" "),e("th",[a._v("Packing Date")]),a._v(" "),e("th",[a._v("Expiration Date")]),a._v(" "),e("th",[a._v("Pork Batch")])])]),a._v(" "),e("tbody",[e("tr",[e("td",[a._v("001")]),a._v(" "),e("td",[a._v("food001")]),a._v(" "),e("td",[a._v("500")]),a._v(" "),e("td",[a._v("20190215")]),a._v(" "),e("td",[a._v("20190220")]),a._v(" "),e("td",[a._v("20210215")]),a._v(" "),e("td",[a._v("00001")])])])]),a._v(" "),e("p",[a._v("上链和查询脚本和3.2.1中类似(具体方法名称和参数，请见Food.sol中定义)。")]),a._v(" "),e("h4",{attrs:{id:"add-quality-control-information"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#add-quality-control-information"}},[a._v("#")]),a._v(" Add Quality Control Information")]),a._v(" "),e("p",[a._v("Food quality inspection department sampling")]),a._v(" "),e("table",[e("thead",[e("tr",[e("th",[a._v("Food number(such as QR code)")]),a._v(" "),e("th",[a._v("Test Time")]),a._v(" "),e("th",[a._v("Test Results")]),a._v(" "),e("th",[a._v("Test Instructions")])])]),a._v(" "),e("tbody",[e("tr",[e("td",[a._v("food001")]),a._v(" "),e("td",[a._v("20190226")]),a._v(" "),e("td",[a._v("Qualified")]),a._v(" "),e("td",[a._v("The food is good.")])])])]),a._v(" "),e("p",[a._v("上链和查询脚本和3.2.1中类似(具体方法名称和参数，请见Food.sol中定义)。")]),a._v(" "),e("h4",{attrs:{id:"add-supermarket-shelf-information"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#add-supermarket-shelf-information"}},[a._v("#")]),a._v(" Add Supermarket Shelf Information")]),a._v(" "),e("table",[e("thead",[e("tr",[e("th",[a._v("Food number(such as QR code)")]),a._v(" "),e("th",[a._v("Last Date")])])]),a._v(" "),e("tbody",[e("tr",[e("td",[a._v("food001")]),a._v(" "),e("td",[a._v("20190304")])])])]),a._v(" "),e("p",[a._v("上链和查询脚本和3.2.1中类似(具体方法名称和参数，请见Food.sol中定义)。")]),a._v(" "),e("h4",{attrs:{id:"user-rating-update"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#user-rating-update"}},[a._v("#")]),a._v(" User Rating Update")]),a._v(" "),e("table",[e("thead",[e("tr",[e("th",[a._v("Food number")]),a._v(" "),e("th",[a._v("User Rating")])])]),a._v(" "),e("tbody",[e("tr",[e("td",[a._v("food001")]),a._v(" "),e("td",[a._v("90")])])])]),a._v(" "),e("p",[a._v("上链和查询脚本和3.2.1中类似(具体方法名称和参数，请见Food.sol中定义)。")])])}),[],!1,null,null,null);t.default=n.exports}}]);