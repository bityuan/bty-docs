<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Queue Module | BitYuan</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="A demo for vuepress-theme-hope">
    <meta property="og:url" content="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module.html">
    <meta property="og:site_name" content="BitYuan">
    <meta property="og:title" content="Queue Module">
    <meta property="og:description" content="Queue Module Module Introduction As the name implies, Queue Module implements the message queue function. The main purpose is to reduce the coupling of the individual modules in Ch">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta property="og:locale:alternate" content="zh-CN">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="BitYuan">
    
    <link rel="preload" href="/assets/css/0.styles.b9744494.css" as="style"><link rel="preload" href="/assets/js/app.e4f15799.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.1136eb17.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.273fc434.js" as="script"><link rel="preload" href="/assets/js/page-QueueModule.eae700a7.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.4a182f2f.js" as="script"><link rel="prefetch" href="/assets/js/151.65f190ce.js"><link rel="prefetch" href="/assets/js/152.006f379e.js"><link rel="prefetch" href="/assets/js/153.553b1bfd.js"><link rel="prefetch" href="/assets/js/154.14d5e117.js"><link rel="prefetch" href="/assets/js/155.0f1cee54.js"><link rel="prefetch" href="/assets/js/layout-Blog.06a4aba6.js"><link rel="prefetch" href="/assets/js/layout-Layout.85d11602.js"><link rel="prefetch" href="/assets/js/layout-NotFound.08f6c85c.js"><link rel="prefetch" href="/assets/js/layout-Slide.ac4b19ea.js"><link rel="prefetch" href="/assets/js/page-AccountModel.af5b1417.js"><link rel="prefetch" href="/assets/js/page-BalanceInquiry.5985ec70.js"><link rel="prefetch" href="/assets/js/page-BitYuanIntroduction.9ec83ebf.js"><link rel="prefetch" href="/assets/js/page-BitYuanMainNetworkEnvironmentConfiguration.e58c3eae.js"><link rel="prefetch" href="/assets/js/page-BitYuanWalletGuidelines.abac8108.js"><link rel="prefetch" href="/assets/js/page-BlockchainInterface.62705ec0.js"><link rel="prefetch" href="/assets/js/page-BlockchainModule.a468f8d3.js"><link rel="prefetch" href="/assets/js/page-BlockchainÊ®°Âùó.b5ecc0cd.js"><link rel="prefetch" href="/assets/js/page-Buildparachain.f0f19084.js"><link rel="prefetch" href="/assets/js/page-CAÂ∑•ÂÖ∑‰ΩøÁî®ËØ¥Êòé.0f367ed4.js"><link rel="prefetch" href="/assets/js/page-CAÊúçÂä°‰ΩøÁî®ËØ¥Êòé.c6be122a.js"><link rel="prefetch" href="/assets/js/page-CaseFoodTraceability.a5607808.js"><link rel="prefetch" href="/assets/js/page-Chain33Á≥ªÁªüÊé•Âè£.d69fa997.js"><link rel="prefetch" href="/assets/js/page-CompatiblewithEthereumEVM.db7fcc50.js"><link rel="prefetch" href="/assets/js/page-ConsensusModule.7394777b.js"><link rel="prefetch" href="/assets/js/page-CreateBitYuanparentBlockchain.ef5730f3.js"><link rel="prefetch" href="/assets/js/page-DAPPdevelopmentinGolanguage.b36d5f00.js"><link rel="prefetch" href="/assets/js/page-DAPPdevelopmentinJavaScriptlanguage.ffd710ac.js"><link rel="prefetch" href="/assets/js/page-DAPPdevelopmentinSoliditylanguage.547657a0.js"><link rel="prefetch" href="/assets/js/page-DAPPÂºÄÂèë‰ªãÁªç.6b3f7bed.js"><link rel="prefetch" href="/assets/js/page-DecentralizedApplication.1e8cb601.js"><link rel="prefetch" href="/assets/js/page-Deployblockchainbrowser.5e7b37cb.js"><link rel="prefetch" href="/assets/js/page-Deploysmartcontract.aaaf5fe7.js"><link rel="prefetch" href="/assets/js/page-Deploywallet.ad8a5795.js"><link rel="prefetch" href="/assets/js/page-Dockingwithexternalapplication.3738c792.js"><link rel="prefetch" href="/assets/js/page-EVMInterface.e90069d1.js"><link rel="prefetch" href="/assets/js/page-EVMÊé•Âè£.f59ce1ed.js"><link rel="prefetch" href="/assets/js/page-EventInterface.41ec34b3.js"><link rel="prefetch" href="/assets/js/page-ExecutorInterface.b0c48216.js"><link rel="prefetch" href="/assets/js/page-ExecutorModule.548d8eca.js"><link rel="prefetch" href="/assets/js/page-GRPCÊé•Âè£Á∫¶ÂÆö.acef3990.js"><link rel="prefetch" href="/assets/js/page-GoËØ≠Ë®ÄÂºÄÂèëDAPP.542ff720.js"><link rel="prefetch" href="/assets/js/page-InterfaceContract.3a9f6917.js"><link rel="prefetch" href="/assets/js/page-IntroductiontoDAppDevelopment.4beb37c2.js"><link rel="prefetch" href="/assets/js/page-JavaScriptËØ≠Ë®ÄÂºÄÂèëDAPP.4300ea9e.js"><link rel="prefetch" href="/assets/js/page-Manage.33110256.js"><link rel="prefetch" href="/assets/js/page-ManageInterface.d4a62d6c.js"><link rel="prefetch" href="/assets/js/page-MempoolInterface.d334455e.js"><link rel="prefetch" href="/assets/js/page-MempoolModule.4afd2879.js"><link rel="prefetch" href="/assets/js/page-MempoolÊé•Âè£.c6b49876.js"><link rel="prefetch" href="/assets/js/page-MempoolÊ®°Âùó.7a531d4a.js"><link rel="prefetch" href="/assets/js/page-MiningInterface.39f51a1c.js"><link rel="prefetch" href="/assets/js/page-NetworkType.d6300201.js"><link rel="prefetch" href="/assets/js/page-P2PModule.807a3c50.js"><link rel="prefetch" href="/assets/js/page-P2PÊ®°Âùó.482c4cce.js"><link rel="prefetch" href="/assets/js/page-ParachainTokenIssuance.49786bd6.js"><link rel="prefetch" href="/assets/js/page-Project.d72fdc2e.js"><link rel="prefetch" href="/assets/js/page-QueueÊ®°Âùó.59fcecd5.js"><link rel="prefetch" href="/assets/js/page-RPCModule.49d4674c.js"><link rel="prefetch" href="/assets/js/page-RPCÊé•Âè£ÁºñÁ®ãÊ†∑‰æã.f3dd5ed7.js"><link rel="prefetch" href="/assets/js/page-RPCÊ®°Âùó.3835f6cc.js"><link rel="prefetch" href="/assets/js/page-SPOSConsensus.43283a9e.js"><link rel="prefetch" href="/assets/js/page-SPOSÂÖ±ËØÜ.ad6477b3.js"><link rel="prefetch" href="/assets/js/page-SmartContract.54e4f699.js"><link rel="prefetch" href="/assets/js/page-SolidityËØ≠Ë®ÄÂºÄÂèëDAPP.0d266312.js"><link rel="prefetch" href="/assets/js/page-StorageModule.8558660d.js"><link rel="prefetch" href="/assets/js/page-StorageSharding.290c613c.js"><link rel="prefetch" href="/assets/js/page-SystemInterface.56b61b1c.js"><link rel="prefetch" href="/assets/js/page-SystemModule.0507d733.js"><link rel="prefetch" href="/assets/js/page-TechnicalArchitecture.2a7d9a3b.js"><link rel="prefetch" href="/assets/js/page-Terminology.80ba3d55.js"><link rel="prefetch" href="/assets/js/page-TokenInterface.457180cc.js"><link rel="prefetch" href="/assets/js/page-TokenÊé•Âè£.f99f29fd.js"><link rel="prefetch" href="/assets/js/page-Trade.3d43bfe8.js"><link rel="prefetch" href="/assets/js/page-TradeÊé•Âè£.c357c2e8.js"><link rel="prefetch" href="/assets/js/page-TransactionInterface.f7a0c0d8.js"><link rel="prefetch" href="/assets/js/page-Unfreeze.fa263601.js"><link rel="prefetch" href="/assets/js/page-UnfreezeInterface.e125fde3.js"><link rel="prefetch" href="/assets/js/page-WalletInterface.85310d41.js"><link rel="prefetch" href="/assets/js/page-WalletModule.348ce0ed.js"><link rel="prefetch" href="/assets/js/page-WalletRecoveryContract.c75a69bf.js"><link rel="prefetch" href="/assets/js/page-WalletÊé•Âè£.4242e9e5.js"><link rel="prefetch" href="/assets/js/page-Zero-KnowledgeProof.b050ffe6.js"><link rel="prefetch" href="/assets/js/page-autonomyÊé•Âè£.56592aeb.js"><link rel="prefetch" href="/assets/js/page-ethersjs‰∫ã‰ª∂ÁõëÂê¨.c7cbc2bd.js"><link rel="prefetch" href="/assets/js/page-ethersjsÂêàÁ∫¶ÈÉ®ÁΩ≤ÂíåËØªÂÜô.25f9299b.js"><link rel="prefetch" href="/assets/js/page-ethersjsÁéØÂ¢ÉÊê≠Âª∫ÂíåÂü∫Êú¨Êìç‰Ωú.d81a86af.js"><link rel="prefetch" href="/assets/js/page-go-sdkÂü∫Êú¨ÂºÄÂèëÁéØÂ¢ÉÊê≠Âª∫ÂèäÂ∏∏Áî®ÊñπÊ≥ï.4013e57f.js"><link rel="prefetch" href="/assets/js/page-web3jsÂêàÁ∫¶‰∫ã‰ª∂.0ce49b3a.js"><link rel="prefetch" href="/assets/js/page-web3jsÂêàÁ∫¶ËØªÂÜô.c4090bb9.js"><link rel="prefetch" href="/assets/js/page-web3jsÂêàÁ∫¶ÈÉ®ÁΩ≤.a44b57a3.js"><link rel="prefetch" href="/assets/js/page-web3jsÂü∫Êú¨ÂºÄÂèëÁéØÂ¢ÉÊê≠Âª∫ÂèäÂ∏∏Áî®Êü•ËØ¢ÂáΩÊï∞.72d45203.js"><link rel="prefetch" href="/assets/js/page-web3jsË¥¶Êà∑Êìç‰ΩúÂíåÂèëÈÄÅ‰∫§Êòì.efcb52fc.js"><link rel="prefetch" href="/assets/js/page-web3j‰∫ã‰ª∂ÁõëÂê¨.01187b3f.js"><link rel="prefetch" href="/assets/js/page-web3jÂêàÁ∫¶ÈÉ®ÁΩ≤ÂíåËØªÂÜô.a82ba052.js"><link rel="prefetch" href="/assets/js/page-web3jÂü∫Êú¨ÂºÄÂèëÁéØÂ¢ÉÊê≠Âª∫ÂèäÂ∏∏Áî®Êü•ËØ¢ÂáΩÊï∞.fd59a505.js"><link rel="prefetch" href="/assets/js/page-‰∫ã‰ª∂Êé•Âè£.7a1ed019.js"><link rel="prefetch" href="/assets/js/page-‰∫§ÊòìÊé•Âè£.23077356.js"><link rel="prefetch" href="/assets/js/page-ÂÖ¨ÈìæÂèëÂ±ïË∂ãÂäø.3dbf7770.js"><link rel="prefetch" href="/assets/js/page-ÂÖ±ËØÜÊ®°Âùó.b2fd5530.js"><link rel="prefetch" href="/assets/js/page-ÂÖºÂÆπ‰ª•Â§™ÂùäEVM.f043783d.js"><link rel="prefetch" href="/assets/js/page-ÂàõÂª∫ÊØîÁâπÂÖÉ‰∏ªÈìæËäÇÁÇπ.78d61b84.js"><link rel="prefetch" href="/assets/js/page-Âå∫ÂùóÈìæÊé•Âè£.54028013.js"><link rel="prefetch" href="/assets/js/page-Âéª‰∏≠ÂøÉÂåñNFT‰∫§ÊòìÁ≥ªÁªü.de56acc7.js"><link rel="prefetch" href="/assets/js/page-Âéª‰∏≠ÂøÉÂåñÂüüÂêçÁ≥ªÁªü.6c5fa6d9.js"><link rel="prefetch" href="/assets/js/page-Âéª‰∏≠ÂøÉÂåñÂ∫îÁî®.1db9824f.js"><link rel="prefetch" href="/assets/js/page-ÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑‰ªãÁªç.4493cd5a.js"><link rel="prefetch" href="/assets/js/page-ÂõΩÂØÜÊîØÊåÅ.785d0dd8.js"><link rel="prefetch" href="/assets/js/page-Â§öÈáçÁ≠æÂêç.bc00b17e.js"><link rel="prefetch" href="/assets/js/page-Â≠òÂÇ®ÂàÜÁâá.111c404c.js"><link rel="prefetch" href="/assets/js/page-Â≠òÂÇ®Ê®°Âùó.10d7e33f.js"><link rel="prefetch" href="/assets/js/page-ÂØπÊé•Â§ñÈÉ®Â∫îÁî®.59143c31.js"><link rel="prefetch" href="/assets/js/page-Âπ≥Ë°åÈìæÂÖ±ËØÜËäÇÁÇπÊåñÁüøÂ•ñÂä±ËßÑÂàô.e3da1db9.js"><link rel="prefetch" href="/assets/js/page-Âπ≥Ë°åÈìæÂèëË°åToken.fc1b5c23.js"><link rel="prefetch" href="/assets/js/page-Âπ≥Ë°åÈìæÁéØÂ¢ÉÈÖçÁΩÆ.6f24911e.js"><link rel="prefetch" href="/assets/js/page-Âπ≥Ë°åÈìæËµÑ‰∫ßËΩ¨ÁßªÁÆ°ÁêÜ‰ªãÁªç.cb614d85.js"><link rel="prefetch" href="/assets/js/page-Âπ≥Ë°åÈìæË∂ÖÁ∫ßËäÇÁÇπÂàõÂª∫ÂíåË∂ÖÁ∫ßË¥¶Êà∑ÁÆ°ÁêÜ‰ªãÁªç.b791add2.js"><link rel="prefetch" href="/assets/js/page-ÊâßË°åÂô®Êé•Âè£.aedd1346.js"><link rel="prefetch" href="/assets/js/page-ÊâßË°åÂô®Ê®°Âùó.315927f7.js"><link rel="prefetch" href="/assets/js/page-ÊäÄÊúØÊû∂ÊûÑ.405492dc.js"><link rel="prefetch" href="/assets/js/page-ÊåñÁüøÊé•Âè£.9a9fc2ba.js"><link rel="prefetch" href="/assets/js/page-Êé•Âè£Á∫¶ÂÆö.0c13296e.js"><link rel="prefetch" href="/assets/js/page-Êê≠Âª∫Âπ≥Ë°åÈìæ.0307d790.js"><link rel="prefetch" href="/assets/js/page-ÊñáÊ°£‰∏ªÈ°µ.bb2bddd0.js"><link rel="prefetch" href="/assets/js/page-Êô∫ËÉΩÂêàÁ∫¶.8e4031c0.js"><link rel="prefetch" href="/assets/js/page-ÊúØËØ≠‰ªãÁªç.3876a47f.js"><link rel="prefetch" href="/assets/js/page-Êü•ËØ¢‰ΩôÈ¢ù.6a09c3cf.js"><link rel="prefetch" href="/assets/js/page-ÊØîÁâπÂÖÉ‰∏ªÁΩëÁéØÂ¢ÉÈÖçÁΩÆ.32349716.js"><link rel="prefetch" href="/assets/js/page-ÊØîÁâπÂÖÉ‰ªãÁªç.9111a682.js"><link rel="prefetch" href="/assets/js/page-ÊØîÁâπÂÖÉÈí±ÂåÖÊìç‰ΩúÊâãÂÜå.9690d877.js"><link rel="prefetch" href="/assets/js/page-Á§æÂå∫Ëá™Ê≤ªDAO.3b955638.js"><link rel="prefetch" href="/assets/js/page-Á≥ªÁªüÊ®°Âùó.98315202.js"><link rel="prefetch" href="/assets/js/page-Á≥ªÁªüË¶ÅÊ±Ç.61fb0499.js"><link rel="prefetch" href="/assets/js/page-ÁªèÊµéÊ®°Âûã-ÁáÉÊñôÊ∂àËÄó.81bafd65.js"><link rel="prefetch" href="/assets/js/page-ÁΩëÁªúÁ±ªÂûã.f6cd933c.js"><link rel="prefetch" href="/assets/js/page-Ë¥¶Êà∑Ê®°Âûã.52009fe0.js"><link rel="prefetch" href="/assets/js/page-ÈÄöËØÅÂèëË°å.34475c7d.js"><link rel="prefetch" href="/assets/js/page-ÈÄöËøáSDK‰∏éBTYÂÖ¨Èìæ‰∫§‰∫í.094da64f.js"><link rel="prefetch" href="/assets/js/page-ÈÉ®ÁΩ≤Âå∫ÂùóÈìæÊµèËßàÂô®.986dd005.js"><link rel="prefetch" href="/assets/js/page-ÈÉ®ÁΩ≤Êô∫ËÉΩÂêàÁ∫¶.20f9d2de.js"><link rel="prefetch" href="/assets/js/page-ÈÉ®ÁΩ≤Èí±ÂåÖ.4d87105b.js"><link rel="prefetch" href="/assets/js/page-Èí±ÂåÖÊâæÂõûÂêàÁ∫¶.17e898cb.js"><link rel="prefetch" href="/assets/js/page-Èí±ÂåÖÊ®°Âùó.ac8ff574.js"><link rel="prefetch" href="/assets/js/page-ÈîôËØØÁ†Å.d325f1b2.js"><link rel="prefetch" href="/assets/js/page-ÈöêÁßÅ‰øùÊä§.3b92b869.js"><link rel="prefetch" href="/assets/js/page-Èõ∂Áü•ËØÜËØÅÊòé.1932ee02.js"><link rel="prefetch" href="/assets/js/page-È£üÂìÅÊ∫ØÊ∫êÊ°à‰æã.cd11ead0.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.f0f9ccda.js"><link rel="prefetch" href="/assets/js/vendors~mermaid.39f7aac0.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.37b37225.js"><link rel="prefetch" href="/assets/js/vendors~reveal.09a4a79b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b9744494.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="BitYuan" class="logo"> <!----> <span class="site-name can-hide">BitYuan</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><!----> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="switch"><input id="switch" type="checkbox" checked="checked" class="switch-input"> <label for="switch" class="label"><span class="label-content"></span></label></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><!---->
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link router-link-active active"><!---->
  Guide
</a></div></nav> <div class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" style="width:1rem;height:1rem;vertical-align:middle;margin-left:1rem;"><path d="M639.981 344.075c14.805 44.45 34.542 79.023 69.084 113.596 29.603-29.634 49.34-69.146 64.145-113.596H639.981zM314.33 591.024h128.29l-64.145-172.865-64.145 172.865z" fill="currentColor"></path> <path d="M807.746 116.882H215.643c-54.274 0-98.681 44.45-98.681 98.78v592.677c0 54.329 44.407 98.78 98.68 98.78h592.104c54.273 0 98.681-44.451 98.681-98.78V215.66c0-54.329-39.475-98.78-98.68-98.78zM565.971 754.01c-9.866 9.878-19.738 9.878-29.603 9.878-4.94 0-14.805 0-19.738-4.939-4.939-4.939-9.872 0-9.872-4.939s-4.932-9.878-9.865-19.756c-4.94-9.878-4.94-14.817-9.872-24.695L467.29 655.23H294.592l-19.737 54.33c-9.866 19.755-14.805 34.572-19.738 44.45-4.939 9.878-14.804 9.878-29.603 9.878-9.871 0-19.737-4.939-29.609-9.878-9.865-9.878-14.798-14.817-14.798-24.695 0-4.939 0-9.878 4.933-19.756 4.939-9.878 4.939-14.817 9.865-24.695l108.553-276.583c4.939-9.878 4.939-19.756 9.872-29.633 4.932-9.878 9.865-19.756 14.798-24.695 4.939-4.94 9.872-14.817 19.737-19.756 9.872-4.94 19.738-4.94 29.61-4.94 9.865 0 19.73 0 29.603 4.94 9.865 4.939 14.804 9.878 19.737 19.756 4.933 4.939 9.866 14.817 14.798 24.695 4.94 9.877 9.872 19.755 14.805 34.572l108.553 271.644c9.865 19.756 14.804 34.573 14.804 44.451-4.939 4.94-9.872 14.817-14.804 24.695zm271.378-192.62c-54.273-19.756-93.748-44.451-128.29-74.085-34.536 34.573-78.943 59.268-133.223 74.085l-14.798-24.695c54.273-14.817 98.68-34.573 133.223-69.146-34.542-34.573-64.145-79.024-74.017-128.413h-49.34V319.38h133.228c-9.877-14.817-19.743-34.573-29.609-49.39l14.799-4.94c9.871 14.818 24.676 34.574 34.542 54.33h123.35v24.695h-49.34c-14.798 49.39-39.468 93.84-69.077 123.474 34.541 29.634 74.01 54.329 128.29 69.146l-19.738 24.695z" fill="currentColor"></path></svg> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/" aria-current="page" class="nav-link router-link-exact-active router-link-active active"><!---->
  English
</a></li><li class="dropdown-item"><a href="/zh/" class="nav-link"><!---->
  ÁÆÄ‰Ωì‰∏≠Êñá
</a></li></ul></div></div></div> <a rel="noopener noreferrer" href="https://github.com/bityuan/bty-docs" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><!---->
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link router-link-active active"><!---->
  Guide
</a></div> <a rel="noopener noreferrer" href="https://github.com/bityuan/bty-docs" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/" aria-current="page" class="sidebar-link">BitYuan Introduction</a></li><li><a href="/guide/00.0%20Knowledge%20proof/" class="sidebar-link">Zero-Knowledge Proof</a></li><li><a href="/guide/01.eth%20evm/" class="sidebar-link">Compatible with Ethereum EVM</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Technical features</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/guide/02.Store%20shards/" class="sidebar-link">Storage Sharding</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Quick Start</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable open"><!----> <span class="title">Advanced</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading clickable open"><!----> <span class="title">Function Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/05.Advanced/1.Function%20Modules/1.P2P%20Module/" class="sidebar-link">P2P Module</a></li><li><a href="/guide/05.Advanced/1.Function%20Modules/2.Storage%20Module/" class="sidebar-link">Storage Module</a></li><li><a href="/guide/05.Advanced/1.Function%20Modules/3.Blockchain%20Module/" class="sidebar-link">Blockchain Module</a></li><li><a href="/guide/05.Advanced/1.Function%20Modules/4.Mempool%20Module/" class="sidebar-link">Mempool Module</a></li><li><a href="/guide/05.Advanced/1.Function%20Modules/5.Consensus%20Module/" class="sidebar-link">Consensus Module</a></li><li><a href="/guide/05.Advanced/1.Function%20Modules/6.Wallet%20Module/" class="sidebar-link">Wallet Module</a></li><li><a href="/guide/05.Advanced/1.Function%20Modules/7.Executor%20Module/" class="sidebar-link">Executor Module</a></li><li><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/" aria-current="page" class="active sidebar-link">Queue Module</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#module-introduction" class="sidebar-link">Module Introduction</a></li><li class="sidebar-sub-header"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#queue-module-interaction" class="sidebar-link">Queue module interaction</a></li><li class="sidebar-sub-header"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#data-structure-of-queue-and-client" class="sidebar-link">data structure of Queue and Client</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#data-structure-and-interface-of-queue" class="sidebar-link heading3">data structure and Interface of Queue</a></li><li class="sidebar-sub-header"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#chansub-channel-subscribing-and-message" class="sidebar-link heading3">ChanSub Channel Subscribing and Message</a></li><li class="sidebar-sub-header"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#client-data-structure-and-interface" class="sidebar-link heading3">Client Data Structure and Interface</a></li><li class="sidebar-sub-header"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#module-interface" class="sidebar-link heading3">Module Interface</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#use-of-queue-in-chain33" class="sidebar-link">Use of Queue in Chain33</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#initialize-queue-assign-values-start" class="sidebar-link heading3">Initialize Queue, Assign Values, Start</a></li><li class="sidebar-sub-header"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#implement-module-interface-for-specific-business-processing" class="sidebar-link heading3">Implement Module Interface for Specific Business Processing</a></li><li class="sidebar-sub-header"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#queueprotocol-make-secondary-packaging-to-client-to-satisfy-the-external-call" class="sidebar-link heading3">QueueProtocol Make Secondary Packaging to Client to Satisfy the External Call</a></li></ul></li></ul></li><li><a href="/guide/05.Advanced/1.Function%20Modules/9.RPC%20Module/" class="sidebar-link">RPC Module</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading clickable"><!----> <span class="title">System Usage</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">DAPP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Blockchain Browser</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Wallet</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">API Reference</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Case Introduction</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">Queue Module</span></h1> <div class="page-info"><!----> <!----><span aria-label="Writing DateüìÖ" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2023-5-26</span></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#module-introduction" class="anchor-link heading2"><div>Module Introduction</div></a></li><li class="anchor"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#queue-module-interaction" class="anchor-link heading2"><div>Queue module interaction</div></a></li><li class="anchor"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#data-structure-of-queue-and-client" class="anchor-link heading2"><div>data structure of Queue and Client</div></a></li><li class="anchor"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#data-structure-and-interface-of-queue" class="anchor-link heading3"><div>data structure and Interface of Queue</div></a></li><li class="anchor"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#chansub-channel-subscribing-and-message" class="anchor-link heading3"><div>ChanSub Channel Subscribing and Message</div></a></li><li class="anchor"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#client-data-structure-and-interface" class="anchor-link heading3"><div>Client Data Structure and Interface</div></a></li><li class="anchor"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#module-interface" class="anchor-link heading3"><div>Module Interface</div></a></li><li class="anchor"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#use-of-queue-in-chain33" class="anchor-link heading2"><div>Use of Queue in Chain33</div></a></li><li class="anchor"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#initialize-queue-assign-values-start" class="anchor-link heading3"><div>Initialize Queue, Assign Values, Start</div></a></li><li class="anchor"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#implement-module-interface-for-specific-business-processing" class="anchor-link heading3"><div>Implement Module Interface for Specific Business Processing</div></a></li><li class="anchor"><a href="/guide/05.Advanced/1.Function%20Modules/8.Queue%20Module/#queueprotocol-make-secondary-packaging-to-client-to-satisfy-the-external-call" class="anchor-link heading3"><div>QueueProtocol Make Secondary Packaging to Client to Satisfy the External Call</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="queue-module"><a href="#queue-module" class="header-anchor">#</a> Queue Module</h1> <h2 id="module-introduction"><a href="#module-introduction" class="header-anchor">#</a> Module Introduction</h2> <p>As the name implies, Queue Module implements the message queue function.</p> <p>The main purpose is to reduce the coupling of the individual modules in Chain33. Queue Module was introduced so that each Module is relatively independent and the communication between modules is not through interface calls but messages.This is also convenient for us to break up Chain33 by module in the future, paving the way for micro-service of the later modules.</p> <h2 id="queue-module-interaction"><a href="#queue-module-interaction" class="header-anchor">#</a> Queue module interaction</h2> <p><img src="/assets/img/queue_template_interacition.57ea02f9.png" alt="queue module interaction"></p> <p>caution:</p> <ul><li>In Chain33, the system instantiates only one queue, and each module instantiates a queue.client.</li> <li>One queue can correspond to multiple subscription topics, which means that a queue can instantiate multiple queue.clients.</li> <li>One queue.client can only correspond to one subscription topic.</li> <li>Exector and RPC modules all instantiate an additional QueueProtocol respectively.</li></ul> <h2 id="data-structure-of-queue-and-client"><a href="#data-structure-of-queue-and-client" class="header-anchor">#</a> data structure of Queue and Client</h2> <p>Three main data structures are defined in queue, queue, client, Message. Their data structures and interfaces are described below.</p> <h3 id="data-structure-and-interface-of-queue"><a href="#data-structure-and-interface-of-queue" class="header-anchor">#</a> data structure and Interface of Queue</h3> <p>The implementation of queue is mainly made use of the attributes of channel in the go language, using the cache channel feature ‚Äúfirst in first out‚Äù.Defined chanSub defining channels, one subscription topic for one chanSub.</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// queue data structure</span>
<span class="token keyword">type</span> queue <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    chanSubs <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">*</span>chanSub   <span class="token comment">// Channels subscribed in queue, key = subscription nameÔºåvalue is the subscription channel</span>
    mu       sync<span class="token punctuation">.</span>Mutex            <span class="token comment">// synchronized lock</span>
    done     <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>         <span class="token comment">// closure notification</span>
    interupt <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>         <span class="token comment">// When a program is interrupted, such as in Linux using CTRL +c to end the program, interupt will be triggered to close the queue</span>
    isClose  <span class="token builtin">int32</span>                 <span class="token comment">// queue status, 1 is off</span>
    name     <span class="token builtin">string</span>                <span class="token comment">// queue name</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>The queue interface is relatively simple, but the major point is the client() method, and everything else is executed as a client
Queue is a one-to-many relationship with client.</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// queue interface</span>
<span class="token keyword">type</span> Queue <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                       <span class="token comment">// close queue</span>
    <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                       <span class="token comment">// start</span>
    <span class="token function">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Client               <span class="token comment">// Get the client of the queue, In chain33, all msg's send and receive are called by client.</span>
    <span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>                 <span class="token comment">// get queue name</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="chansub-channel-subscribing-and-message"><a href="#chansub-channel-subscribing-and-message" class="header-anchor">#</a> ChanSub Channel Subscribing and Message</h3> <p>We set up synchronous and asynchronous channels based on the size of the channel cache in ChanSub Data processing has the highest priority in the synchronization channel.</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// chanSub data structure</span>
<span class="token keyword">type</span> chanSub <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    high    <span class="token keyword">chan</span> Message          <span class="token comment">// Synchronizes channels, default cache size 64</span>
    low     <span class="token keyword">chan</span> Message          <span class="token comment">// Asynchronous processing channels, default cache size 40960</span>
    isClose <span class="token builtin">int32</span>                 <span class="token comment">// Subscription channel status, 1 is closed</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Here we‚Äôve defined MSG, and we‚Äôve cleverly used the channel property.
Return response data through the chReply response channel.</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Message data structure</span>
<span class="token keyword">type</span> Message <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Topic   <span class="token builtin">string</span>                <span class="token comment">// topic, that is to whom</span>
    Ty      <span class="token builtin">int64</span>                 <span class="token comment">// message type</span>
    Id      <span class="token builtin">int64</span>                 <span class="token comment">// self-growing ID, each MSG has a unique ID corresponding to itself in the same queue</span>
    Data    <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>           <span class="token comment">// message data</span>
    chReply <span class="token keyword">chan</span> Message          <span class="token comment">// msg response channel, which returns data about the receiver's response, makes some clever use of chan-specific properties</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="client-data-structure-and-interface"><a href="#client-data-structure-and-interface" class="header-anchor">#</a> Client Data Structure and Interface</h3> <p>All msg ‚Äúsend‚Äù and ‚Äúreceive‚Äù in the queue are sent through the client</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Client data structure</span>
<span class="token keyword">type</span> client <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    q          <span class="token operator">*</span>queue             <span class="token comment">// queue instances</span>
    recv       <span class="token keyword">chan</span> Message       <span class="token comment">// receive msg channel with default buffer of 5</span>
    done       <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>      <span class="token comment">// notify client to close</span>
    wg         <span class="token operator">*</span>sync<span class="token punctuation">.</span>WaitGroup    <span class="token comment">// synchronization waiting</span>
    topic      <span class="token builtin">string</span>             <span class="token comment">// subscription topic</span>
    isClosed   <span class="token builtin">int32</span>              <span class="token comment">// client status, 1 is off</span>
    isCloseing <span class="token builtin">int32</span>              <span class="token comment">// 1 indicates the client state is closed</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Client implements the following methods to construct Msg, send, wait, Recv, etc.</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Client interface</span>
<span class="token keyword">type</span> Client <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Send</span><span class="token punctuation">(</span>msg Message<span class="token punctuation">,</span> waitReply <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span>                               <span class="token comment">//send message, the default main network timeout is 10 minutes</span>
    <span class="token function">SendTimeout</span><span class="token punctuation">(</span>msg Message<span class="token punctuation">,</span> waitReply <span class="token builtin">bool</span><span class="token punctuation">,</span> timeout time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token comment">//send message, customize the timeout</span>
    <span class="token function">Wait</span><span class="token punctuation">(</span>msg Message<span class="token punctuation">)</span> <span class="token punctuation">(</span>Message<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>                                          <span class="token comment">//wait for the message processing to complete, the default main network timeout is 10 minutes</span>
    <span class="token function">WaitTimeout</span><span class="token punctuation">(</span>msg Message<span class="token punctuation">,</span> timeout time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token punctuation">(</span>Message<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>            <span class="token comment">//wait for the message processing to complete, customize the timeout</span>
    <span class="token function">Recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">chan</span> Message                                                         <span class="token comment">//get client receive message channel</span>
    <span class="token function">Sub</span><span class="token punctuation">(</span>topic <span class="token builtin">string</span><span class="token punctuation">)</span>                                                           <span class="token comment">//subscribe message</span>
    <span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                                                     <span class="token comment">//close client</span>
    <span class="token function">CloseQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Reply<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>                                          <span class="token comment">//close queue</span>
    <span class="token function">NewMessage</span><span class="token punctuation">(</span>topic <span class="token builtin">string</span><span class="token punctuation">,</span> ty <span class="token builtin">int64</span><span class="token punctuation">,</span> data <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>msg Message<span class="token punctuation">)</span>          <span class="token comment">//new one msg</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="module-interface"><a href="#module-interface" class="header-anchor">#</a> Module Interface</h3> <p>All modules implement Module interfaces in Chain33.
The main function of <code>SetQueueClient()</code> method is to set up subscription topics, process your own subscribed Msg according to the business and return it.</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Module be used for module interface</span>
<span class="token keyword">type</span> Module <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">SetQueueClient</span><span class="token punctuation">(</span>client Client<span class="token punctuation">)</span> <span class="token comment">//All modules will implement this interface, where the corresponding msg will be specifically processed</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="use-of-queue-in-chain33"><a href="#use-of-queue-in-chain33" class="header-anchor">#</a> Use of Queue in Chain33</h2> <p>The entire process will be presented in pseudo-code form with the code from chain33</p> <h3 id="initialize-queue-assign-values-start"><a href="#initialize-queue-assign-values-start" class="header-anchor">#</a> Initialize Queue, Assign Values, Start</h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token operator">...</span>
    log<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;loading queue&quot;</span><span class="token punctuation">)</span>
    q <span class="token operator">:=</span> queue<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;channel&quot;</span><span class="token punctuation">)</span>        <span class="token comment">//Instantiate a queue named channel</span>
    log<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;loading blockchain module&quot;</span><span class="token punctuation">)</span>
    chain <span class="token operator">:=</span> blockchain<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>BlockChain<span class="token punctuation">)</span>
    chain<span class="token punctuation">.</span><span class="token function">SetQueueClient</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span><span class="token function">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//Pass q.cilient (), to SetQueueClient() is the actual processing logic for each module</span>
    <span class="token operator">...</span><span class="token operator">...</span>
    <span class="token comment">//jsonrpc, grpc, channel: three patterns</span>
    rpcapi <span class="token operator">:=</span> rpc<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>Rpc<span class="token punctuation">)</span>
    rpcapi<span class="token punctuation">.</span><span class="token function">SetQueueClient</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span><span class="token function">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//Assign client to rpcapi</span>
    <span class="token operator">...</span><span class="token operator">...</span>
    q<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token comment">//start queue</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="implement-module-interface-for-specific-business-processing"><a href="#implement-module-interface-for-specific-business-processing" class="header-anchor">#</a> Implement Module Interface for Specific Business Processing</h3> <p>Here take the blockchain module as an example to how to handle msg received.</p> <p>The method of blockchain to implement the SetQueueClient</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>chain <span class="token operator">*</span>BlockChain<span class="token punctuation">)</span> <span class="token function">SetQueueClient</span><span class="token punctuation">(</span>client queue<span class="token punctuation">.</span>Client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    chain<span class="token punctuation">.</span>client <span class="token operator">=</span> client
    chain<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span><span class="token string">&quot;blockchain&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// the client will only receive messages whose topic is blockchain after setting up a subscription topic</span>
    <span class="token operator">...</span><span class="token operator">...</span>
    <span class="token keyword">go</span> chain<span class="token punctuation">.</span><span class="token function">ProcRecvMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token comment">//do something specific of received messages</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>blockchain processes receiving msg:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//message reception processing for blockchain module</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>chain <span class="token operator">*</span>BlockChain<span class="token punctuation">)</span> <span class="token function">ProcRecvMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">defer</span> chain<span class="token punctuation">.</span>recvwg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    reqnum <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token comment">//flow control is done here, and the maximum processing is 1000 msg at one time</span>
    <span class="token keyword">for</span> msg <span class="token operator">:=</span> <span class="token keyword">range</span> chain<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">Recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//take msg from the client</span>
        chainlog<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token string">&quot;blockchain recv&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> types<span class="token punctuation">.</span><span class="token function">GetEventName</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>Ty<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> <span class="token string">&quot;cap&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>reqnum<span class="token punctuation">)</span><span class="token punctuation">)</span>
        msgtype <span class="token operator">:=</span> msg<span class="token punctuation">.</span>Ty
        reqnum <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
        atomic<span class="token punctuation">.</span><span class="token function">AddInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>chain<span class="token punctuation">.</span>runcount<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">switch</span> msgtype <span class="token punctuation">{</span>
        <span class="token keyword">case</span> types<span class="token punctuation">.</span>EventLocalGet<span class="token punctuation">:</span>
            <span class="token keyword">go</span> chain<span class="token punctuation">.</span><span class="token function">processMsg</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> reqnum<span class="token punctuation">,</span> chain<span class="token punctuation">.</span>localGet<span class="token punctuation">)</span> <span class="token comment">// general approach to msg in blockchain</span>
        <span class="token operator">...</span><span class="token operator">...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>The processMsg method processes the logic and calls the incoming func</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// processMsg</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>chain <span class="token operator">*</span>BlockChain<span class="token punctuation">)</span> <span class="token function">processMsg</span><span class="token punctuation">(</span>msg queue<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> reqnum <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> cb funcProcess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    beg <span class="token operator">:=</span> types<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">&lt;-</span>reqnum 
        atomic<span class="token punctuation">.</span><span class="token function">AddInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>chain<span class="token punctuation">.</span>runcount<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//After processing one msg, the runcount counter is reduced by one</span>
        chainlog<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token string">&quot;process&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;cost&quot;</span><span class="token punctuation">,</span> types<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>beg<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> types<span class="token punctuation">.</span><span class="token function">GetEventName</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>Ty<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">cb</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token comment">//Call the incoming function</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>The corresponding func is triggered based on the message type, in this case is the localGet method</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// localGet</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>chain <span class="token operator">*</span>BlockChain<span class="token punctuation">)</span> <span class="token function">localGet</span><span class="token punctuation">(</span>msg queue<span class="token punctuation">.</span>Message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	keys <span class="token operator">:=</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>Data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBGet<span class="token punctuation">)</span>
	values <span class="token operator">:=</span> chain<span class="token punctuation">.</span>blockStore<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span>
	msg<span class="token punctuation">.</span><span class="token function">Reply</span><span class="token punctuation">(</span>chain<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">NewMessage</span><span class="token punctuation">(</span><span class="token string">&quot;rpc&quot;</span><span class="token punctuation">,</span> types<span class="token punctuation">.</span>EventLocalReplyValue<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Return the processed result</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Reply method in Message</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>msg Message<span class="token punctuation">)</span> <span class="token function">Reply</span><span class="token punctuation">(</span>replyMsg Message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> msg<span class="token punctuation">.</span>chReply <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        qlog<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token string">&quot;reply a empty chreply&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    msg<span class="token punctuation">.</span>chReply <span class="token operator">&lt;-</span> replyMsg  <span class="token comment">//Plug replyMsg into the chReply channel of the msg receiving</span>
    qlog<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token string">&quot;reply msg ok&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="queueprotocol-make-secondary-packaging-to-client-to-satisfy-the-external-call"><a href="#queueprotocol-make-secondary-packaging-to-client-to-satisfy-the-external-call" class="header-anchor">#</a> QueueProtocol Make Secondary Packaging to Client to Satisfy the External Call</h3> <p>From the above we can know that msg send and receive both need to go through the client of queue
In the internal modules of the system, such as block,mempool,consensus, etc., you can directly call the <code>client.send()</code> method. But if I‚Äôm outside the system, how do I call it? Let‚Äôs learn about the QueueProtocol first.</p> <h4 id="queueprotocol-data-structure"><a href="#queueprotocol-data-structure" class="header-anchor">#</a> QueueProtocol Data Structure</h4> <p>QueueProtocol data structure, here is to wrap queue.client so that it can communicate with other modules without setting up subscription topics.</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// QueueProtocol data structure</span>
<span class="token keyword">type</span> QueueProtocolOption <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// request sending timeout</span>
    SendTimeout time<span class="token punctuation">.</span>Duration
    <span class="token comment">// Receiving and replying timeout</span>
    WaitTimeout time<span class="token punctuation">.</span>Duration
<span class="token punctuation">}</span>
<span class="token comment">// Message channel protocol implementation</span>
<span class="token keyword">type</span> QueueProtocol <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// message queue</span>
    client queue<span class="token punctuation">.</span>Client
    option QueueProtocolOption
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="queueprotocol-instantiation-in-rpc-and-executor"><a href="#queueprotocol-instantiation-in-rpc-and-executor" class="header-anchor">#</a> QueueProtocol Instantiation in RPC and Executor</h4> <p>Call it by instantiating the QueueProtocol.
A QueueProtocol object is instantiated here, <code>client.New(q.Client(), nil)</code>, jsonRPC and gRPC Share this QueueProtocol</p> <p>The method of RPC module to implement the SetQueueClient</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Rpc implements the Module interface</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>RPC<span class="token punctuation">)</span> <span class="token function">SetQueueClient</span><span class="token punctuation">(</span>c queue<span class="token punctuation">.</span>Client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gapi <span class="token operator">:=</span> <span class="token function">NewGRpcServer</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    japi <span class="token operator">:=</span> <span class="token function">NewJSONRPCServer</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>gapi <span class="token operator">=</span> gapi
    r<span class="token punctuation">.</span>japi <span class="token operator">=</span> japi
    r<span class="token punctuation">.</span>c <span class="token operator">=</span> c
    <span class="token comment">//Registration system RPC</span>
    pluginmgr<span class="token punctuation">.</span><span class="token function">AddRPC</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
    <span class="token keyword">go</span> gapi<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">go</span> japi<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>The executor module also instantiates a QueueProtocol</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>exec <span class="token operator">*</span>Executor<span class="token punctuation">)</span> <span class="token function">SetQueueClient</span><span class="token punctuation">(</span>qcli queue<span class="token punctuation">.</span>Client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    exec<span class="token punctuation">.</span>client <span class="token operator">=</span> qcli
    exec<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span><span class="token string">&quot;execs&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> err <span class="token builtin">error</span>
    exec<span class="token punctuation">.</span>qclient<span class="token punctuation">,</span> err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>qcli<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>  <span class="token comment">//The executor module also instantiates a QueueProtocol</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//recv massage processing</span>
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> msg <span class="token operator">:=</span> <span class="token keyword">range</span> exec<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">Recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="queueprotocolapi-interface-implemented-by-the-queueprotocolapi"><a href="#queueprotocolapi-interface-implemented-by-the-queueprotocolapi" class="header-anchor">#</a> QueueProtocolAPI Interface Implemented by the QueueProtocolAPI</h4> <p>The QueueProtocolAPI defines and implements a few API methods to be used by other modules, primarily by converting the API method‚Äôs incoming parameters to the appropriate msg to be sent, receiving and processing the returned msg, and then converting MSG back to data structure required by API method.</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Message channel interaction API interface definition</span>
<span class="token keyword">type</span> QueueProtocolAPI <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token operator">...</span>
    <span class="token comment">// +++++++++++++++ consensus interfaces begin</span>
    <span class="token comment">// types.EventGetTicketCount</span>
    <span class="token function">GetTicketCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Int64<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
    <span class="token comment">// --------------- consensus interfaces end</span>
    <span class="token comment">// +++++++++++++++ wallet interfaces begin</span>
    <span class="token comment">// types.EventLocalGet</span>
    <span class="token function">LocalGet</span><span class="token punctuation">(</span>param <span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBGet<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalReplyValue<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
    <span class="token comment">// types.EventLocalList</span>
    <span class="token operator">...</span><span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Here takes the LocalGet() as an example to show how to convert parameters to msg for processing</p> <p>Call the LocalGet() method in QueueProtocol to trigger MSG that sends types.eventlocalget type to blockchain.</p> <p>The LocalGet method triggers the query method</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>q <span class="token operator">*</span>QueueProtocol<span class="token punctuation">)</span> <span class="token function">LocalGet</span><span class="token punctuation">(</span>param <span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBGet<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalReplyValue<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token operator">...</span>
    msg<span class="token punctuation">,</span> err <span class="token operator">:=</span> q<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>blockchainKey<span class="token punctuation">,</span> types<span class="token punctuation">.</span>EventLocalGet<span class="token punctuation">,</span> param<span class="token punctuation">)</span>  <span class="token comment">//Common query method of the QueueProtocol module</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;LocalGet&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Error&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> reply<span class="token punctuation">,</span> ok <span class="token operator">:=</span> msg<span class="token punctuation">.</span><span class="token function">GetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalReplyValue<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span> 
        <span class="token keyword">return</span> reply<span class="token punctuation">,</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span><span class="token operator">...</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> types<span class="token punctuation">.</span>ErrTypeAsset
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Method ‚Äúquery‚Äù is to wrap related param into Msg and send it to the corresponding module.</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>q <span class="token operator">*</span>QueueProtocol<span class="token punctuation">)</span> <span class="token function">query</span><span class="token punctuation">(</span>topic <span class="token builtin">string</span><span class="token punctuation">,</span> ty <span class="token builtin">int64</span><span class="token punctuation">,</span> data <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    client <span class="token operator">:=</span> q<span class="token punctuation">.</span>client
    msg <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">NewMessage</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token comment">//Convert the relevant parameters to msg</span>
    <span class="token keyword">var</span> trace <span class="token operator">*</span>tlog<span class="token punctuation">.</span>TraceInfo
    <span class="token keyword">if</span> tlog<span class="token punctuation">.</span><span class="token function">TraceOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> item<span class="token punctuation">,</span> ok <span class="token operator">:=</span> data<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
            trace <span class="token operator">=</span> tlog<span class="token punctuation">.</span><span class="token function">CreateTraceMsg</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> hex<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tlog<span class="token punctuation">.</span>MsgCreate<span class="token punctuation">,</span> tlog<span class="token punctuation">.</span>RpcKey<span class="token punctuation">,</span> <span class="token string">&quot;query&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> trace <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                trace<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">SendTimeout</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> q<span class="token punctuation">.</span>option<span class="token punctuation">.</span>SendTimeout<span class="token punctuation">)</span> <span class="token comment">//synchronous sending</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> trace <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            trace<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> queue<span class="token punctuation">.</span>Message<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
    msg<span class="token punctuation">,</span> errR <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">WaitTimeout</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> q<span class="token punctuation">.</span>option<span class="token punctuation">.</span>WaitTimeout<span class="token punctuation">)</span> <span class="token comment">//Wait for response after msg processed</span>
    <span class="token keyword">if</span> trace <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        trace<span class="token punctuation">.</span><span class="token function">UpdateState</span><span class="token punctuation">(</span>tlog<span class="token punctuation">.</span>MsgProcessed<span class="token punctuation">)</span>
        <span class="token keyword">if</span> errR <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            trace<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>errR<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            trace<span class="token punctuation">.</span><span class="token function">End</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> msg<span class="token punctuation">,</span> errR
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>WaitTimeout method in client, wait for MSG response results.</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// waitTimeout method in client</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>client <span class="token operator">*</span>client<span class="token punctuation">)</span> <span class="token function">WaitTimeout</span><span class="token punctuation">(</span>msg Message<span class="token punctuation">,</span> timeout time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token punctuation">(</span>Message<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> msg<span class="token punctuation">.</span>chReply <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Message<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;empty wait channel&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    t <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">NewTimer</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>
    <span class="token keyword">defer</span> t<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">select</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> msg <span class="token operator">=</span> <span class="token operator">&lt;-</span>msg<span class="token punctuation">.</span>chReply<span class="token punctuation">:</span>  <span class="token comment">//Reschedule the original msg from the chReply response channel</span>
        <span class="token keyword">return</span> msg<span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>client<span class="token punctuation">.</span>done<span class="token punctuation">:</span>
        <span class="token keyword">return</span> Message<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;client is closed&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>t<span class="token punctuation">.</span>C<span class="token punctuation">:</span>
        <span class="token keyword">return</span> Message<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> types<span class="token punctuation">.</span>ErrTimeout   <span class="token comment">//If timeout, a timeout error will be returned</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/bityuan/bty-docs/edit/main/guide/05.Advanced/1.Function Modules/8.Queue Module.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">May 26, 2023 16:48</span></div> <!----></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.e4f15799.js" defer></script><script src="/assets/js/vendors~layout-Layout.1136eb17.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.273fc434.js" defer></script><script src="/assets/js/page-QueueModule.eae700a7.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.4a182f2f.js" defer></script>
  </body>
</html>
