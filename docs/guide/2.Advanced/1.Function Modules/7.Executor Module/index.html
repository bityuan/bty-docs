<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Executor Module | BitYuan</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="A demo for vuepress-theme-hope">
    <meta property="og:url" content="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module.html">
    <meta property="og:site_name" content="BitYuan">
    <meta property="og:title" content="Executor Module">
    <meta property="og:description" content="Executor Module Module Introduction As the name implies, an executor module is primarily used to execute logic. In the blockchain, all data are generated by transactions. These dat">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta property="og:locale:alternate" content="zh-CN">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="BitYuan">
    
    <link rel="preload" href="/assets/css/0.styles.b9744494.css" as="style"><link rel="preload" href="/assets/js/app.dbdd87ec.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.7c31f7ee.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.273fc434.js" as="script"><link rel="preload" href="/assets/js/page-ExecutorModule.21056006.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.4a182f2f.js" as="script"><link rel="prefetch" href="/assets/js/127.b650c9de.js"><link rel="prefetch" href="/assets/js/128.082a47dc.js"><link rel="prefetch" href="/assets/js/129.f8a098bb.js"><link rel="prefetch" href="/assets/js/130.a5b110ca.js"><link rel="prefetch" href="/assets/js/131.5b17a044.js"><link rel="prefetch" href="/assets/js/layout-Blog.6829de3b.js"><link rel="prefetch" href="/assets/js/layout-Layout.85d11602.js"><link rel="prefetch" href="/assets/js/layout-NotFound.4658b628.js"><link rel="prefetch" href="/assets/js/layout-Slide.298ab16e.js"><link rel="prefetch" href="/assets/js/page-AccountModel.24310b72.js"><link rel="prefetch" href="/assets/js/page-BalanceInquiry.82767949.js"><link rel="prefetch" href="/assets/js/page-BitYuanIntroduction.4720fc4f.js"><link rel="prefetch" href="/assets/js/page-BitYuanMainNetworkEnvironmentConfiguration.d80c35f3.js"><link rel="prefetch" href="/assets/js/page-BitYuanWalletGuidelines.f3e358df.js"><link rel="prefetch" href="/assets/js/page-BlockchainInterface.097175f1.js"><link rel="prefetch" href="/assets/js/page-BlockchainModule.f9021eb5.js"><link rel="prefetch" href="/assets/js/page-Blockchain模块.ea794ee2.js"><link rel="prefetch" href="/assets/js/page-Buildparachain.7696998b.js"><link rel="prefetch" href="/assets/js/page-CA工具使用说明.534d995c.js"><link rel="prefetch" href="/assets/js/page-CA服务使用说明.a6393237.js"><link rel="prefetch" href="/assets/js/page-CaseFoodTraceability.b3ae388d.js"><link rel="prefetch" href="/assets/js/page-Chain33系统接口.810fcd17.js"><link rel="prefetch" href="/assets/js/page-ConsensusModule.77034b65.js"><link rel="prefetch" href="/assets/js/page-CreateBitYuanparentBlockchain.fd7e5fe3.js"><link rel="prefetch" href="/assets/js/page-DAPPdevelopmentinGolanguage.a0b2b1bb.js"><link rel="prefetch" href="/assets/js/page-DAPPdevelopmentinJavaScriptlanguage.1f2bfb1d.js"><link rel="prefetch" href="/assets/js/page-DAPPdevelopmentinSoliditylanguage.dd1d380d.js"><link rel="prefetch" href="/assets/js/page-DAPP开发介绍.8d0be772.js"><link rel="prefetch" href="/assets/js/page-DecentralizedApplication.2cbb0b9b.js"><link rel="prefetch" href="/assets/js/page-Deployblockchainbrowser.208a7ce4.js"><link rel="prefetch" href="/assets/js/page-Deploysmartcontract.5a1e5cc7.js"><link rel="prefetch" href="/assets/js/page-Deploywallet.bb290423.js"><link rel="prefetch" href="/assets/js/page-Dockingwithexternalapplication.129742b2.js"><link rel="prefetch" href="/assets/js/page-EVMInterface.564a26bc.js"><link rel="prefetch" href="/assets/js/page-EVM接口.56dacf5b.js"><link rel="prefetch" href="/assets/js/page-EventInterface.892f0cf9.js"><link rel="prefetch" href="/assets/js/page-ExecutorInterface.ec391e15.js"><link rel="prefetch" href="/assets/js/page-GRPC接口约定.a915abdb.js"><link rel="prefetch" href="/assets/js/page-Go语言开发DAPP.2407e0b8.js"><link rel="prefetch" href="/assets/js/page-InterfaceContract.ff6de1f2.js"><link rel="prefetch" href="/assets/js/page-IntroductiontoDAppDevelopment.d236125c.js"><link rel="prefetch" href="/assets/js/page-JavaScript语言开发DAPP.b2f73f16.js"><link rel="prefetch" href="/assets/js/page-Manage.6c985bf4.js"><link rel="prefetch" href="/assets/js/page-ManageInterface.96ec51c7.js"><link rel="prefetch" href="/assets/js/page-MempoolInterface.b9646544.js"><link rel="prefetch" href="/assets/js/page-MempoolModule.451b5f6a.js"><link rel="prefetch" href="/assets/js/page-Mempool接口.5047eac8.js"><link rel="prefetch" href="/assets/js/page-Mempool模块.8c0d9c7f.js"><link rel="prefetch" href="/assets/js/page-MiningInterface.914d96a7.js"><link rel="prefetch" href="/assets/js/page-NetworkType.785ad336.js"><link rel="prefetch" href="/assets/js/page-P2PModule.9e5f371e.js"><link rel="prefetch" href="/assets/js/page-P2P模块.78060dec.js"><link rel="prefetch" href="/assets/js/page-ParachainTokenIssuance.d1a05c4c.js"><link rel="prefetch" href="/assets/js/page-Project.5b38a30a.js"><link rel="prefetch" href="/assets/js/page-QueueModule.6c3f0833.js"><link rel="prefetch" href="/assets/js/page-Queue模块.b5293c6c.js"><link rel="prefetch" href="/assets/js/page-RPCModule.054d8033.js"><link rel="prefetch" href="/assets/js/page-RPC接口编程样例.57c1ba62.js"><link rel="prefetch" href="/assets/js/page-RPC模块.3c58f2ba.js"><link rel="prefetch" href="/assets/js/page-SPOSConsensus.50497cb8.js"><link rel="prefetch" href="/assets/js/page-SPOS共识.43c94739.js"><link rel="prefetch" href="/assets/js/page-SmartContract.f74bd27f.js"><link rel="prefetch" href="/assets/js/page-Solidity语言开发DAPP.4b823e82.js"><link rel="prefetch" href="/assets/js/page-StorageModule.ecdc9a5a.js"><link rel="prefetch" href="/assets/js/page-SystemInterface.44152fda.js"><link rel="prefetch" href="/assets/js/page-SystemModule.f345b0c3.js"><link rel="prefetch" href="/assets/js/page-TechnicalArchitecture.908be20b.js"><link rel="prefetch" href="/assets/js/page-Terminology.d84612b5.js"><link rel="prefetch" href="/assets/js/page-TokenInterface.0aebaf0f.js"><link rel="prefetch" href="/assets/js/page-Token接口.bfd8de1e.js"><link rel="prefetch" href="/assets/js/page-Trade.4a7ee1a6.js"><link rel="prefetch" href="/assets/js/page-Trade接口.6dc85db9.js"><link rel="prefetch" href="/assets/js/page-TransactionInterface.9c7217cd.js"><link rel="prefetch" href="/assets/js/page-Unfreeze.259fba8d.js"><link rel="prefetch" href="/assets/js/page-UnfreezeInterface.15eb4256.js"><link rel="prefetch" href="/assets/js/page-WalletInterface.5cea6d2a.js"><link rel="prefetch" href="/assets/js/page-WalletModule.a8e50e74.js"><link rel="prefetch" href="/assets/js/page-WalletRecoveryContract.2d8aba2c.js"><link rel="prefetch" href="/assets/js/page-Wallet接口.0348f894.js"><link rel="prefetch" href="/assets/js/page-autonomy接口.b349b4a7.js"><link rel="prefetch" href="/assets/js/page-事件接口.669f8175.js"><link rel="prefetch" href="/assets/js/page-交易接口.1486e3c4.js"><link rel="prefetch" href="/assets/js/page-公链发展趋势.ff4d4ca7.js"><link rel="prefetch" href="/assets/js/page-共识模块.aae66bf0.js"><link rel="prefetch" href="/assets/js/page-创建比特元主链节点.88d30ff3.js"><link rel="prefetch" href="/assets/js/page-区块链接口.cad9d3b2.js"><link rel="prefetch" href="/assets/js/page-去中心化应用.c6b3f716.js"><link rel="prefetch" href="/assets/js/page-命令行工具介绍.b96bd504.js"><link rel="prefetch" href="/assets/js/page-国密支持.10f72d68.js"><link rel="prefetch" href="/assets/js/page-多重签名.0b2386db.js"><link rel="prefetch" href="/assets/js/page-存储模块.d30ed1ff.js"><link rel="prefetch" href="/assets/js/page-对接外部应用.aae31c2c.js"><link rel="prefetch" href="/assets/js/page-平行链共识节点挖矿奖励规则.d4ce00f1.js"><link rel="prefetch" href="/assets/js/page-平行链发行Token.23d746ad.js"><link rel="prefetch" href="/assets/js/page-平行链环境配置.45afd422.js"><link rel="prefetch" href="/assets/js/page-平行链资产转移管理介绍.91d64cfc.js"><link rel="prefetch" href="/assets/js/page-平行链超级节点创建和超级账户管理介绍.17de9764.js"><link rel="prefetch" href="/assets/js/page-执行器接口.e700e759.js"><link rel="prefetch" href="/assets/js/page-执行器模块.5e7f19c9.js"><link rel="prefetch" href="/assets/js/page-技术架构.f2c16d3b.js"><link rel="prefetch" href="/assets/js/page-挖矿接口.f3dbf804.js"><link rel="prefetch" href="/assets/js/page-接口约定.d9241964.js"><link rel="prefetch" href="/assets/js/page-搭建平行链.b7afc70b.js"><link rel="prefetch" href="/assets/js/page-文档主页.e974f182.js"><link rel="prefetch" href="/assets/js/page-智能合约.5aa41124.js"><link rel="prefetch" href="/assets/js/page-术语介绍.76e1a053.js"><link rel="prefetch" href="/assets/js/page-查询余额.580b1d6f.js"><link rel="prefetch" href="/assets/js/page-比特元主网环境配置.4ee7c436.js"><link rel="prefetch" href="/assets/js/page-比特元介绍.dbc37b84.js"><link rel="prefetch" href="/assets/js/page-比特元钱包操作手册.00d794ca.js"><link rel="prefetch" href="/assets/js/page-系统模块.d60e3279.js"><link rel="prefetch" href="/assets/js/page-系统要求.35c7ed76.js"><link rel="prefetch" href="/assets/js/page-网络类型.247ec8fd.js"><link rel="prefetch" href="/assets/js/page-账户模型.92e9198f.js"><link rel="prefetch" href="/assets/js/page-部署区块链浏览器.5d6895b8.js"><link rel="prefetch" href="/assets/js/page-部署智能合约.6a8fdcd6.js"><link rel="prefetch" href="/assets/js/page-部署钱包.79b5b503.js"><link rel="prefetch" href="/assets/js/page-钱包找回合约.807bf6a4.js"><link rel="prefetch" href="/assets/js/page-钱包模块.97ef89d7.js"><link rel="prefetch" href="/assets/js/page-错误码.6e090938.js"><link rel="prefetch" href="/assets/js/page-隐私保护.b6e9db67.js"><link rel="prefetch" href="/assets/js/page-食品溯源案例.b1823158.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.aa92a9a8.js"><link rel="prefetch" href="/assets/js/vendors~mermaid.67f64f25.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.edbedfc8.js"><link rel="prefetch" href="/assets/js/vendors~reveal.497b139f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b9744494.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="BitYuan" class="logo"> <!----> <span class="site-name can-hide">BitYuan</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><!----> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="switch"><input id="switch" type="checkbox" checked="checked" class="switch-input"> <label for="switch" class="label"><span class="label-content"></span></label></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><!---->
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link router-link-active active"><!---->
  Guide
</a></div></nav> <div class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" style="width:1rem;height:1rem;vertical-align:middle;margin-left:1rem;"><path d="M639.981 344.075c14.805 44.45 34.542 79.023 69.084 113.596 29.603-29.634 49.34-69.146 64.145-113.596H639.981zM314.33 591.024h128.29l-64.145-172.865-64.145 172.865z" fill="currentColor"></path> <path d="M807.746 116.882H215.643c-54.274 0-98.681 44.45-98.681 98.78v592.677c0 54.329 44.407 98.78 98.68 98.78h592.104c54.273 0 98.681-44.451 98.681-98.78V215.66c0-54.329-39.475-98.78-98.68-98.78zM565.971 754.01c-9.866 9.878-19.738 9.878-29.603 9.878-4.94 0-14.805 0-19.738-4.939-4.939-4.939-9.872 0-9.872-4.939s-4.932-9.878-9.865-19.756c-4.94-9.878-4.94-14.817-9.872-24.695L467.29 655.23H294.592l-19.737 54.33c-9.866 19.755-14.805 34.572-19.738 44.45-4.939 9.878-14.804 9.878-29.603 9.878-9.871 0-19.737-4.939-29.609-9.878-9.865-9.878-14.798-14.817-14.798-24.695 0-4.939 0-9.878 4.933-19.756 4.939-9.878 4.939-14.817 9.865-24.695l108.553-276.583c4.939-9.878 4.939-19.756 9.872-29.633 4.932-9.878 9.865-19.756 14.798-24.695 4.939-4.94 9.872-14.817 19.737-19.756 9.872-4.94 19.738-4.94 29.61-4.94 9.865 0 19.73 0 29.603 4.94 9.865 4.939 14.804 9.878 19.737 19.756 4.933 4.939 9.866 14.817 14.798 24.695 4.94 9.877 9.872 19.755 14.805 34.572l108.553 271.644c9.865 19.756 14.804 34.573 14.804 44.451-4.939 4.94-9.872 14.817-14.804 24.695zm271.378-192.62c-54.273-19.756-93.748-44.451-128.29-74.085-34.536 34.573-78.943 59.268-133.223 74.085l-14.798-24.695c54.273-14.817 98.68-34.573 133.223-69.146-34.542-34.573-64.145-79.024-74.017-128.413h-49.34V319.38h133.228c-9.877-14.817-19.743-34.573-29.609-49.39l14.799-4.94c9.871 14.818 24.676 34.574 34.542 54.33h123.35v24.695h-49.34c-14.798 49.39-39.468 93.84-69.077 123.474 34.541 29.634 74.01 54.329 128.29 69.146l-19.738 24.695z" fill="currentColor"></path></svg> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/" aria-current="page" class="nav-link router-link-exact-active router-link-active active"><!---->
  English
</a></li><li class="dropdown-item"><a href="/zh/" class="nav-link"><!---->
  简体中文
</a></li></ul></div></div></div> <a rel="noopener noreferrer" href="https://github.com/bityuan/bty-docs" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><!---->
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link router-link-active active"><!---->
  Guide
</a></div> <a rel="noopener noreferrer" href="https://github.com/bityuan/bty-docs" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/" aria-current="page" class="sidebar-link">BitYuan Introduction</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Quick Start</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable open"><!----> <span class="title">Advanced</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading clickable open"><!----> <span class="title">Function Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/2.Advanced/1.Function%20Modules/1.P2P%20Module/" class="sidebar-link">P2P Module</a></li><li><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/" class="sidebar-link">Storage Module</a></li><li><a href="/guide/2.Advanced/1.Function%20Modules/3.Blockchain%20Module/" class="sidebar-link">Blockchain Module</a></li><li><a href="/guide/2.Advanced/1.Function%20Modules/4.Mempool%20Module/" class="sidebar-link">Mempool Module</a></li><li><a href="/guide/2.Advanced/1.Function%20Modules/5.Consensus%20Module/" class="sidebar-link">Consensus Module</a></li><li><a href="/guide/2.Advanced/1.Function%20Modules/6.Wallet%20Module/" class="sidebar-link">Wallet Module</a></li><li><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/" aria-current="page" class="active sidebar-link">Executor Module</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#module-introduction" class="sidebar-link">Module Introduction</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#executor-module-structure" class="sidebar-link">Executor Module Structure</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#internal-logic-structure-of-the-executor" class="sidebar-link">Internal logic structure of the executor</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#processing-logic" class="sidebar-link">Processing Logic</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#transaction-check" class="sidebar-link heading3">Transaction Check</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#transaction-execution" class="sidebar-link heading3">Transaction Execution</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#query-history" class="sidebar-link heading3">Query History</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#add-new-block" class="sidebar-link heading3">Add New Block</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#block-rollback" class="sidebar-link heading3">Block Rollback</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#the-overall-processing-logic-of-the-executor" class="sidebar-link heading3">The overall processing logic of the executor</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#secondary-development" class="sidebar-link">Secondary Development</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#overview-of-echo-executor" class="sidebar-link heading3">Overview of Echo Executor</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#transaction-check-2" class="sidebar-link heading3">Transaction Check</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#transaction-execution-2" class="sidebar-link heading3">Transaction Execution</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#add-new-block-2" class="sidebar-link heading3">Add New Block</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#block-rollback-2" class="sidebar-link heading3">Block Rollback</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#query-history-2" class="sidebar-link heading3">Query History</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#create-transaction-logic" class="sidebar-link heading3">Create Transaction Logic</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#注册执行器" class="sidebar-link heading3">注册执行器</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#test-executor" class="sidebar-link heading3">Test Executor</a></li></ul></li></ul></li><li><a href="/guide/2.Advanced/1.Function%20Modules/8.Queue%20Module/" class="sidebar-link">Queue Module</a></li><li><a href="/guide/2.Advanced/1.Function%20Modules/9.RPC%20Module/" class="sidebar-link">RPC Module</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading clickable"><!----> <span class="title">System Usage</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">DAPP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Blockchain Browser</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Wallet</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">API Reference</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Case Introduction</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">Executor Module</span></h1> <div class="page-info"><!----> <!----><span aria-label="Writing Date📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2022-1-28</span></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#module-introduction" class="anchor-link heading2"><div>Module Introduction</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#executor-module-structure" class="anchor-link heading2"><div>Executor Module Structure</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#internal-logic-structure-of-the-executor" class="anchor-link heading2"><div>Internal logic structure of the executor</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#processing-logic" class="anchor-link heading2"><div>Processing Logic</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#transaction-check" class="anchor-link heading3"><div>Transaction Check</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#transaction-execution" class="anchor-link heading3"><div>Transaction Execution</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#query-history" class="anchor-link heading3"><div>Query History</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#add-new-block" class="anchor-link heading3"><div>Add New Block</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#block-rollback" class="anchor-link heading3"><div>Block Rollback</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#the-overall-processing-logic-of-the-executor" class="anchor-link heading3"><div>The overall processing logic of the executor</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#secondary-development" class="anchor-link heading2"><div>Secondary Development</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#overview-of-echo-executor" class="anchor-link heading3"><div>Overview of Echo Executor</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#transaction-check-2" class="anchor-link heading3"><div>Transaction Check</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#transaction-execution-2" class="anchor-link heading3"><div>Transaction Execution</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#add-new-block-2" class="anchor-link heading3"><div>Add New Block</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#block-rollback-2" class="anchor-link heading3"><div>Block Rollback</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#query-history-2" class="anchor-link heading3"><div>Query History</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#create-transaction-logic" class="anchor-link heading3"><div>Create Transaction Logic</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#注册执行器" class="anchor-link heading3"><div>注册执行器</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/#test-executor" class="anchor-link heading3"><div>Test Executor</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="executor-module"><a href="#executor-module" class="header-anchor">#</a> Executor Module</h1> <h2 id="module-introduction"><a href="#module-introduction" class="header-anchor">#</a> Module Introduction</h2> <p>As the name implies, an executor module is primarily used to execute logic. In the blockchain, all data are generated by transactions. These data are assembled into blocks according to certain rules, and finally form a complete blockchain.</p> <p>In a complete blockchain system, the execution of transactions is the core. For example, in transfer transaction from A to B, the balance of A account will be reduced, while the balance of B account will be increased. The logic of changing the balance of this account is the content to be executed by the executor.</p> <p>Take intelligent contract for example, all the logic contained in the contract is the logic to be executed by the executor.However, a contract is just a concrete logic, while an executor is a container that can execute several contracts without knowing the exact contents of the contract.</p> <p>Therefore, the executor module is a container, which supports the operation of various contracts (including system contracts and various extension contracts), receives the transactions, and assigns the transactions to the corresponding contracts for specific execution.</p> <h2 id="executor-module-structure"><a href="#executor-module-structure" class="header-anchor">#</a> Executor Module Structure</h2> <p><img src="/assets/img/Executor_template_interaction.f0d8c1bd.png" alt="Executor Module Structure"></p> <p>The external capability of the executor is reflected in 5 interfaces:</p> <p>Two read-only interfaces:</p> <ul><li><strong>Transaction Check</strong>: Check the validity of the transaction via EventCheckTx event, request is from the Mempool module.</li> <li><strong>Query Request</strong>: Query operation, query specified information from the transaction generated data. Specific query content is not fixed, depending on the query method called, the general request comes from Wallet/Client/Consensus module.</li></ul> <p>Three write interfaces:</p> <ul><li><strong>Transaction Execute</strong>: Triggered by EventExecTxList event, execute each transaction in the transaction list and return the execution result. The request comes from Blockchain module.</li> <li><strong>Block Adding</strong>: Through EventAddBlock event trigger, perform the post-processing operation of block write chain, generate some local data and return, the request comes from Blockchain module;</li> <li><strong>Block Rollback</strong>: Through EventDelBlock event trigger, perform the post-processing operation of block rollback in the chain, generate some local data and return, the request comes from Blockchain module.</li></ul> <h2 id="internal-logic-structure-of-the-executor"><a href="#internal-logic-structure-of-the-executor" class="header-anchor">#</a> Internal logic structure of the executor</h2> <p><img src="/assets/img/Executor_Architecture.78d5a673.png" alt="Internal logic structure of the executor"></p> <p>As shown in the figure above, the executor is a container framework that contains some generic scheduling logic, distributes requests to specific executor contracts for execution and collects the results back.</p> <p>Each concrete executor (in this case, the contract, which can be thought of as equivalent) implements several core methods in Driver, and the container calls a specific XXXExecutor to execute the logic based on the executor information attached to the transaction.</p> <p>Each specific executor is divided into two parts during implementation:</p> <ul><li><p><strong>Executor Object(XXXExecutor)</strong>：</p> <p>mplement Driver interface, inherit DriverBase base class;</p> <p>The main body of the executor, which contains the main execution logic of the executor. Generally, it is divided into several program files according to functions and execute corresponding logic respectively.</p></li> <li><p><strong>Executor Object Type(XXXType)</strong>：</p> <p>Implement ExecutorType interface, inherit ExecTypeBase base class;</p> <p>Some common capabilities related to the packaging executor type, such as method list, Payload structure, etc. The auxiliary executor framework completes the customized processing logic.</p></li></ul> <h2 id="processing-logic"><a href="#processing-logic" class="header-anchor">#</a> Processing Logic</h2> <blockquote><p>The five major capability interfaces implemented by the executor are described above, and the specific functions and implementation logic of each interface are described below.</p></blockquote> <h3 id="transaction-check"><a href="#transaction-check" class="header-anchor">#</a> Transaction Check</h3> <h4 id="interface-definition"><a href="#interface-definition" class="header-anchor">#</a> Interface Definition</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Driver <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">CheckTx</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>This interface contains two parameters:</p> <ul><li><code>tx *types.Transaction</code>: The object of this transaction, which contains all the information of the transaction.</li> <li><code>index int</code>: It is the index location of the transaction in the packaged block</li></ul> <blockquote><p><strong>Function realization</strong>: Check the business legitimacy of this transaction (the legitimacy of the transaction itself, such as signature verification, does not need to be checked, which has been filtered in the Mempool module). Only transactions that meet the requirements of this executor are allowed to execute, otherwise specific error information is returned.</p></blockquote> <h4 id="general-processing-logic"><a href="#general-processing-logic" class="header-anchor">#</a> General Processing Logic</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//By default, the tx.To address points to the contract address.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>d <span class="token operator">*</span>DriverBase<span class="token punctuation">)</span> <span class="token function">CheckTx</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    execer <span class="token operator">:=</span> <span class="token function">string</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Execer<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token function">ExecAddress</span><span class="token punctuation">(</span>execer<span class="token punctuation">)</span> <span class="token operator">!=</span> tx<span class="token punctuation">.</span>To <span class="token punctuation">{</span>
        <span class="token keyword">return</span> types<span class="token punctuation">.</span>ErrToAddrNotSameToExecAddr
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>In the DriverBase base class, only the most basic verification logic is implemented, which checks whether the target address of the transaction is the address of the local executor contract, where:</p> <ul><li><code>ExecAddress(execer)</code>：ExecAddress(execer) implement the ability to get the executor contract address from the executor name;</li> <li><code>tx.To</code>：x.To is the target address of this transaction.</li></ul> <h4 id="executor-implementation"><a href="#executor-implementation" class="header-anchor">#</a> Executor Implementation</h4> <p>When implementing specific executor transaction validation logic, you need to determine what content to check according to your own business scenarios, and try to ensure that all transactions through validation can be executed correctly.</p> <p>If only the target address needs to be checked, the executor may not implement this validation logic, and the system will automatically reuse the validation logic for DriverBase.</p> <p>If this executor does not need to verify any content of the transaction, then override this method and simply return null, as follows:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>x <span class="token operator">*</span>XXXExecutor<span class="token punctuation">)</span> <span class="token function">CheckTx</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token comment">// No validation logic needs to be executed</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>**caution : ** During the development of the executor, once a certain kind of validation rules are determined to be implemented, they cannot be arbitrarily changed otherwise the block chain may be forked. If changes are needed, the code needs to be forked to ensure consistency of block execution results.</p> <p>In secondary development, if there is validation logic, a separate check.go implementation is recommended.</p></blockquote> <h3 id="transaction-execution"><a href="#transaction-execution" class="header-anchor">#</a> Transaction Execution</h3> <h4 id="interface-definition-2"><a href="#interface-definition-2" class="header-anchor">#</a> Interface Definition</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Driver <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Exec</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Receipt<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>This interface also contains two parameters, which have the same meaning as the method parameters of transaction validation, except that the return value is different:</p> <ul><li><code>tx *types.Transaction</code>: The object of this transaction, which contains all the information of the transaction.</li> <li><code>index int</code>: The index location of the transaction in the packaged block.</li> <li><code>*types.Receipt</code>: Return value, you can see the message structure definition of Receipt, where ty is used to fill in the result types of this transaction execution, such as success and failure types; KV is used to fill in the results of the execution of this transaction, and logs is the receipt information generated by the execution of this transaction.</li></ul> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">message</span> <span class="token class-name">Receipt</span> <span class="token punctuation">{</span>
    <span class="token builtin">int32</span>    ty              <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">KeyValue</span> KV     <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">ReceiptLog</span> logs <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>**Function realization： ** Transaction execution core logic, executor contracts the main logic here, it will parse transaction object to carry information, then according to the rules, design the contract to perform the business logic of the different branches, the end result will be reflected in the data returned, and these data will be finished within blocks all transactions execution, written to block chain.</p></blockquote> <h4 id="general-processing-logic-2"><a href="#general-processing-logic-2" class="header-anchor">#</a> General Processing Logic</h4> <p>The general processing logic for the DriverBase class is more complex and is represented here as pseudo-code annotated.</p> <p>Where XXX represents a specific implementation of the executor, xxxType represents a specific executor type object.</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>d <span class="token operator">*</span>DriverBase<span class="token punctuation">)</span> <span class="token function">Exec</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>Receipt<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> xxxType <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Get the message structure of the concrete executor</span>
    <span class="token keyword">if</span> xxx<span class="token punctuation">.</span><span class="token function">GetPayloadValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Use type objects to resolve the contract-related request information carried in the transaction</span>
    actionName<span class="token punctuation">,</span> actionValue<span class="token punctuation">,</span> err <span class="token operator">=</span> xxxType<span class="token punctuation">.</span><span class="token function">DecodePayloadValue</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span>
    <span class="token comment">// The convention method name structure is fixed prefix + contract request action</span>
    funcName <span class="token operator">=</span> <span class="token string">&quot;Exec_&quot;</span> <span class="token operator">+</span> actionName
    <span class="token comment">// Get all the method object dictionaries implemented by this executor, in fact, the essence of the call is xxxType.GetExecFuncMap</span>
    funcMap <span class="token operator">=</span> xxx<span class="token punctuation">.</span><span class="token function">GetFuncMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// Locate to a concrete method object</span>
    funcObj <span class="token operator">=</span> funcMap<span class="token punctuation">[</span>funcName<span class="token punctuation">]</span>
    <span class="token comment">// Call this method object through reflection</span>
    funcObj<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token comment">// Get the result of the reflection call and returns</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>As can be seen from the pseudo-code logic above, in the DriverBase class, the implementation is a framework logic that delegates the resolution of the transaction carrier object to a specific executor type, assemble the method name according to the agreed rules, and finally invoke the specific execution method by reflection.</p> <p>Therefore, in general, developers do not need to implement this method when developing the executor, but only need to implement several related methods that the framework logic depends on.</p> <h4 id="executor-implementation-2"><a href="#executor-implementation-2" class="header-anchor">#</a> Executor Implementation</h4> <p>Based on the above analysis, there are several areas of transaction execution that need to be addressed by executor developers.</p> <ul><li>Executor type method:</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> ExecutorType <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token comment">// Parse the action name and action object from the transaction (the specific action information is known only by the concrete executor itself).</span>
    <span class="token function">DecodePayloadValue</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>Transaction<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> reflect<span class="token punctuation">.</span>Value<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
    <span class="token comment">// Get the method dictionary for this executor</span>
    <span class="token function">GetExecFuncMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Method
<span class="token punctuation">}</span>      
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>Executor type method:</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Driver <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get the Payload definition structure corresponding to this executor.</span>
    <span class="token comment">// The method is delegated to the ExecutorType.GetPayload().</span>
    <span class="token function">GetPayloadValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> types<span class="token punctuation">.</span>Message
    <span class="token comment">// Get the method dictionary available to this executor.</span>
    <span class="token comment">// The method is delegated to ExecutorType.GetExecFuncMap().</span>
    <span class="token function">GetFuncMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Method
<span class="token punctuation">}</span>   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>Signature of specific execution method:</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>XXX<span class="token punctuation">)</span> <span class="token function">Exec_Transfer</span><span class="token punctuation">(</span>transfer <span class="token operator">*</span>types<span class="token punctuation">.</span>XXXAction<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Receipt<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>**caution: ** In the real executor development, when implementing the transaction logic, there is no need to implement the Exec method of the base class, only need to implement several peripheral dependent methods according to the above rules;
And according to your own contract logic to implement several Exec_XXX methods (method signature as above). Specific implementation, in the secondary development section will be described in detail.</p></blockquote> <blockquote><p>For secondary development, the transaction execution logic is better placed in a separate exec.go file.</p></blockquote> <h3 id="query-history"><a href="#query-history" class="header-anchor">#</a> Query History</h3> <h4 id="interface-definition-3"><a href="#interface-definition-3" class="header-anchor">#</a> Interface Definition</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Driver <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Query</span><span class="token punctuation">(</span>funcName <span class="token builtin">string</span><span class="token punctuation">,</span> params <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>types<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>This interface contains two parameters:</p> <ul><li><code>funcName string</code>: The specific method name of this query reques. The system will automatically route this request to the corresponding method implementation.</li> <li><code>params []byte</code>: The specific parameter information of this query. The value received here is the serialized value. The query framework will deserialize and then call the specific query method.</li></ul> <blockquote><p>**Function realization: ** Implementation of any query operation (provided that the corresponding method exists), because it is a read-only query operation, not in the form of transactions, does not affect the block data, will not be wrote into block chain.</p></blockquote> <h4 id="general-processing-logic-3"><a href="#general-processing-logic-3" class="header-anchor">#</a> General Processing Logic</h4> <p>This logic implementation code, the following is in the form of pseudo-code. xxx represents the specific implementation of the executor.</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>d <span class="token operator">*</span>DriverBase<span class="token punctuation">)</span> <span class="token function">Query</span><span class="token punctuation">(</span>funcname <span class="token builtin">string</span><span class="token punctuation">,</span> params <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>msg types<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get all the method object dictionaries implemented by this executor, in fact, the essence of the call is xxxType.GetExecFuncMap</span>
    funcMap <span class="token operator">=</span> xxx<span class="token punctuation">.</span><span class="token function">GetFuncMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// The convention method name structure is fixed prefix + request method name</span>
    funcname <span class="token operator">=</span> <span class="token string">&quot;Query_&quot;</span> <span class="token operator">+</span> funcname
    <span class="token comment">// Locate to a concrete method object</span>
    funcObj <span class="token operator">=</span> funcMap<span class="token punctuation">[</span>funcName<span class="token punctuation">]</span>
    <span class="token comment">// Get the query method parameter type by funcObj and deserialize the params</span>
    <span class="token comment">// Invoke method objects by reflection</span>
    funcObj<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token comment">// Get the result of the reflection call and returns    </span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Similar to the logic used to execute transactions, a set of framework logic is implemented in the DriverBase class, which points to a specific method object by method name and then reverse-serializes the incoming params parameters with the parameter type information defined in the method type. Finally, reflection is used to invoke the specific query method logic and return the result.</p> <p>Therefore, in general, developers do not need to implement this method when developing the executor, but only need to implement several related methods that the framework logic depends on.</p> <h4 id="executor-implementation-3"><a href="#executor-implementation-3" class="header-anchor">#</a> Executor Implementation</h4> <p>Based on the analysis above, there are several query related areas that concrete executor developers need to focus on.</p> <ul><li>Executor type method:</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> ExecutorType <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get the method dictionary for this executor</span>
    <span class="token function">GetExecFuncMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Method
<span class="token punctuation">}</span>       
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>Executor object method:</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Driver <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get the method dictionary available to this executor</span>
    <span class="token comment">// This method is also entrusted to ExecutorType.GetExecFuncMap () method of execution</span>
    <span class="token function">GetFuncMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Method
<span class="token punctuation">}</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>Signature of specific query method:</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>XXX<span class="token punctuation">)</span> <span class="token function">Query_XxxYyyZzz</span><span class="token punctuation">(</span>in <span class="token operator">*</span>types<span class="token punctuation">.</span>XXXReq<span class="token punctuation">)</span> <span class="token punctuation">(</span>types<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>**caution: ** In real executor development, there is no need to implement the Query method of the base class when implementing the Query logic. Just implement a few peripheral dependency methods according to the rules above;
And implement several Query_XXX methods based on your contract logic. Specific implementation, in the secondary development section will be described in detail.</p> <p>For secondary development, it is suggest that the query logic be placed in a single query.go file.</p></blockquote> <h3 id="add-new-block"><a href="#add-new-block" class="header-anchor">#</a> Add New Block</h3> <h4 id="interface-definition-4"><a href="#interface-definition-4" class="header-anchor">#</a> Interface Definition</h4> <p>After all the transactions within a block have been executed, the block will be packaged into the chain. Before that, the logic of the new block will be triggered. The system will traverse all the transactions within the block and call the corresponding ExecLocal logic one by one.</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Driver <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">ExecLocal</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>This interface contains three parameters:</p> <ul><li><code>x *types.Transaction</code>: The object of this transaction, which contains all the information of the transaction</li> <li><code>receipt *types.ReceiptData</code>: The result information generated during the execution of this transaction, and its structure is defined as follows:</li></ul> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">message</span> <span class="token class-name">ReceiptData</span> <span class="token punctuation">{</span>
    <span class="token builtin">int32</span>    ty              <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">ReceiptLog</span> logs <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>index int</code>: The index position of this transaction in this packaged block.</li></ul> <blockquote><p>**Function realization: ** Add your own logic based on the result information generated by the transaction execution, and generate some new data to assist the contract logic.These data can be considered as local data, not linked (but generated by each block node), generally used to do multiple indexes, save intermediate data, etc., depending on the contract logic.</p></blockquote> <h4 id="general-process-logic"><a href="#general-process-logic" class="header-anchor">#</a> General Process Logic</h4> <p>The general processing logic for the DriverBase class is relatively complex, which represented here as pseudo-code annotated. Where XXX represents a specific implementation of the executor, xxxType represents a specific executor type object.</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>d <span class="token operator">*</span>DriverBase<span class="token punctuation">)</span> <span class="token function">ExecLocal</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Use type objects to resolve the contract-related request information carried in the transaction</span>
    actionName<span class="token punctuation">,</span> actionValue<span class="token punctuation">,</span> err <span class="token operator">=</span> xxxType<span class="token punctuation">.</span><span class="token function">DecodePayloadValue</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span>
    <span class="token comment">// The convention method name structure is fixed prefix + request method name</span>
    funcName <span class="token operator">=</span> <span class="token string">&quot;ExecLocal_&quot;</span> <span class="token operator">+</span> actionName
    <span class="token comment">// Get all the method object dictionaries implemented by this executor, in fact, the essence of the call is xxxType.GetExecFuncMap</span>
    funcMap <span class="token operator">=</span> xxx<span class="token punctuation">.</span><span class="token function">GetFuncMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// Locate to a concrete method object</span>
    funcObj <span class="token operator">=</span> funcMap<span class="token punctuation">[</span>funcName<span class="token punctuation">]</span>
    <span class="token comment">// Call this method object by reflection</span>
    funcObj<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token comment">// Get the result of the reflection call and return </span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>The main framework logic is basically similar to the previous trade execution, and the relevant methods used have been described before. The only difference is the method prefix, which is &quot;ExecLocal_&quot; here.</p> <p>Similarly, in general, developers do not need to implement this method when developing the executor, but only need to implement several related methods that the framework logic depends on.</p> <h4 id="executor-implementation-4"><a href="#executor-implementation-4" class="header-anchor">#</a> Executor implementation</h4> <p>Specific executor method and executor type method are same as the above that this operation involved, only the method signatures for ExecLocal_XXX are listed here.</p> <ul><li>Signature of specific query method:</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>XXX<span class="token punctuation">)</span> <span class="token function">ExecLocal_XYZ</span><span class="token punctuation">(</span>action <span class="token operator">*</span>types<span class="token punctuation">.</span>XXXyz<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>**caution: ** In real executor development, when implementing this logic, only several ExecLocal_XXX methods need to be implemented according to their own contract logic. Specific implementation, will be described in detail in the secondary development section.</p> <p>or secondary development, this logic is recommended to be placed in a separate exec_local.go file.</p></blockquote> <h3 id="block-rollback"><a href="#block-rollback" class="header-anchor">#</a> Block Rollback</h3> <h4 id="interface-definition-5"><a href="#interface-definition-5" class="header-anchor">#</a> Interface Definition</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Driver <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">ExecDelLocal</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>This interface is as same as the new block, so the method definition is not described in detail here.</p> <blockquote><p>**Function realization: ** This logic and the new block just the opposite, this can be anti-operation, new block in the new data need to be deleted here; new block replaces the old value with the new value. Restore the data to its original state.</p></blockquote> <h4 id="general-process-logic-2"><a href="#general-process-logic-2" class="header-anchor">#</a> General process logic</h4> <p>The logic is the same as the new block, the only difference is the method prefix is different, here the method prefix is &quot;ExecDelLocal_&quot;.</p> <h4 id="executor-implementation-5"><a href="#executor-implementation-5" class="header-anchor">#</a> Executor implementation</h4> <p>Specific executor method and executor type method are same as the above that this operation involved, only the method signatures for ExecDelLocal_XXX are listed here.</p> <ul><li>Signature of specific query method:</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>XXX<span class="token punctuation">)</span> <span class="token function">ExecDelLocal_XYZ</span><span class="token punctuation">(</span>action <span class="token operator">*</span>types<span class="token punctuation">.</span>XXXyz<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>**caution: ** In real executor development, when implementing this logic, only several ExecLocal_XXX methods need to be implemented according to your own contract logic. Specific implementation will be described in detail in the secondary development section.</p> <p>For secondary development, this logic is recommended to be placed in a separate exec_del_local.go file.</p></blockquote> <h3 id="the-overall-processing-logic-of-the-executor"><a href="#the-overall-processing-logic-of-the-executor" class="header-anchor">#</a> The overall processing logic of the executor</h3> <p><img src="/assets/img/excutor_framework.50302c08.png" alt="excutor-call-back-framework"></p> <h2 id="secondary-development"><a href="#secondary-development" class="header-anchor">#</a> Secondary Development</h2> <p>This section will introduce the secondary development process of the executor with a simple example. The example implements a relatively simple function, but contains all the methods needed to implement an executor.</p> <h3 id="overview-of-echo-executor"><a href="#overview-of-echo-executor" class="header-anchor">#</a> Overview of Echo Executor</h3> <p>This executor implements a simple message corresponding function and supports two kinds of operations, Ping and Pang. When the transaction is executed, response data will be written to the block chain. When the local execution is executed, the times of the same message called will be recorded.</p> <p>The executor directory structure is as follows:</p> <p><img src="/assets/img/excutor_Catalog.19a58fd3.png" alt="Overview of Echo Executor"></p> <p>Three of these directories’s functions are as follows:</p> <ul><li><p>executor</p> <p>The logical theme of the executor, including the transaction validation of the executor, transaction execution, block addition, block rollback, and the historical query of the logical body.</p></li> <li><p>proto</p> <p>The message structure definition used in this executor, the Protobuf format.</p></li> <li><p>types</p> <p>The executor type object definition, and the Protobuf-generated message structure definition.</p></li></ul> <h4 id="architectural-definition"><a href="#architectural-definition" class="header-anchor">#</a> Architectural Definition</h4> <p>The message structures used in the executor are uniformly defined using the protobuf format. The structures used by the executor are used as follows:</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">syntax</span> <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">package</span> types<span class="token punctuation">;</span>
<span class="token comment">// Ping operation action</span>
<span class="token keyword">message</span> <span class="token class-name">Ping</span> <span class="token punctuation">{</span>
    <span class="token builtin">string</span> msg     <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Pang operation action</span>
<span class="token keyword">message</span> <span class="token class-name">Pang</span> <span class="token punctuation">{</span>
    <span class="token builtin">string</span> msg     <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Uniform Action structure of this executor</span>
<span class="token keyword">message</span> <span class="token class-name">EchoAction</span> <span class="token punctuation">{</span>
    <span class="token keyword">oneof</span> value <span class="token punctuation">{</span>
        <span class="token positional-class-name class-name">Ping</span>       ping       <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token positional-class-name class-name">Pang</span>       pang       <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token builtin">int32</span> ty <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Log structure generated by Ping operation </span>
<span class="token keyword">message</span> <span class="token class-name">PingLog</span> <span class="token punctuation">{</span>
    <span class="token builtin">string</span> msg     <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token builtin">string</span> echo    <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token builtin">int32</span>  count    <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Log structure generated by Pang operation </span>
<span class="token keyword">message</span> <span class="token class-name">PangLog</span> <span class="token punctuation">{</span>
    <span class="token builtin">string</span> msg     <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token builtin">string</span> echo    <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token builtin">int32</span>  count    <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Query request structure</span>
<span class="token keyword">message</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span>
    <span class="token builtin">string</span> msg     <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Query result structure</span>
<span class="token keyword">message</span> <span class="token class-name">QueryResult</span> <span class="token punctuation">{</span>
    <span class="token builtin">string</span> msg     <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token builtin">int32</span>  count   <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>Create_protobuf.sh in the same directory uses this file to generate the Go program and put it in the Types directory.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>//<span class="token operator">!</span>/bin/sh
protoc --go_out<span class="token operator">=</span>plugins<span class="token operator">=</span>grpc:<span class="token punctuation">..</span>/types ./*.proto --proto_path<span class="token operator">=</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>####Executor Type and Executor Object</p> <p>The executor type is used to define some information about the type. This example is implemented as follows:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> types
<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;github.com/33cn/chain33/types&quot;</span>
    log <span class="token string">&quot;github.com/33cn/chain33/common/log/log15&quot;</span>
    <span class="token string">&quot;reflect&quot;</span>
<span class="token punctuation">)</span>
<span class="token comment">// Define the type of Actions supported by this executor</span>
<span class="token keyword">const</span> <span class="token punctuation">(</span>
    ActionPing <span class="token operator">=</span> <span class="token boolean">iota</span>
    ActionPang
<span class="token punctuation">)</span>
<span class="token comment">// Define the log type generated by this executor</span>
<span class="token keyword">const</span> <span class="token punctuation">(</span>
    TyLogPing <span class="token operator">=</span> <span class="token number">100001</span>
    TyLogPang <span class="token operator">=</span> <span class="token number">100002</span>
<span class="token punctuation">)</span>
<span class="token keyword">var</span> <span class="token punctuation">(</span>
    <span class="token comment">// Name of this executor</span>
    EchoX <span class="token operator">=</span> <span class="token string">&quot;echo&quot;</span>
    <span class="token comment">// Define the Action correspondence supported by this executor</span>
    actionName <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int32</span><span class="token punctuation">{</span>
        <span class="token string">&quot;Ping&quot;</span><span class="token punctuation">:</span> ActionPing<span class="token punctuation">,</span>
        <span class="token string">&quot;Pang&quot;</span><span class="token punctuation">:</span> ActionPang<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Define the Log receipt parsing structure of this executor</span>
    logInfo <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int64</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LogInfo<span class="token punctuation">{</span>
        TyLogPing<span class="token punctuation">:</span> <span class="token punctuation">{</span>reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>PingLog<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;PingLog&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        TyLogPang<span class="token punctuation">:</span> <span class="token punctuation">{</span>reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>PangLog<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;PangLog&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token keyword">var</span> elog <span class="token operator">=</span> log<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span> EchoX<span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Adds this executor to the system whitelist</span>
    types<span class="token punctuation">.</span>AllowUserExec <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span>AllowUserExec<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>EchoX<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// Register this executor type with the system</span>
    types<span class="token punctuation">.</span><span class="token function">RegistorExecutor</span><span class="token punctuation">(</span>EchoX<span class="token punctuation">,</span> <span class="token function">NewType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// Define type of this executor</span>
<span class="token keyword">type</span> EchoType <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    types<span class="token punctuation">.</span>ExecTypeBase
<span class="token punctuation">}</span>
<span class="token comment">// Initialize type of this executor</span>
<span class="token keyword">func</span> <span class="token function">NewType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>EchoType <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> <span class="token operator">&amp;</span>EchoType<span class="token punctuation">{</span><span class="token punctuation">}</span>
    c<span class="token punctuation">.</span><span class="token function">SetChild</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    <span class="token keyword">return</span> c
<span class="token punctuation">}</span>
<span class="token comment">// Return the load type of this executor</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>EchoType<span class="token punctuation">)</span> <span class="token function">GetPayload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> types<span class="token punctuation">.</span>Message <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>EchoAction<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Return the name of this executor</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>EchoType<span class="token punctuation">)</span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> EchoX
<span class="token punctuation">}</span>
<span class="token comment">// Return the action dictionary in this executor, which supports two-way lookups</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>EchoType<span class="token punctuation">)</span> <span class="token function">GetTypeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int32</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> actionName
<span class="token punctuation">}</span>
<span class="token comment">// Return log type information of this executor for RPC parsing log data</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>EchoType<span class="token punctuation">)</span> <span class="token function">GetLogMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int64</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LogInfo <span class="token punctuation">{</span>
    <span class="token keyword">return</span> logInfo
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><blockquote><p>The executor object defines the main logic of the executor</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> executor
<span class="token keyword">import</span> <span class="token punctuation">(</span>
    echotypes <span class="token string">&quot;github.com/33cn/plugin/plugin/dapp/echo/types&quot;</span>
    <span class="token string">&quot;github.com/33cn/chain33/system/dapp&quot;</span>
    <span class="token string">&quot;github.com/33cn/chain33/types&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">var</span> <span class="token punctuation">(</span>
    <span class="token comment">// Data KEY generated by the transaction execution</span>
    KeyPrefixPing <span class="token operator">=</span> <span class="token string">&quot;mavl-echo-ping:%s&quot;</span>
    KeyPrefixPang <span class="token operator">=</span> <span class="token string">&quot;mavl-echo-pang:%s&quot;</span>
    <span class="token comment">// Data KEY generated by locally execution KEY</span>
    KeyPrefixPingLocal <span class="token operator">=</span> <span class="token string">&quot;LODB-echo-ping:%s&quot;</span>
    KeyPrefixPangLocal <span class="token operator">=</span> <span class="token string">&quot;LODB-echo-pang:%s&quot;</span>
<span class="token punctuation">)</span>
<span class="token comment">// Get the list of methods for this executor at initialization by reflection</span>
<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ety <span class="token operator">:=</span> types<span class="token punctuation">.</span><span class="token function">LoadExecutorType</span><span class="token punctuation">(</span>echotypes<span class="token punctuation">.</span>EchoX<span class="token punctuation">)</span>
    ety<span class="token punctuation">.</span><span class="token function">InitFuncList</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">ListMethod</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Echo<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//Initializing action of this executor, register this executor to the system, here the effective height is temporarily written as 0</span>
<span class="token keyword">func</span> <span class="token function">Init</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">,</span> sub <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dapp<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>echotypes<span class="token punctuation">.</span>EchoX<span class="token punctuation">,</span> newEcho<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// Define the executor object</span>
<span class="token keyword">type</span> Echo <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    dapp<span class="token punctuation">.</span>DriverBase
<span class="token punctuation">}</span>
<span class="token comment">// The executor object initializes the wrapper logic, and the next two steps are necessary to set the child object and executor type</span>
<span class="token keyword">func</span> <span class="token function">newEcho</span><span class="token punctuation">(</span><span class="token punctuation">)</span> dapp<span class="token punctuation">.</span>Driver <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> <span class="token operator">&amp;</span>Echo<span class="token punctuation">{</span><span class="token punctuation">}</span>
    c<span class="token punctuation">.</span><span class="token function">SetChild</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    c<span class="token punctuation">.</span><span class="token function">SetExecutorType</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">LoadExecutorType</span><span class="token punctuation">(</span>echotypes<span class="token punctuation">.</span>EchoX<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> c
<span class="token punctuation">}</span>
<span class="token comment">// Returns the name of the executor driver</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">GetDriverName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> echotypes<span class="token punctuation">.</span>EchoX
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>As can be seen, the implementation logic of this executor object is basically code related to initialization, without real processing logic. These logic is distributed to various specific program files for implementation, which will be described in detail below.</p> <h3 id="transaction-check-2"><a href="#transaction-check-2" class="header-anchor">#</a> Transaction Check</h3> <blockquote><p>executor/check.go</p> <p>This executor does not perform any check on transactions. The implementation logic is as follows:</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> executor
<span class="token keyword">import</span> <span class="token string">&quot;github.com/33cn/chain33/types&quot;</span>
<span class="token comment">// This executor does not perform any checks.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">CheckTx</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="transaction-execution-2"><a href="#transaction-execution-2" class="header-anchor">#</a> Transaction Execution</h3> <blockquote><p>executor/exec.go</p> <p>Execute the corresponding contract logic based on the information carried in the transaction. The implementation logic is as follows:</p> <p>Exec_Ping, for example, receives the transaction that carries the ping operation, and the first parameter ping is the message Ping structure that we define in protobuf file. The logic implemented in this contract method is to generate the corresponding response message according to the ping message in the transaction. If the passed ping msg is “hello”, the generated response message is “hello, ping ping ping!”., and the corresponding message will be written to the block data with “mavl-echo-ping:hello” as the KEY, and generate the corresponding PingLog to write into the transaction receipt;</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> executor
<span class="token keyword">import</span> <span class="token punctuation">(</span>
	echotypes <span class="token string">&quot;github.com/33cn/plugin/plugin/dapp/echo/types&quot;</span>
	<span class="token string">&quot;github.com/33cn/chain33/types&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">Exec_Ping</span><span class="token punctuation">(</span>ping <span class="token operator">*</span>echotypes<span class="token punctuation">.</span>Ping<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Receipt<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	msg <span class="token operator">:=</span> ping<span class="token punctuation">.</span>Msg
	res <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%s, ping ping ping!&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
	xx <span class="token operator">:=</span> <span class="token operator">&amp;</span>echotypes<span class="token punctuation">.</span>PingLog<span class="token punctuation">{</span>Msg<span class="token punctuation">:</span>msg<span class="token punctuation">,</span> Echo<span class="token punctuation">:</span>res<span class="token punctuation">}</span>
	logs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptLog<span class="token punctuation">{</span><span class="token punctuation">{</span>echotypes<span class="token punctuation">.</span>TyLogPing<span class="token punctuation">,</span> types<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>xx<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	kv <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>KeyValue<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>KeyPrefixPing<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	receipt <span class="token operator">:=</span> <span class="token operator">&amp;</span>types<span class="token punctuation">.</span>Receipt<span class="token punctuation">{</span>types<span class="token punctuation">.</span>ExecOk<span class="token punctuation">,</span> kv<span class="token punctuation">,</span> logs<span class="token punctuation">}</span>
	<span class="token keyword">return</span> receipt<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">Exec_Pang</span><span class="token punctuation">(</span>ping <span class="token operator">*</span>echotypes<span class="token punctuation">.</span>Pang<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Receipt<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	msg <span class="token operator">:=</span> ping<span class="token punctuation">.</span>Msg
	res <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%s, pang pang pang!&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
	xx <span class="token operator">:=</span> <span class="token operator">&amp;</span>echotypes<span class="token punctuation">.</span>PangLog<span class="token punctuation">{</span>Msg<span class="token punctuation">:</span>msg<span class="token punctuation">,</span> Echo<span class="token punctuation">:</span>res<span class="token punctuation">}</span>
	logs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptLog<span class="token punctuation">{</span><span class="token punctuation">{</span>echotypes<span class="token punctuation">.</span>TyLogPang<span class="token punctuation">,</span> types<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>xx<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	kv <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>KeyValue<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>KeyPrefixPang<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	receipt <span class="token operator">:=</span> <span class="token operator">&amp;</span>types<span class="token punctuation">.</span>Receipt<span class="token punctuation">{</span>types<span class="token punctuation">.</span>ExecOk<span class="token punctuation">,</span> kv<span class="token punctuation">,</span> logs<span class="token punctuation">}</span>
	<span class="token keyword">return</span> receipt<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="add-new-block-2"><a href="#add-new-block-2" class="header-anchor">#</a> Add New Block</h3> <blockquote><p>executor/exec_local.go</p> <p>According to the receipt information generated by transaction execution, the corresponding local additional logic is executed. The implementation logic is as follows:</p> <p>Take ExecLocal_Ping for example, which gets msg information (again, in the case of hello) based on the PingLog generated by the ping transaction, then assemble it into a fixed KEY “LODB-echo-ping:hello”，, and then read the KEY data from LocalDB, and increment the number of times the message is called by 1, and finally return the new KV information; the system will write the new KV in LocalDB;</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> executor
<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    echotypes <span class="token string">&quot;github.com/33cn/plugin/plugin/dapp/echo/types&quot;</span>
    <span class="token string">&quot;github.com/33cn/chain33/types&quot;</span>
<span class="token punctuation">)</span>
<span class="token comment">// Transaction executed successfully, increment the value corresponding to this message by 1</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">ExecLocal_Ping</span><span class="token punctuation">(</span>ping <span class="token operator">*</span>echotypes<span class="token punctuation">.</span>Ping<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// This simplifies the process and does not do the basic zero value or error checking</span>
    <span class="token keyword">var</span> pingLog echotypes<span class="token punctuation">.</span>PingLog
    types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>receipt<span class="token punctuation">.</span>Logs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Log<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pingLog<span class="token punctuation">)</span>
    localKey <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>KeyPrefixPingLocal<span class="token punctuation">,</span> pingLog<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    oldValue<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">GetLocalDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>localKey<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> err <span class="token operator">!=</span> types<span class="token punctuation">.</span>ErrNotFound <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>oldValue<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pingLog<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    pingLog<span class="token punctuation">.</span>Count <span class="token operator">+=</span> <span class="token number">1</span>
    kv <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>KeyValue<span class="token punctuation">{</span><span class="token punctuation">{</span>localKey<span class="token punctuation">,</span> types<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pingLog<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">{</span>kv<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
<span class="token comment">// </span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">ExecLocal_Pang</span><span class="token punctuation">(</span>ping <span class="token operator">*</span>echotypes<span class="token punctuation">.</span>Pang<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// This simplifies the process and does not do the basic zero value or error checking</span>
    <span class="token keyword">var</span> pangLog echotypes<span class="token punctuation">.</span>PangLog
    types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>receipt<span class="token punctuation">.</span>Logs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Log<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pangLog<span class="token punctuation">)</span>
    localKey <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>KeyPrefixPangLocal<span class="token punctuation">,</span> pangLog<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    oldValue<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">GetLocalDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>localKey<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> err <span class="token operator">!=</span> types<span class="token punctuation">.</span>ErrNotFound <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>oldValue<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pangLog<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    pangLog<span class="token punctuation">.</span>Count <span class="token operator">+=</span> <span class="token number">1</span>
    kv <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>KeyValue<span class="token punctuation">{</span><span class="token punctuation">{</span>localKey<span class="token punctuation">,</span> types<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pangLog<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">{</span>kv<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="block-rollback-2"><a href="#block-rollback-2" class="header-anchor">#</a> Block Rollback</h3> <blockquote><p>executor/exec_del_local.go</p> <p>According to the receipt information generated by transaction execution, the corresponding local additional logic is executed. The implementation logic is as follows:</p> <p>Take ExecLocal_Ping as an example, in contrast to the new block logic above, it will subtract 1 from the call count of the message. If reduced to 0, the data will be deleted.</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> executor
<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    echotypes <span class="token string">&quot;github.com/33cn/plugin/plugin/dapp/echo/types&quot;</span>
    <span class="token string">&quot;github.com/33cn/chain33/types&quot;</span>
<span class="token punctuation">)</span>
<span class="token comment">// Transaction executed successfully, subtract 1 from the value corresponding to this message</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">ExecDelLocal_Ping</span><span class="token punctuation">(</span>ping <span class="token operator">*</span>echotypes<span class="token punctuation">.</span>Ping<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// This simplifies the process and does not do the basic zero value or error checking</span>
    <span class="token keyword">var</span> pingLog echotypes<span class="token punctuation">.</span>PingLog
    types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>receipt<span class="token punctuation">.</span>Logs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Log<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pingLog<span class="token punctuation">)</span>
    localKey <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>KeyPrefixPingLocal<span class="token punctuation">,</span> pingLog<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    oldValue<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">GetLocalDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>localKey<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
    types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>oldValue<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pingLog<span class="token punctuation">)</span>
    <span class="token keyword">if</span> pingLog<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        pingLog<span class="token punctuation">.</span>Count <span class="token operator">-=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
    val <span class="token operator">:=</span> types<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pingLog<span class="token punctuation">)</span>
    <span class="token keyword">if</span> pingLog<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        val <span class="token operator">=</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
    kv <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>KeyValue<span class="token punctuation">{</span><span class="token punctuation">{</span>localKey<span class="token punctuation">,</span> val<span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">{</span>kv<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
<span class="token comment">// Transaction executed successfully, subtract 1 from the value corresponding to this message</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">ExecDelLocal_Pang</span><span class="token punctuation">(</span>ping <span class="token operator">*</span>echotypes<span class="token punctuation">.</span>Pang<span class="token punctuation">,</span> tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// This simplifies the process and does not do the basic zero value or error checking</span>
    <span class="token keyword">var</span> pangLog echotypes<span class="token punctuation">.</span>PangLog
    types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>receipt<span class="token punctuation">.</span>Logs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Log<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pangLog<span class="token punctuation">)</span>
    localKey <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>KeyPrefixPangLocal<span class="token punctuation">,</span> pangLog<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    oldValue<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">GetLocalDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>localKey<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
    types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>oldValue<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pangLog<span class="token punctuation">)</span>
    <span class="token keyword">if</span> pangLog<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        pangLog<span class="token punctuation">.</span>Count <span class="token operator">-=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
    val <span class="token operator">:=</span> types<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pangLog<span class="token punctuation">)</span>
    <span class="token keyword">if</span> pangLog<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        val <span class="token operator">=</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
    kv <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>types<span class="token punctuation">.</span>KeyValue<span class="token punctuation">{</span><span class="token punctuation">{</span>localKey<span class="token punctuation">,</span> val<span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">{</span>kv<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="query-history-2"><a href="#query-history-2" class="header-anchor">#</a> Query History</h3> <blockquote><p>executor/query.go</p> <p>To query the data generated by the transaction, this contract implements two query methods, ping operation and pang operation respectively. For the number of calls of a certain msg, the implementation logic is as follows:</p> <p>Take Query_Ping as an example, according to the incoming msg of query request, use the same rule to assemble the KEY, and then query the data written when adding new block from LocalDB, and then return the call times information of this message.</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> executor
<span class="token keyword">import</span> <span class="token punctuation">(</span>
	echotypes <span class="token string">&quot;github.com/33cn/plugin/plugin/dapp/echo/types&quot;</span>
	<span class="token string">&quot;github.com/33cn/chain33/types&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">Query_GetPing</span><span class="token punctuation">(</span>in <span class="token operator">*</span>echotypes<span class="token punctuation">.</span>Query<span class="token punctuation">)</span> <span class="token punctuation">(</span>types<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> pingLog echotypes<span class="token punctuation">.</span>PingLog
	localKey <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>KeyPrefixPingLocal<span class="token punctuation">,</span> in<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
	value<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">GetLocalDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>localKey<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pingLog<span class="token punctuation">)</span>
	res <span class="token operator">:=</span> echotypes<span class="token punctuation">.</span>QueryResult<span class="token punctuation">{</span>Msg<span class="token punctuation">:</span>in<span class="token punctuation">.</span>Msg<span class="token punctuation">,</span> Count<span class="token punctuation">:</span>pingLog<span class="token punctuation">.</span>Count<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>res<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Echo<span class="token punctuation">)</span> <span class="token function">Query_GetPang</span><span class="token punctuation">(</span>in <span class="token operator">*</span>echotypes<span class="token punctuation">.</span>Query<span class="token punctuation">)</span> <span class="token punctuation">(</span>types<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> pangLog echotypes<span class="token punctuation">.</span>PangLog
	localKey <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>KeyPrefixPangLocal<span class="token punctuation">,</span> in<span class="token punctuation">.</span>Msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
	value<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">GetLocalDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>localKey<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	types<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pangLog<span class="token punctuation">)</span>
	res <span class="token operator">:=</span> echotypes<span class="token punctuation">.</span>QueryResult<span class="token punctuation">{</span>Msg<span class="token punctuation">:</span>in<span class="token punctuation">.</span>Msg<span class="token punctuation">,</span> Count<span class="token punctuation">:</span> pangLog<span class="token punctuation">.</span>Count<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>res<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="create-transaction-logic"><a href="#create-transaction-logic" class="header-anchor">#</a> Create Transaction Logic</h3> <blockquote><p>types/echo.go</p> <p>Most of the logic of the executor has been implemented, but if you want to call this executor on the blockchain, you need to create the transaction related to this executor contract. The logic of creating the transaction is implemented in the executor type object.</p> <p>The CreateTx interface method needs to be implemented, for example:</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> types
<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;encoding/json&quot;</span>
    <span class="token string">&quot;math/rand&quot;</span>
    <span class="token string">&quot;strings&quot;</span>
    <span class="token string">&quot;time&quot;</span>
    <span class="token string">&quot;github.com/33cn/chain33/types&quot;</span>
    <span class="token string">&quot;github.com/33cn/chain33/common/address&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>e EchoType<span class="token punctuation">)</span> <span class="token function">CreateTx</span><span class="token punctuation">(</span>action <span class="token builtin">string</span><span class="token punctuation">,</span> message json<span class="token punctuation">.</span>RawMessage<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    elog<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token string">&quot;echo.CreateTx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;action&quot;</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span>
    <span class="token comment">// Only ping/pang two transaction operations are accepted</span>
    <span class="token keyword">if</span> action <span class="token operator">==</span> <span class="token string">&quot;ping&quot;</span> <span class="token operator">||</span> action <span class="token operator">==</span> <span class="token string">&quot;pang&quot;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> param EchoTx
        err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token operator">&amp;</span>param<span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            elog<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;CreateTx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Error&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> types<span class="token punctuation">.</span>ErrInvalidParam
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">createPingTx</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> <span class="token operator">&amp;</span>param<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> types<span class="token punctuation">.</span>ErrNotSupport
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">createPingTx</span><span class="token punctuation">(</span>op <span class="token builtin">string</span><span class="token punctuation">,</span> parm <span class="token operator">*</span>EchoTx<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> action <span class="token operator">*</span>EchoAction
    <span class="token keyword">var</span> err <span class="token builtin">error</span>
    <span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">EqualFold</span><span class="token punctuation">(</span>op<span class="token punctuation">,</span> <span class="token string">&quot;ping&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        action<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">getPingAction</span><span class="token punctuation">(</span>parm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        action<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">getPangAction</span><span class="token punctuation">(</span>parm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
    tx <span class="token operator">:=</span> <span class="token operator">&amp;</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">{</span>
        Execer<span class="token punctuation">:</span>  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">ExecName</span><span class="token punctuation">(</span>EchoX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Payload<span class="token punctuation">:</span> types<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">,</span>
        Nonce<span class="token punctuation">:</span>   rand<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">NewSource</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Int63</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        To<span class="token punctuation">:</span>      address<span class="token punctuation">.</span><span class="token function">ExecAddress</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">ExecName</span><span class="token punctuation">(</span>EchoX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> tx<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">getPingAction</span><span class="token punctuation">(</span>parm <span class="token operator">*</span>EchoTx<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>EchoAction<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pingAction <span class="token operator">:=</span> <span class="token operator">&amp;</span>Ping<span class="token punctuation">{</span>Msg<span class="token punctuation">:</span> parm<span class="token punctuation">.</span>Message<span class="token punctuation">}</span>
    action <span class="token operator">:=</span> <span class="token operator">&amp;</span>EchoAction<span class="token punctuation">{</span>
        Value<span class="token punctuation">:</span> <span class="token operator">&amp;</span>EchoAction_Ping<span class="token punctuation">{</span>Ping<span class="token punctuation">:</span> pingAction<span class="token punctuation">}</span><span class="token punctuation">,</span>
        Ty<span class="token punctuation">:</span>    ActionPing<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> action<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">getPangAction</span><span class="token punctuation">(</span>parm <span class="token operator">*</span>EchoTx<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>EchoAction<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pangAction <span class="token operator">:=</span> <span class="token operator">&amp;</span>Pang<span class="token punctuation">{</span>Msg<span class="token punctuation">:</span> parm<span class="token punctuation">.</span>Message<span class="token punctuation">}</span>
    action <span class="token operator">:=</span> <span class="token operator">&amp;</span>EchoAction<span class="token punctuation">{</span>
        Value<span class="token punctuation">:</span> <span class="token operator">&amp;</span>EchoAction_Pang<span class="token punctuation">{</span>Pang<span class="token punctuation">:</span> pangAction<span class="token punctuation">}</span><span class="token punctuation">,</span>
        Ty<span class="token punctuation">:</span>    ActionPang<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> action<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><blockquote><p>types/tx.go
Define the message structure</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> types

<span class="token keyword">type</span> EchoTx <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Message   <span class="token builtin">string</span> <span class="token string">`json:&quot;msg&quot;`</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="注册执行器"><a href="#注册执行器" class="header-anchor">#</a> 注册执行器</h3> <blockquote><p>plugin.go</p> <p>Register the dapp plug-in with the system. The implementation logic is as follows:</p> <p>In general, a complete DApp should at least include the corresponding command line and RPC interface, which can be implemented by referring to the corresponding section;</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> echo

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/33cn/chain33/pluginmgr&quot;</span>
	<span class="token string">&quot;github.com/33cn/plugin/plugin/dapp/echo/executor&quot;</span>
	echotypes  <span class="token string">&quot;github.com/33cn/plugin/plugin/dapp/echo/types&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	pluginmgr<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pluginmgr<span class="token punctuation">.</span>PluginBase<span class="token punctuation">{</span>
		Name<span class="token punctuation">:</span>     <span class="token string">&quot;echo&quot;</span><span class="token punctuation">,</span>
		ExecName<span class="token punctuation">:</span> echotypes<span class="token punctuation">.</span>EchoX<span class="token punctuation">,</span>
		Exec<span class="token punctuation">:</span>     executor<span class="token punctuation">.</span>Init<span class="token punctuation">,</span>
		Cmd<span class="token punctuation">:</span>      <span class="token boolean">nil</span><span class="token punctuation">,</span>
		RPC<span class="token punctuation">:</span>      <span class="token boolean">nil</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><blockquote><p>plugin/init/init.go</p> <p>Import this executor in init.go:</p></blockquote> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token boolean">_</span> <span class="token string">&quot;github.com/33cn/plugin/plugin/dapp/echo&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="test-executor"><a href="#test-executor" class="header-anchor">#</a> Test Executor</h3> <p>After a few steps above, the executor is built and deployed using the deployment tool that comes with chain33, we can test our developed executor to see how it works.</p> <ul><li>Ping</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> --data-binary <span class="token string">'{&quot;jsonrpc&quot;:&quot;2.0&quot;, &quot;id&quot;: 1, &quot;method&quot;:&quot;Chain33.CreateTransaction&quot;,&quot;params&quot;:[{&quot;execer&quot;:&quot;echo&quot;, &quot;actionName&quot;:&quot;ping&quot;, &quot;payload&quot;:{&quot;msg&quot;: &quot;hello&quot;}}] }'</span> <span class="token punctuation">\</span>
    -H <span class="token string">'content-type:text/plain;'</span> <span class="token punctuation">\</span>
    http://localhost:8801
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>In this case, the msg property is the content of the ping message we want to send, which can be changed by ourselves.</p> <p>The output results are as follows:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;result&quot;</span><span class="token operator">:</span><span class="token string">&quot;0a046563686f12090a070a0568656c6c6f3081ec84bab6b28bbe6c3a223145414b6f7252777837426b51536e575155594b725558594e716f6d31473154366b&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;error&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Where the result content is the original unsigned transaction content.</p> <ul><li>Sign the transaction</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code> <span class="token function">curl</span> --data-binary <span class="token string">'{&quot;jsonrpc&quot;:&quot;2.0&quot;, &quot;id&quot;: 1, &quot;method&quot;:&quot;Chain33.SignRawTx&quot;,&quot;params&quot;:[{&quot;addr&quot;:&quot;1KhZDqKCFWgmCnWzmYhfBkjnW1AZ1SEdDn&quot;, &quot;expire&quot;:&quot;2h&quot;, &quot;txHex&quot;:&quot;0a046563686f12090a070a0568656c6c6f3081ec84bab6b28bbe6c3a223145414b6f7252777837426b51536e575155594b725558594e716f6d31473154366b&quot;}] }'</span> <span class="token punctuation">\</span>
    -H <span class="token string">'content-type:text/plain;'</span> <span class="token punctuation">\</span>
    http://localhost:8901
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>The txHex content is the output result of the previous step, the unsigned transaction content. Addr is the address to which this transaction was sent and can be changed to its own address information.</p> <p>The output results are as follows:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;result&quot;</span><span class="token operator">:</span><span class="token string">&quot;0a046563686f12090a070a0568656c6c6f1a6d0801122102114453cbc6043184f17c106a21d65898c844e0b10bac38d9097229f537d09d331a46304402204f64f315637bf7bcdf82ef321c4516f7e77582ca854b301d2374d9248fa373d502202f1f24d769636a006652a0e96eee4579b7b6ae74295f0b8b3a912521cd71c3a328a9e6ffde053081ec84bab6b28bbe6c3a223145414b6f7252777837426b51536e575155594b725558594e716f6d31473154366b&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;error&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Where result is the signed transaction content;</p> <ul><li>Send Transaction</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code> <span class="token function">curl</span> --data-binary <span class="token string">'{&quot;jsonrpc&quot;:&quot;2.0&quot;, &quot;id&quot;: 1, &quot;method&quot;:&quot;Chain33.SendTransaction&quot;,&quot;params&quot;:[{&quot;data&quot;:&quot;0a046563686f12090a070a0568656c6c6f1a6d0801122102114453cbc6043184f17c106a21d65898c844e0b10bac38d9097229f537d09d331a46304402204f64f315637bf7bcdf82ef321c4516f7e77582ca854b301d2374d9248fa373d502202f1f24d769636a006652a0e96eee4579b7b6ae74295f0b8b3a912521cd71c3a328a9e6ffde053081ec84bab6b28bbe6c3a223145414b6f7252777837426b51536e575155594b725558594e716f6d31473154366b&quot;}] }'</span> <span class="token punctuation">\</span>
    -H <span class="token string">'content-type:text/plain;'</span> <span class="token punctuation">\</span>
    http://localhost:8901 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Where data is the signed transaction content.</p> <p>The output results are as follows:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;result&quot;</span><span class="token operator">:</span><span class="token string">&quot;0xe912cdf7b7d132bf7915e0db80bad8be6ce2510c60c25b66fa96dff7cec89404&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;error&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Where result is the hash of sending the transaction. You can use the following command to view the specific transaction sending information:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>./chain33-cli tx query -s 0xe912cdf7b7d132bf7915e0db80bad8be6ce2510c60c25b66fa96dff7cec89404
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>Query historical data</li></ul> <p>Repeat steps a-c a few times, then invoke the following command to find out how many times ping with a hello message has been invoked:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code> <span class="token function">curl</span> --data-binary <span class="token string">'{&quot;jsonrpc&quot;:&quot;2.0&quot;, &quot;id&quot;: 1, &quot;method&quot;:&quot;Chain33.Query&quot;,&quot;params&quot;:[{&quot;execer&quot;:&quot;echo&quot;, &quot;funcName&quot;:&quot;GetPing&quot;, &quot;payload&quot;:{&quot;msg&quot;: &quot;hello&quot;}}] }'</span> <span class="token punctuation">\</span>
    -H <span class="token string">'content-type:text/plain;'</span> <span class="token punctuation">\</span>
    http://localhost:8901
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>The output results are as follows:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;result&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;msg&quot;</span><span class="token operator">:</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;count&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;error&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/bityuan/bty-docs/edit/main/guide/2.Advanced/1.Function Modules/7.Executor Module.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">January 28, 2022 10:24</span></div> <!----></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.dbdd87ec.js" defer></script><script src="/assets/js/vendors~layout-Layout.7c31f7ee.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.273fc434.js" defer></script><script src="/assets/js/page-ExecutorModule.21056006.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.4a182f2f.js" defer></script>
  </body>
</html>
