<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Storage Module | BitYuan</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="A demo for vuepress-theme-hope">
    <meta property="og:url" content="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module.html">
    <meta property="og:site_name" content="BitYuan">
    <meta property="og:title" content="Storage Module">
    <meta property="og:description" content="Storage Module &quot;比特元底层Chain33使用高性能、高可靠的KV数据库来进行区块链数据的存储，支持goleveldb、gobadgerdb、gomemdb、gossdb等KV数据库类型。区块链中的状态数据的的存储格式采用可配置、可插拔的方式，可以支持mavl、mpt、kvmvcc的存储格式。&quot; Module Introduction Lik">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta property="og:locale:alternate" content="zh-CN">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="BitYuan">
    
    <link rel="preload" href="/assets/css/0.styles.b9744494.css" as="style"><link rel="preload" href="/assets/js/app.61649275.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.a899eb4d.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.e685678c.js" as="script"><link rel="preload" href="/assets/js/page-StorageModule.ea0d62e3.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.105e2268.js" as="script"><link rel="prefetch" href="/assets/js/108.04394fc2.js"><link rel="prefetch" href="/assets/js/109.cb4c4142.js"><link rel="prefetch" href="/assets/js/110.5fc93cf3.js"><link rel="prefetch" href="/assets/js/111.9fe67868.js"><link rel="prefetch" href="/assets/js/112.da801420.js"><link rel="prefetch" href="/assets/js/layout-Blog.5af318a6.js"><link rel="prefetch" href="/assets/js/layout-Layout.85d11602.js"><link rel="prefetch" href="/assets/js/layout-NotFound.1fdea755.js"><link rel="prefetch" href="/assets/js/layout-Slide.41d2ec70.js"><link rel="prefetch" href="/assets/js/page-BalanceInquiry.2b940cd1.js"><link rel="prefetch" href="/assets/js/page-BitYuanIntroduction.348b35b9.js"><link rel="prefetch" href="/assets/js/page-BitYuanWalletGuidelines.f2404ffd.js"><link rel="prefetch" href="/assets/js/page-BlockchainInterface.a975d979.js"><link rel="prefetch" href="/assets/js/page-BlockchainModule.90c91df7.js"><link rel="prefetch" href="/assets/js/page-Blockchain模块.89bd8f2c.js"><link rel="prefetch" href="/assets/js/page-Buildparachain.de663ce4.js"><link rel="prefetch" href="/assets/js/page-CA工具使用说明.7a410c51.js"><link rel="prefetch" href="/assets/js/page-CA服务使用说明.e3410b8a.js"><link rel="prefetch" href="/assets/js/page-CaseFoodTraceability.1a8faca0.js"><link rel="prefetch" href="/assets/js/page-Chain33系统接口.897c5324.js"><link rel="prefetch" href="/assets/js/page-ConsensusModule.3beeb8d4.js"><link rel="prefetch" href="/assets/js/page-CreateBitYuanparentBlockchain.772f5b57.js"><link rel="prefetch" href="/assets/js/page-DAPP开发介绍.b4b3a99c.js"><link rel="prefetch" href="/assets/js/page-Deployblockchainbrowser.70d78647.js"><link rel="prefetch" href="/assets/js/page-Deploysmartcontract.87194dc2.js"><link rel="prefetch" href="/assets/js/page-Deploywallet.98c7d313.js"><link rel="prefetch" href="/assets/js/page-Dockingwithexternalapplication.b4cc8100.js"><link rel="prefetch" href="/assets/js/page-EVM接口.44cb3c1b.js"><link rel="prefetch" href="/assets/js/page-ExecutorInterface.3978a6fc.js"><link rel="prefetch" href="/assets/js/page-ExecutorModule.be64e0e7.js"><link rel="prefetch" href="/assets/js/page-GRPC接口约定.ac0ae44f.js"><link rel="prefetch" href="/assets/js/page-Go语言开发DAPP.d76f8564.js"><link rel="prefetch" href="/assets/js/page-InterfaceContract.5e7fceb6.js"><link rel="prefetch" href="/assets/js/page-JavaScript语言开发DAPP.b089e11a.js"><link rel="prefetch" href="/assets/js/page-Manage.84170b99.js"><link rel="prefetch" href="/assets/js/page-MempoolInterface.5c83551b.js"><link rel="prefetch" href="/assets/js/page-Mempool接口.26594f6b.js"><link rel="prefetch" href="/assets/js/page-Mempool模块.9802fce0.js"><link rel="prefetch" href="/assets/js/page-MiningInterface.d9595f44.js"><link rel="prefetch" href="/assets/js/page-P2PModule.f28d16c8.js"><link rel="prefetch" href="/assets/js/page-P2P模块.c0acca8d.js"><link rel="prefetch" href="/assets/js/page-ParachainTokenIssuance.1ccb7e81.js"><link rel="prefetch" href="/assets/js/page-Project.d3542a85.js"><link rel="prefetch" href="/assets/js/page-QueueModule.b11b7fd8.js"><link rel="prefetch" href="/assets/js/page-Queue模块.d441ac29.js"><link rel="prefetch" href="/assets/js/page-RPCModule.be902da5.js"><link rel="prefetch" href="/assets/js/page-RPC接口编程样例.62e44d1d.js"><link rel="prefetch" href="/assets/js/page-RPC模块.9c85115d.js"><link rel="prefetch" href="/assets/js/page-SPOS共识.36cfbdde.js"><link rel="prefetch" href="/assets/js/page-Solidity语言开发DAPP.251fd6df.js"><link rel="prefetch" href="/assets/js/page-SystemInterface.13cbe62a.js"><link rel="prefetch" href="/assets/js/page-TokenInterface.0d2882b0.js"><link rel="prefetch" href="/assets/js/page-Token接口.75557d3d.js"><link rel="prefetch" href="/assets/js/page-Trade接口.69f70c0f.js"><link rel="prefetch" href="/assets/js/page-TransactionInterface.a53a89b9.js"><link rel="prefetch" href="/assets/js/page-Unfreeze.cfc9f06e.js"><link rel="prefetch" href="/assets/js/page-WalletInterface.cb7cc0b8.js"><link rel="prefetch" href="/assets/js/page-WalletModule.4843c2e5.js"><link rel="prefetch" href="/assets/js/page-Wallet接口.f136020a.js"><link rel="prefetch" href="/assets/js/page-autonomy接口.88c2c9c4.js"><link rel="prefetch" href="/assets/js/page-事件接口.08c2701f.js"><link rel="prefetch" href="/assets/js/page-交易接口.e49052a9.js"><link rel="prefetch" href="/assets/js/page-公链发展趋势.e1318130.js"><link rel="prefetch" href="/assets/js/page-共识模块.68bee043.js"><link rel="prefetch" href="/assets/js/page-创建比特元主链节点.4d741c77.js"><link rel="prefetch" href="/assets/js/page-区块链接口.33976f9f.js"><link rel="prefetch" href="/assets/js/page-去中心化应用.04efedc1.js"><link rel="prefetch" href="/assets/js/page-命令行工具介绍.d183754b.js"><link rel="prefetch" href="/assets/js/page-国密支持.6f957201.js"><link rel="prefetch" href="/assets/js/page-多重签名.a4edcc2b.js"><link rel="prefetch" href="/assets/js/page-存储模块.29c8cb1d.js"><link rel="prefetch" href="/assets/js/page-对接外部应用.79bbbc42.js"><link rel="prefetch" href="/assets/js/page-平行链共识节点挖矿奖励规则.f69f9dce.js"><link rel="prefetch" href="/assets/js/page-平行链发行Token.22e0ccd1.js"><link rel="prefetch" href="/assets/js/page-平行链环境配置.2ec10354.js"><link rel="prefetch" href="/assets/js/page-平行链资产转移管理介绍.4cc5018c.js"><link rel="prefetch" href="/assets/js/page-平行链超级节点创建和超级账户管理介绍.d642d1de.js"><link rel="prefetch" href="/assets/js/page-执行器接口.9106a61e.js"><link rel="prefetch" href="/assets/js/page-执行器模块.43c6c356.js"><link rel="prefetch" href="/assets/js/page-技术架构.4f3a258f.js"><link rel="prefetch" href="/assets/js/page-挖矿接口.981b9285.js"><link rel="prefetch" href="/assets/js/page-接口约定.a6e09e4a.js"><link rel="prefetch" href="/assets/js/page-搭建平行链.aaf304e0.js"><link rel="prefetch" href="/assets/js/page-文档主页.b8b51abb.js"><link rel="prefetch" href="/assets/js/page-智能合约.82f98c7b.js"><link rel="prefetch" href="/assets/js/page-术语介绍.d0b501aa.js"><link rel="prefetch" href="/assets/js/page-查询余额.5119c10c.js"><link rel="prefetch" href="/assets/js/page-比特元主网环境配置.93afa539.js"><link rel="prefetch" href="/assets/js/page-比特元介绍.610c84c3.js"><link rel="prefetch" href="/assets/js/page-比特元钱包操作手册.a8000be6.js"><link rel="prefetch" href="/assets/js/page-系统模块.f00971dc.js"><link rel="prefetch" href="/assets/js/page-系统要求.a76b797b.js"><link rel="prefetch" href="/assets/js/page-网络类型.9a83bc40.js"><link rel="prefetch" href="/assets/js/page-账户模型.f7af00a0.js"><link rel="prefetch" href="/assets/js/page-部署区块链浏览器.57e412ce.js"><link rel="prefetch" href="/assets/js/page-部署智能合约.98077653.js"><link rel="prefetch" href="/assets/js/page-部署钱包.93b6d77b.js"><link rel="prefetch" href="/assets/js/page-配置文件说明.d792ac8e.js"><link rel="prefetch" href="/assets/js/page-钱包找回合约.9ead417e.js"><link rel="prefetch" href="/assets/js/page-钱包模块.1c57f443.js"><link rel="prefetch" href="/assets/js/page-错误码.f6d01caa.js"><link rel="prefetch" href="/assets/js/page-隐私保护.dfb9c270.js"><link rel="prefetch" href="/assets/js/page-食品溯源案例.b3347614.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.4d34a317.js"><link rel="prefetch" href="/assets/js/vendors~mermaid.6cd29789.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.2bb473d1.js"><link rel="prefetch" href="/assets/js/vendors~reveal.f7e2c6f7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b9744494.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="BitYuan" class="logo"> <!----> <span class="site-name can-hide">BitYuan</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><!----> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="switch"><input id="switch" type="checkbox" checked="checked" class="switch-input"> <label for="switch" class="label"><span class="label-content"></span></label></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><!---->
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link router-link-active active"><!---->
  Guide
</a></div></nav> <div class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" style="width:1rem;height:1rem;vertical-align:middle;margin-left:1rem;"><path d="M639.981 344.075c14.805 44.45 34.542 79.023 69.084 113.596 29.603-29.634 49.34-69.146 64.145-113.596H639.981zM314.33 591.024h128.29l-64.145-172.865-64.145 172.865z" fill="currentColor"></path> <path d="M807.746 116.882H215.643c-54.274 0-98.681 44.45-98.681 98.78v592.677c0 54.329 44.407 98.78 98.68 98.78h592.104c54.273 0 98.681-44.451 98.681-98.78V215.66c0-54.329-39.475-98.78-98.68-98.78zM565.971 754.01c-9.866 9.878-19.738 9.878-29.603 9.878-4.94 0-14.805 0-19.738-4.939-4.939-4.939-9.872 0-9.872-4.939s-4.932-9.878-9.865-19.756c-4.94-9.878-4.94-14.817-9.872-24.695L467.29 655.23H294.592l-19.737 54.33c-9.866 19.755-14.805 34.572-19.738 44.45-4.939 9.878-14.804 9.878-29.603 9.878-9.871 0-19.737-4.939-29.609-9.878-9.865-9.878-14.798-14.817-14.798-24.695 0-4.939 0-9.878 4.933-19.756 4.939-9.878 4.939-14.817 9.865-24.695l108.553-276.583c4.939-9.878 4.939-19.756 9.872-29.633 4.932-9.878 9.865-19.756 14.798-24.695 4.939-4.94 9.872-14.817 19.737-19.756 9.872-4.94 19.738-4.94 29.61-4.94 9.865 0 19.73 0 29.603 4.94 9.865 4.939 14.804 9.878 19.737 19.756 4.933 4.939 9.866 14.817 14.798 24.695 4.94 9.877 9.872 19.755 14.805 34.572l108.553 271.644c9.865 19.756 14.804 34.573 14.804 44.451-4.939 4.94-9.872 14.817-14.804 24.695zm271.378-192.62c-54.273-19.756-93.748-44.451-128.29-74.085-34.536 34.573-78.943 59.268-133.223 74.085l-14.798-24.695c54.273-14.817 98.68-34.573 133.223-69.146-34.542-34.573-64.145-79.024-74.017-128.413h-49.34V319.38h133.228c-9.877-14.817-19.743-34.573-29.609-49.39l14.799-4.94c9.871 14.818 24.676 34.574 34.542 54.33h123.35v24.695h-49.34c-14.798 49.39-39.468 93.84-69.077 123.474 34.541 29.634 74.01 54.329 128.29 69.146l-19.738 24.695z" fill="currentColor"></path></svg> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/" aria-current="page" class="nav-link router-link-exact-active router-link-active active"><!---->
  English
</a></li><li class="dropdown-item"><a href="/zh/" class="nav-link"><!---->
  简体中文
</a></li></ul></div></div></div> <a rel="noopener noreferrer" href="https://github.com/bityuan/bty-docs" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><!---->
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link router-link-active active"><!---->
  Guide
</a></div> <a rel="noopener noreferrer" href="https://github.com/bityuan/bty-docs" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/" aria-current="page" class="sidebar-link">BitYuan Introduction</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Quick Start</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable open"><!----> <span class="title">Advanced</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading clickable open"><!----> <span class="title">Function Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/2.Advanced/1.Function%20Modules/1.P2P%20Module/" class="sidebar-link">P2P Module</a></li><li><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/" aria-current="page" class="active sidebar-link">Storage Module</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#module-introduction" class="sidebar-link">Module Introduction</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#logical-architecture" class="sidebar-link">Logical Architecture</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#storage-module-structure" class="sidebar-link heading3">Storage Module Structure</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#underlying-logical-architecture-storing-kv-db" class="sidebar-link heading3">Underlying Logical Architecture Storing KV DB</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#logical-architecture-of-statedb-and-localdb" class="sidebar-link heading3">Logical Architecture of StateDB and LocalDB</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#store-logical-architecture" class="sidebar-link heading3">Store Logical Architecture</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#process-logic" class="sidebar-link">Process Logic</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#main-interface-of-underlying-kv-db" class="sidebar-link heading3">Main Interface of Underlying KV DB</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#the-relevant-main-interfaces-for-statedb-and-localdb" class="sidebar-link heading3">The Relevant Main Interfaces for StateDB and LocalDB</a></li><li class="sidebar-sub-header"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#the-main-interface-for-substore" class="sidebar-link heading3">The Main Interface for SubStore</a></li></ul></li></ul></li><li><a href="/guide/2.Advanced/1.Function%20Modules/3.Blockchain%20Module/" class="sidebar-link">Blockchain Module</a></li><li><a href="/guide/2.Advanced/1.Function%20Modules/4.Mempool%20Module/" class="sidebar-link">Mempool模块</a></li><li><a href="/guide/2.Advanced/1.Function%20Modules/5.Consensus%20Module/" class="sidebar-link">Consensus Module</a></li><li><a href="/guide/2.Advanced/1.Function%20Modules/6.Wallet%20Module/" class="sidebar-link">Wallet Module</a></li><li><a href="/guide/2.Advanced/1.Function%20Modules/7.Executor%20Module/" class="sidebar-link">Executor Module</a></li><li><a href="/guide/2.Advanced/1.Function%20Modules/8.Queue%20Module/" class="sidebar-link">Queue Module</a></li><li><a href="/guide/2.Advanced/1.Function%20Modules/9.RPC%20Module/" class="sidebar-link">RPC Module</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Smart Contracts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Blockchain Browser</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Wallet</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">API Reference</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Case Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Upgrade Guide</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">Storage Module</span></h1> <div class="page-info"><!----> <!----><!----></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#module-introduction" class="anchor-link heading2"><div>Module Introduction</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#logical-architecture" class="anchor-link heading2"><div>Logical Architecture</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#storage-module-structure" class="anchor-link heading3"><div>Storage Module Structure</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#underlying-logical-architecture-storing-kv-db" class="anchor-link heading3"><div>Underlying Logical Architecture Storing KV DB</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#logical-architecture-of-statedb-and-localdb" class="anchor-link heading3"><div>Logical Architecture of StateDB and LocalDB</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#store-logical-architecture" class="anchor-link heading3"><div>Store Logical Architecture</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#process-logic" class="anchor-link heading2"><div>Process Logic</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#main-interface-of-underlying-kv-db" class="anchor-link heading3"><div>Main Interface of Underlying KV DB</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#the-relevant-main-interfaces-for-statedb-and-localdb" class="anchor-link heading3"><div>The Relevant Main Interfaces for StateDB and LocalDB</div></a></li><li class="anchor"><a href="/guide/2.Advanced/1.Function%20Modules/2.Storage%20Module/#the-main-interface-for-substore" class="anchor-link heading3"><div>The Main Interface for SubStore</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="storage-module"><a href="#storage-module" class="header-anchor">#</a> Storage Module</h1> <blockquote><p>比特元底层Chain33使用高性能、高可靠的KV数据库来进行区块链数据的存储，支持goleveldb、gobadgerdb、gomemdb、gossdb等KV数据库类型。区块链中的状态数据的的存储格式采用可配置、可插拔的方式，可以支持mavl、mpt、kvmvcc的存储格式。</p></blockquote> <h2 id="module-introduction"><a href="#module-introduction" class="header-anchor">#</a> Module Introduction</h2> <p>Like the traditional blockchain implementation, chain33 uses the high performance and high reliability KV DB for data storage, and the DB interfaces provided by design are all defined for KV storage characteristics.</p> <p>On the chain33 system, there are currently four database instances, as follows:</p> <blockquote><p>fzm@fzm001:~/chain33 $ ls datadir<br>
addrbook blockchain.db mavltree wallet</p></blockquote> <p>In Which:</p> <ul><li><strong>addrbook</strong>: The implementation capability is relatively single, mainly storing P2P nodes and related state information.</li> <li><strong>wallet</strong>: Store local account information</li> <li><strong>blockchain.db</strong>: Store the block header, block body, and additional information about the block, and the result information returned by the local execution of the transaction.</li> <li><strong>store</strong>: Store the result of the transaction execution and the hash information of the block staus.</li></ul> <p>For the storage module of chain33, there are several points:</p> <ul><li>The underlying storage and operation of chain33 supports many implementations by flexible configuration.</li></ul> <blockquote><p>The underlying layer can support various types of KV DB implementations based on configuration, such as goleveldb, gobadgerdb, gomemdb, gossdb, etc.
The underlying storage operations of the above four database instances, addrbook, wallet, blockchain.db and store, are all implemented through specific KV DB configurations, such as the default configuration of goleveldb.</p></blockquote> <ul><li>In practical application, Excutor uses two abstract database concepts, StateDB and LocalDB, to query the storage message of blockchain.db respectively.</li> <li>Format of the data storage in Store module can also adopts configurable, pluggable way, and default support mavl tree storage format.</li></ul> <p>Chain33 also supports user extension of new storage formats, such as pure KVDB storage format, mvcc-based KVDB storage format, MPT storage format, etc.</p> <p>But, ultimately the underlying operation of the data store is implemented through the specific KV DB configuration, such as goleveldb.</p> <h2 id="logical-architecture"><a href="#logical-architecture" class="header-anchor">#</a> Logical Architecture</h2> <h3 id="storage-module-structure"><a href="#storage-module-structure" class="header-anchor">#</a> Storage Module Structure</h3> <p><img src="/assets/img/Storage_template_interaction.b7b85799.png" alt="Storage Module Structure"></p> <ul><li>P2P, Wallet, Blockchain and Store all involve data storage, write and read data to KV DB instance through DB interface.</li> <li>BlockChain and Store modules also provide data query interfaces, which is operated by StateDB and LocalDB abstract database objects using messages.</li> <li>When BlockChain module generates blocks, it can write status information to the Store module by messages.</li> <li>Wallet, Consensus, Client and other modules can use messages to initiate data query to Blockchain and Store respectively by StateDB and LocalDB objects through the actuator.</li> <li>The Client module can also launch a status data query directly to the Store through messages.</li></ul> <h3 id="underlying-logical-architecture-storing-kv-db"><a href="#underlying-logical-architecture-storing-kv-db" class="header-anchor">#</a> Underlying Logical Architecture Storing KV DB</h3> <p><img src="/assets/img/KVDB_Architecture.2ac6b472.png" alt="Logical Architecture Storing KV DB"></p> <p>KV DB supported by the underlying data storage needs to adapt to the above interfaces.</p> <p>Take goleveldb as an example:</p> <p><img src="/assets/img/goleveldb_Architecture.6013bca4.png" alt="goleveldb"></p> <p>You can see that when goleveldb implements the DB interface, Iterator interface, and Batch interface, it can be used in the chain33 system as an underlying database implementation of the Storage module.</p> <p>Different KV DB implementations, such as gobadgerdb, gomemdb and gossdb, are all similar, need to implement db interface, Iterator interface and Batch interface to meet the needs of upper logical functions.</p> <h3 id="logical-architecture-of-statedb-and-localdb"><a href="#logical-architecture-of-statedb-and-localdb" class="header-anchor">#</a> Logical Architecture of StateDB and LocalDB</h3> <p><img src="/assets/img/LocalDB_Architecture.21244727.png" alt="Logical Architecture of LocalDB"></p> <p><img src="/assets/img/statedb_Architecture.211d68a6.png" alt="Logical Architecture of StateDB"></p> <p>As you can see, the function of these two abstract databases is very simple. What is misleading is the usage scenario and storage content of the two DB, so the following table shows the differences between the two DBs.</p> <table><thead><tr><th style="text-align:left;">DB</th> <th style="text-align:left;">StateDB</th> <th style="text-align:left;">LocalDB</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>write data purpose</strong></td> <td style="text-align:left;">cache</td> <td style="text-align:left;">cache</td></tr> <tr><td style="text-align:left;"><strong>read data source</strong></td> <td style="text-align:left;">store</td> <td style="text-align:left;">blockchain.db</td></tr> <tr><td style="text-align:left;">**actuator corresponding method(data source)</td> <td style="text-align:left;">KV returned by Exec</td> <td style="text-align:left;">KV returned by ExecLocal</td></tr> <tr><td style="text-align:left;"><strong>whether data contains status</strong></td> <td style="text-align:left;">yes (read and write data with StateHash)</td> <td style="text-align:left;">no (Key index data only)</td></tr> <tr><td style="text-align:left;"><strong>which data to store</strong></td> <td style="text-align:left;">Store the kvset for block trade execution（KV database direct storage; mavl database is stored as a StateHash construct tree）</td> <td style="text-align:left;">all information in block</td></tr> <tr><td style="text-align:left;"><strong>whether to check data</strong></td> <td style="text-align:left;">yes (recalculate StateHash check when executing block)</td> <td style="text-align:left;">no (write directly)</td></tr></tbody></table> <h3 id="store-logical-architecture"><a href="#store-logical-architecture" class="header-anchor">#</a> Store Logical Architecture</h3> <p><img src="/assets/img/store_Architecture.a53f6aac.png" alt="Store Logical Architecture"></p> <ul><li>The Store layer determines which format the state data will be organized in in the underlying KV DB.</li> <li>By default, the system supports the implementation of mavl tree format. By loading plug-ins, it can also support the implementation of KV DB, KV DB based on MVCC, and MPT.</li> <li>Developers who want to extend their data organization format need to implement the SubStore interface, register it in the system, and configure it.</li></ul> <h2 id="process-logic"><a href="#process-logic" class="header-anchor">#</a> Process Logic</h2> <h3 id="main-interface-of-underlying-kv-db"><a href="#main-interface-of-underlying-kv-db" class="header-anchor">#</a> Main Interface of Underlying KV DB</h3> <h4 id="basic-data-interface"><a href="#basic-data-interface" class="header-anchor">#</a> Basic Data Interface</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code>    <span class="token function">Get</span><span class="token punctuation">(</span>key <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
    <span class="token function">BatchGet</span><span class="token punctuation">(</span>keys <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>values <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span>
    <span class="token function">Set</span><span class="token punctuation">(</span>key <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> value <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span>
    <span class="token function">SetSync</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
    <span class="token function">Delete</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
    <span class="token function">DeleteSync</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token builtin">error</span>    
    <span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>These are the basic read, write, and delete interfaces for data, plus the interface to close the database. Pure key-value operation, directly docking with specific database interface.</p> <p>Some databases may not support asynchronous writes, so they have to be implemented synchronously (which has little impact on performance).</p> <h4 id="range-finder-interface"><a href="#range-finder-interface" class="header-anchor">#</a> Range Finder Interface</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code>    <span class="token function">List</span><span class="token punctuation">(</span>prefix<span class="token punctuation">,</span> key <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> count<span class="token punctuation">,</span> direction <span class="token builtin">int32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
    <span class="token function">PrefixCount</span><span class="token punctuation">(</span>prefix <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token builtin">int64</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>These two interfaces need to implement the so-called prefix search. Actually, the realization of the KV, is not purely a prefix search, but a Range find, because the data KEY matching is carried out in accordance with the the Range of estimates based on the prefix search.</p> <p>Here is an example(the search effect and * suffix fuzzy matching is the same).</p> <p>Example1： prefix=0xab9876abcd77ff</p> <p>At this time, the search scope is: 0xab9876abcd 77ff xxx ~ 0xab9876abcd 78ff xxx</p> <p>Example2：prefix=0xab9876abcd77ab</p> <p>At this time, the search scope is: 0xab9876abcd77 ab xxx ~ 0xab9876abcd77 ac xxx</p> <p>Where count is the number of limited searches, because the number of possible matches is large, only the previous count is returned;</p> <p>Direction is matching direction, positive direction is from start to end, and reverse direction is from end to start;</p> <p>Special note: when count is 0 (or the PrefixCount interface), it means to return all the matching data, but in a specific database implementation, if the amount of data is too large, it can cause problems such as database hangs, network timeouts, memory overruns.
The safe way is to do some processing is only take a fixed number of records (such as 10,000) each time during internal search, and then search for several times, finally summarize the results.</p> <h4 id="batch-data-interface"><a href="#batch-data-interface" class="header-anchor">#</a> Batch Data Interface</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code>    <span class="token keyword">type</span> Batch <span class="token keyword">interface</span> <span class="token punctuation">{</span>
        <span class="token function">Set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span>
        <span class="token function">Delete</span><span class="token punctuation">(</span>key <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span>
        <span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>You can think of this as a transactional interface that can perform multiple Set and Delete operations, and eventually a Write commit, all or none of which succeed.</p> <p>When implementing a database, especially one that does not support native transactions, tradeoffs may be considered. Take the implementation of SSDB as an example:</p> <ul><li>When newBatch is performed, two cache objects are created to store the cache queue for modification and deletion respectively.</li> <li>When Set operation, check whether Delete queue has corresponding Key, if so, delete it from Delete queue, and let Set operation into Set queue;</li> <li>When Delete operation, check whether there is corresponding Key in Set queue, if so, delete from Set queue, and let Delete operation into Delete queue;</li> <li>When writing, insert all the keys of the Delete queue in the Set queue, set Value to null, and then call batch Set interface. If fail, then return; if successful, call batch Delete interface, then return success.</li></ul> <p>There are two reasons for this operation:</p> <ol><li>Normal transaction operation is to ensure the internal operation order, so when Set and Delete operation is performing, we need to check each other’s queue, to prevent the problem of Delete before Set;</li> <li>When the transaction commits, the data to be deleted is left empty at the same time as the write operation, in order to prevent intermediate states where the write is successful but deletion fails</li></ol> <h4 id="iterator-interface"><a href="#iterator-interface" class="header-anchor">#</a> Iterator Interface</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code>    <span class="token keyword">type</span> IteratorSeeker <span class="token keyword">interface</span> <span class="token punctuation">{</span>
        <span class="token function">Rewind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span>
        <span class="token function">Seek</span><span class="token punctuation">(</span>key <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token builtin">bool</span>
        <span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">type</span> Iterator <span class="token keyword">interface</span> <span class="token punctuation">{</span>
        IteratorSeeker
        <span class="token function">Valid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span>
        <span class="token function">Key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
        <span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
        <span class="token function">ValueCopy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
        <span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
        <span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>The ability to wrap iterators in chain33, like Pointers in C or Cursors in SQL, interfaces in Iterator are easy to implement, mainly three methods in IteratorSeeker, and are difficult to implement for some databases. The following takes SSDB as an example to illustrate the implementation logic of the iterator.</p> <p>The creation interface for the iterator is as follows:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//Iterates through all key values in the prefix range, supporting reverse and forward iteration.</span>
<span class="token function">Iterator</span><span class="token punctuation">(</span>prefix <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> reserver <span class="token builtin">bool</span><span class="token punctuation">)</span> Iterator
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>When creating an iterator, the prefix lookup capability is wrapped, and the implementation logic in SSDB is as follows:</p> <ol><li><p>Use prefix to calculate the start and end KEYs of the match;</p></li> <li><p>Use the generated command keys or rkeys to find all KEYs that satisfy this prefix (paged with 1024), and wrap this information into the object Iterator;</p></li> <li><p>When the Next method is executed, the cursor +1 is used to get the corresponding KEY from the cache array, and then the Get interface of DB is called to obtain the data;</p> <p>If Cursor +1==1024, start with the last element KEY in the current cache array and continue to get the next KEY;</p></li> <li><p>When the Seek method is executed, it continuously calls the pagination logic to get the KEYS, and then matches the key until it meets, or no data;</p></li></ol> <h4 id="other-specific-interfaces"><a href="#other-specific-interfaces" class="header-anchor">#</a> Other Specific Interfaces</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Simulated transaction interface</span>
<span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">Rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The above three methods, which simulate transaction operations and are currently implemented only in StateDB, support only single-threaded memory transactions and were introduced in support of the TxGroup concept. When you add a new database implementation, you don’t need to consider support for these three interfaces. And don’t have to call these interfaces in your own code logic.</p> <h3 id="the-relevant-main-interfaces-for-statedb-and-localdb"><a href="#the-relevant-main-interfaces-for-statedb-and-localdb" class="header-anchor">#</a> The Relevant Main Interfaces for StateDB and LocalDB</h3> <h4 id="the-interface-related-to-data-storage-in-the-actuator"><a href="#the-interface-related-to-data-storage-in-the-actuator" class="header-anchor">#</a> The interface related to data storage in the actuator</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code>    <span class="token function">SetStateDB</span><span class="token punctuation">(</span>dbm<span class="token punctuation">.</span>KV<span class="token punctuation">)</span>
    <span class="token function">SetLocalDB</span><span class="token punctuation">(</span>dbm<span class="token punctuation">.</span>KVDB<span class="token punctuation">)</span>
    <span class="token function">Exec</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Receipt<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
    <span class="token function">ExecLocal</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
    <span class="token function">ExecDelLocal</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> receipt <span class="token operator">*</span>types<span class="token punctuation">.</span>ReceiptData<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>LocalDBSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="exec"><a href="#exec" class="header-anchor">#</a> Exec</h5> <p>The specific execution logic of the transaction, no matter what logic is executed, will eventually return a *types.receipt object containing two parts, KV and Logs, where KV will be written to StateDB (<font color="red">finally written to store</font>), and Logs will be passed as an input parameter when ExecLocal is called;</p> <p>The default Exec method does not generate any data;</p> <h5 id="execlocal"><a href="#execlocal" class="header-anchor">#</a> ExecLocal</h5> <p>The local execution logic of the transaction is an additional logic. And different execution results will not lead to block execution failure. The main logic here is using information generated by Exec, regenerate some additional information, convenient for other places to use;</p> <p>The default ExecLocal method generates the transaction details data corresponding to the transaction hash;</p> <p><font color="red">related data will eventually be written to blockchain.db.</font></p> <h5 id="execdellocal"><a href="#execdellocal" class="header-anchor">#</a> ExecDelLocal</h5> <p>This method corresponds to ExecDelLocal, which is called when dealing with forks. If one block has been executed and then another chain becomes the main chain, then the executed block will be pushed back and the logic of ExecDelLocal will be invoked. It should rollback data written to ExecLocal.</p> <h4 id="the-main-interface-for-statedb"><a href="#the-main-interface-for-statedb" class="header-anchor">#</a> The Main Interface for StateDB</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code>     <span class="token comment">//Get the status data from the Store (corresponding to the Store in chapter 1) through the message EventStoreGet.</span>
     <span class="token function">Get</span><span class="token punctuation">(</span>key <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="the-main-interface-for-localdb"><a href="#the-main-interface-for-localdb" class="header-anchor">#</a> The Main Interface for LocalDB</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code>     <span class="token comment">//Get block data from the BlockStore database (corresponding to blockchain.db in chapter 1) via the message EventLocalGet.</span>
     <span class="token function">Get</span><span class="token punctuation">(</span>key <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>  

     <span class="token comment">//Query the list of data from the BlockStore database (corresponding to blockchain.db in chapter 1) via the message EventLocalList</span>
     <span class="token function">List</span><span class="token punctuation">(</span>prefix<span class="token punctuation">,</span> key <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> count<span class="token punctuation">,</span> direction <span class="token builtin">int32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>  

     <span class="token comment">//Query the number of keys with the specified prefix from the BlockStore database (corresponding to blockchain.db in chapter 1) via the message EventLocalPrefixCount.</span>
     <span class="token function">PrefixCount</span><span class="token punctuation">(</span>prefix <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>count <span class="token builtin">int64</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="the-main-interface-for-substore"><a href="#the-main-interface-for-substore" class="header-anchor">#</a> The Main Interface for SubStore</h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code>    <span class="token keyword">type</span> SubStore <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token comment">//Write KV information to the corresponding StateHash.</span>
    <span class="token function">Set</span><span class="token punctuation">(</span>datas <span class="token operator">*</span>types<span class="token punctuation">.</span>StoreSet<span class="token punctuation">,</span> sync <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
    
    <span class="token comment">//Get KV information corresponding to StateHash.</span>
    <span class="token function">Get</span><span class="token punctuation">(</span>datas <span class="token operator">*</span>types<span class="token punctuation">.</span>StoreGet<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>

    <span class="token comment">//When a Blockchain module generates a block,  set the corresponding KVSet corresponding to StateHash into memory.</span>
    <span class="token function">MemSet</span><span class="token punctuation">(</span>datas <span class="token operator">*</span>types<span class="token punctuation">.</span>StoreSet<span class="token punctuation">,</span> sync <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>

    <span class="token comment">//When a Blockchain module generates a block,  set the corresponding KVSet corresponding to StateHash into memory.</span>
    <span class="token function">Commit</span><span class="token punctuation">(</span>hash <span class="token operator">*</span>types<span class="token punctuation">.</span>ReqHash<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>

    <span class="token comment">//When a Blockchain module generates a block, write the corresponding memory KVSet for StateHash to the store.</span>
    <span class="token function">Rollback</span><span class="token punctuation">(</span>req <span class="token operator">*</span>types<span class="token punctuation">.</span>ReqHash<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>

    <span class="token comment">//When Blockchain module fails to generate blocks, the KVSet data corresponding to StateHash's memory will be cleared.</span>
    <span class="token function">Del</span><span class="token punctuation">(</span>req <span class="token operator">*</span>types<span class="token punctuation">.</span>StoreDel<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>

    <span class="token comment">//In case of exception, the corresponding KV information of StateHash written to block is rolled back.</span>
    <span class="token function">IterateRangeByStateHash</span><span class="token punctuation">(</span>statehash <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> start <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> end <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> ascending <span class="token builtin">bool</span><span class="token punctuation">,</span> fn <span class="token keyword">func</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span>

    <span class="token comment">////Reserved event handling interface</span>
    <span class="token function">ProcEvent</span><span class="token punctuation">(</span>msg queue<span class="token punctuation">.</span>Message<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>The newly added plug-in types of Store layer all need to implement the above interfaces, such as KV DB, KVMVCC DB, MPT, etc.</p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/bityuan/bty-docs/edit/main/guide/2.Advanced/1.Function Modules/2.Storage Module.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <!----> <!----></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.61649275.js" defer></script><script src="/assets/js/vendors~layout-Layout.a899eb4d.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.e685678c.js" defer></script><script src="/assets/js/page-StorageModule.ea0d62e3.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.105e2268.js" defer></script>
  </body>
</html>
